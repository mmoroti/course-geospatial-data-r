<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introdução à análise geoespacial com R    </title>
    <meta charset="utf-8" />
    <meta name="author" content="Maurício H. Vancine   Milton C. Ribeiro" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introdução à análise geoespacial com R <br><br><br>
## 7 Estrutura e manipulação de dados matriciais <br><br><br>
### Maurício H. Vancine <br> Milton C. Ribeiro
### 22/10/2020

---




class: clear
background-image: url(img/geo_raster_wd.png)
background-size: 800px

---

background-image: url(img/r_spatial.jpeg)
background-size: 350px
background-position: 80% 65%

# 7 Estrutura e manejo de dados raster

## Tópicos
1. Pacotes
1. Dados raster
1. Classes raster
1. Importar dados matriciais
1. Descrição de objetos raster
1. Converter CRS
1. Manipulação de dados raster
1. Operação espaciais
1. Operações geométricas
1. Interações raster-vetor
1. Conversões raster-vetor
1. Exportar dados matriciais

---

# 7 Estrutura e manejo de dados raster

## Script

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

## .center[`07_script_intro_geocomp_r.R`]

---

background-image: url(img/geo_raster_package.png)
background-size: 650px
background-position: 50% 70%

# 7.1 Pacotes

## Pacote raster

```r
# raster
install.packages("raster")
library(raster)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://rspatial.org/raster/pkg/

---

background-image: url(img/geo_terra_package.png)
background-size: 650px
background-position: 50% 70%

# 7.1 Pacotes

## Pacote terra

```r
# raster
install.packages("terra")
library(terra)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://rspatial.org/terra/pkg/

---

background-image: url(img/geo_raster_stars.png)
background-size: 500px
background-position: 50% 70%

# 7.1 Pacotes

## Pacote stars

```r
# raster
install.packages("stars")
library(stars)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://r-spatial.github.io/stars/

---

background-image: url(img/geo_raster.png)
background-size: 500px
background-position: 50% 90%

# 7.2 Dados raster

## Raster ou Gride ou Dado Matricial (matriz)

---

background-image: url(img/geo_raster_cont_cat.png)
background-size: 700px
background-position: 50% 70%

# 7.2 Dados raster

## Tipos de dados: contínuos ou categóricos

---

background-image: url(img/geo_raster_plot.png)
background-size: 800px
background-position: 50% 70%

# 7.2 Dados raster

## Valores

---

background-image: url(img/geo_raster_single_multi_raster.png)
background-size: 800px
background-position: 50% 70%

# 7.3 Classes raster

## RasterLayer, RasterStack ou RasterBrick

---

background-image: url(img/geo_raster_single_raster.png)
background-size: 350px
background-position: 50% 80%

# 7.3 Classes raster

## RasterLayer

### A classe **RasterLayer** representa apenas uma camada raster, representando **uma variável**

---

# 7.3 Classes raster

## RasterLayer

### A classe **RasterLayer** representa apenas uma camada raster, representando **uma variável**

```r
# volcano
volcano
```

```
##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13] [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22]
##  [1,]  100  100  101  101  101  101  101  100  100   100   101   101   102   102   102   102   103   104   103   102   101   101
##  [2,]  101  101  102  102  102  102  102  101  101   101   102   102   103   103   103   103   104   105   104   103   102   102
##  [3,]  102  102  103  103  103  103  103  102  102   102   103   103   104   104   104   104   105   106   105   104   104   105
##  [4,]  103  103  104  104  104  104  104  103  103   103   103   104   104   104   105   105   106   107   106   106   106   107
##  [5,]  104  104  105  105  105  105  105  104  104   103   104   104   105   105   105   106   107   108   108   108   109   110
##  [6,]  105  105  105  106  106  106  106  105  105   104   104   105   105   106   106   107   109   110   110   112   113   115
##  [7,]  105  106  106  107  107  107  107  106  106   105   105   106   106   107   108   109   111   113   114   116   118   120
##  [8,]  106  107  107  108  108  108  108  107  107   106   106   107   108   108   110   113   115   117   118   120   122   124
##  [9,]  107  108  108  109  109  109  109  108  108   107   108   108   110   111   113   116   118   120   123   125   127   129
## [10,]  108  109  109  110  110  110  110  109  109   108   110   110   113   116   118   120   122   125   127   129   133   136
## [11,]  109  110  110  111  111  111  111  110  110   110   112   114   118   121   123   125   127   129   133   137   141   143
## [12,]  110  110  111  113  112  111  113  112  112   114   116   119   121   124   127   129   133   138   143   146   149   149
## [13,]  110  111  113  115  114  113  114  114  115   117   119   121   124   126   129   133   140   145   150   154   155   155
## [14,]  111  113  115  117  116  115  116  117  117   119   121   124   126   128   132   137   143   151   156   161   161   162
## [15,]  114  115  117  117  117  118  119  119  120   121   124   126   128   131   137   143   150   156   160   163   165   168
## [16,]  116  118  118  118  120  121  121  122  122   123   125   128   130   134   141   147   152   156   160   165   168   170
##       [,23] [,24] [,25] [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36] [,37] [,38] [,39] [,40] [,41] [,42]
##  [1,]   102   103   104   104   105   107   107   107   108   108   110   110   110   110   110   110   110   110   108   108
##  [2,]   103   105   106   106   107   109   110   110   110   110   111   112   113   114   116   115   114   112   110   110
##  [3,]   106   107   108   110   111   113   114   115   114   115   116   118   119   119   121   121   120   118   116   114
##  [4,]   108   110   111   114   117   118   117   119   120   121   122   124   125   126   127   127   126   124   122   120
##  [5,]   112   114   115   118   121   122   121   123   128   131   129   130   131   131   132   132   131   130   128   126
##  [6,]   116   118   119   121   124   126   126   129   134   137   137   136   136   135   136   136   136   135   133   129
##  [7,]   121   122   123   125   127   129   130   135   140   142   142   142   141   140   140   140   140   139   137   134
##  [8,]   125   127   128   129   131   134   135   141   146   147   146   146   145   144   144   144   143   142   141   139
##  [9,]   130   132   134   135   137   139   142   146   152   152   151   151   150   149   148   148   146   145   143   142
## [10,]   138   140   141   142   148   150   151   156   158   159   158   157   158   158   154   151   149   148   146   144
## [11,]   145   146   148   150   154   156   159   161   162   163   164   163   164   164   160   157   154   151   149   146
## [12,]   151   153   154   157   159   160   163   165   166   167   168   168   168   168   166   162   159   157   154   152
## [13,]   157   159   161   162   164   165   167   168   169   170   172   174   172   172   171   169   166   163   161   158
## [14,]   163   165   166   167   168   170   171   173   175   177   179   178   177   176   176   174   171   169   165   161
## [15,]   170   171   172   173   174   175   177   179   180   182   183   183   183   183   180   178   177   172   168   164
## [16,]   174   176   179   180   181   181   182   182   183   184   186   187   187   184   184   181   180   176   172   168
##       [,43] [,44] [,45] [,46] [,47] [,48] [,49] [,50] [,51] [,52] [,53] [,54] [,55] [,56] [,57] [,58] [,59] [,60] [,61]
##  [1,]   108   107   107   108   108   108   108   108   107   107   107   107   106   106   105   105   104   104   103
##  [2,]   110   109   108   109   109   109   109   108   108   108   108   107   107   106   106   105   105   104   104
##  [3,]   112   111   110   110   110   110   109   109   109   109   108   108   107   107   106   106   105   105   104
##  [4,]   117   116   113   111   110   110   110   109   109   109   109   108   108   107   107   106   106   105   105
##  [5,]   122   119   115   114   112   110   110   110   110   110   109   109   108   107   107   107   106   106   105
##  [6,]   126   122   118   116   115   113   111   110   110   110   110   109   108   108   108   107   107   106   106
##  [7,]   129   125   121   118   116   114   112   110   110   110   111   110   109   109   108   108   107   107   106
##  [8,]   135   130   126   122   118   116   114   112   112   113   112   110   110   109   109   108   108   107   106
##  [9,]   139   135   131   127   122   119   117   115   115   115   114   112   110   110   109   109   108   107   107
## [10,]   141   137   134   130   125   122   120   118   117   117   115   113   111   110   110   109   108   107   107
## [11,]   144   140   137   133   129   126   124   121   119   118   116   114   112   111   110   109   108   107   106
## [12,]   149   144   140   136   133   131   128   125   122   119   117   115   113   111   110   109   108   107   106
## [13,]   153   148   143   140   137   134   131   128   125   120   118   116   114   112   110   109   108   107   105
## [14,]   156   152   148   144   140   138   135   131   127   123   119   117   115   113   111   110   108   106   105
## [15,]   160   156   152   148   144   141   138   134   130   126   121   117   114   112   110   110   108   106   104
## [16,]   165   161   157   153   149   145   142   138   133   129   125   120   115   111   110   110   108   106   104
##  [ reached getOption("max.print") -- omitted 71 rows ]
```

---

# 7.3 Classes raster

## RasterLayer

### A classe **RasterLayer** representa apenas uma camada raster, representando **uma variável**

```r
# rasterlayer
ra_lay &lt;- raster::raster(volcano)
ra_lay
```

```
## class      : RasterLayer 
## dimensions : 87, 61, 5307  (nrow, ncol, ncell)
## resolution : 0.01639344, 0.01149425  (x, y)
## extent     : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
## crs        : NA 
## source     : memory
## names      : layer 
## values     : 94, 195  (min, max)
```

---

# 7.3 Classes raster

## RasterLayer

### A classe **RasterLayer** representa apenas uma camada raster, representando **uma variável**

```r
# plot
raster::plot(ra_lay)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-6-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.3 Classes raster

## RasterLayer

### A classe **RasterLayer** representa apenas uma camada raster, representando **uma variável**

```r
# plot
raster::plot(ra_lay, col = viridis::viridis(10))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-7-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.3 Classes raster

## RasterLayer

### A classe **RasterLayer** representa apenas uma camada raster, representando **uma variável**

```r
# plot
raster::plot(ra_lay, col = viridis::viridis(100))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-8-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_raster_multi_raster.png)
background-size: 350px
background-position: 50% 90%

# 7.3 Classes raster

## RasterStack

### A classe **RasterStack** é uma lista de objetos **RasterLayer** com a mesma extensão e resolução, representando **várias variáveis**

---

# 7.3 Classes raster

## RasterStack

```r
# stack
set.seed(42)
ra_sta &lt;- raster::stack(raster::raster(volcano), 
                           raster::raster(matrix(rnorm(prod(dim(volcano))), nrow = 87)),
                           raster::raster(matrix(rpois(prod(dim(volcano)), 10), nrow = 87)),
                           raster::raster(matrix(rbinom(prod(dim(volcano)), 1, .5), nrow = 87)))
ra_sta
```

```
## class      : RasterStack 
## dimensions : 87, 61, 5307, 4  (nrow, ncol, ncell, nlayers)
## resolution : 0.01639344, 0.01149425  (x, y)
## extent     : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
## crs        : NA 
## names      :    layer.1,    layer.2,    layer.3,    layer.4 
## min values :  94.000000,  -3.371739,   1.000000,   0.000000 
## max values : 195.000000,   3.584659,  25.000000,   1.000000
```

---

# 7.3 Classes raster

## RasterStack

```r
# plot
raster::plot(ra_sta, col = viridis::viridis(10))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-10-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_raster_multi_raster.png)
background-size: 350px
background-position: 50% 90%

# 7.3 Classes raster

## RasterBrick

### A classe **RasterBrick** também é uma lista de objetos **RasterLayer** com a mesma extensão e resolução

---

background-image: url(img/geo_raster_brick.jpg)
background-size: 600px
background-position: 50% 90%

# 7.3 Classes raster

## RasterBrick

### A principal diferença entre **RasterBrick** e **RasterStack** é que um **RasterBrick** é vinculado a um **único arquivo (multicamadas)**

---

# 7.3 Classes raster

## RasterBrick

```r
# brick
set.seed(42)
ra_bri &lt;- raster::brick(raster::raster(volcano), 
                           raster::raster(matrix(rnorm(prod(dim(volcano))), nrow = 87)),
                           raster::raster(matrix(rpois(prod(dim(volcano)), 10), nrow = 87)),
                           raster::raster(matrix(rbinom(prod(dim(volcano)), 1, .5), nrow = 87)))
ra_bri
```

```
## class      : RasterBrick 
## dimensions : 87, 61, 5307, 4  (nrow, ncol, ncell, nlayers)
## resolution : 0.01639344, 0.01149425  (x, y)
## extent     : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
## crs        : NA 
## source     : memory
## names      :    layer.1,    layer.2,    layer.3,    layer.4 
## min values :  94.000000,  -3.371739,   1.000000,   0.000000 
## max values : 195.000000,   3.584659,  25.000000,   1.000000
```

---

# 7.3 Classes raster

## RasterBrick

```r
# plot
raster::plot(ra_bri, col = viridis::viridis(10))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-12-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---

class: inverse, middle, center

# Importar dados raster

---

class: inverse, middle, center

# Dados de elevação

---

background-image: url(img/geo_raster_dem01.png), url(img/geo_raster_dem02.png)
background-size: 340px,350px
background-position: 10% 90%,85% 90%

# 7.4 Importar dados matriciais

## Dados de elevação

### Modelo Digital de Elevação (DEM) ou Superfície (DSM)

---

background-image: url(img/geo_raster_srtm01.png), url(img/geo_raster_srtm02.png), url(img/geo_raster_srtm03.png)
background-size: 400px,200px,320px
background-position: 10% 90%,65% 45%, 95% 85%

# 7.4 Importar dados matriciais

## Dados de elevação

### SRTM

&gt; - Farr, Tom G. et al. ["The Shuttle Radar Topography Mission."](https://doi.org/10.1002/joc.5086) Reviews of Geophysics 45.2 (2007): 1.

---

# 7.4 Importar dados matriciais

## Dados de elevação (SRTM)

### Download

### Criar um diretório

```r
# create directory
dir.create(here::here("03_dados", "raster"))
```

--

### Download de dados de elevação

```r
# increase time to download
options(timeout = 600)

# download
raster::getData(name = "SRTM", lon = -47, lat = -23, 
                path = here::here("03_dados", "raster"))
```

[*] http://srtm.csi.cgiar.org/download

---

# 7.4 Importar dados matriciais

## Importar uma camada

### RasterLayer

```r
# import raster
ra &lt;- raster::raster(here::here("03_dados", "raster", "srtm_27_17.tif"))
ra
```

```
## class      : RasterLayer 
## dimensions : 6000, 6000, 3.6e+07  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -50, -45, -25, -20  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : /home/mude/data/github/disciplina-analise-geoespacial/03_dados/raster/srtm_27_17.tif 
## names      : srtm_27_17 
## values     : -32768, 32767  (min, max)
```

---

# 7.4 Importar dados matriciais

## Importar uma camada

### Rio Claro

```r
# rio claro
rc_2019 &lt;- geobr::read_municipality(code_muni = 3543907, year = 2019, showProgress = FALSE) %&gt;% 
  sf::st_transform(crs = 4326)
rc_2019
```

```
## Simple feature collection with 1 feature and 7 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -47.76536 ymin: -22.55203 xmax: -47.46188 ymax: -22.24368
## geographic CRS: WGS 84
##     code_muni name_muni code_state abbrev_state name_state code_region name_region                           geom
## 493   3543907 Rio Claro         35           SP  São Paulo           3     Sudeste MULTIPOLYGON (((-47.66303 -...
```

---

# 7.4 Importar dados matriciais

## Importar uma camada

### RasterLayer

```r
# plot
raster::plot(ra, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .5), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-17-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_raster_crop_mask_buffer_square.png)
background-size: 700px
background-position: 50% 80%

# 7.4 Importar dados matriciais

## Importar uma camada

### Crop do RasterLayer

---

# 7.4 Importar dados matriciais

## Importar uma camada

### Crop do RasterLayer

```r
# crop
ra_rc &lt;- raster::crop(ra, rc_2019)
ra_rc
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : srtm_27_17 
## values     : 491, 985  (min, max)
```

---

# 7.4 Importar dados matriciais

## Importar uma camada

### Crop do RasterLayer

```r
# plot
raster::plot(ra_rc, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .3), lwd = 2, add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-19-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

class: inverse, middle, center

# Dados bioclimáticos

---

background-image: url(img/geo_raster_wc_artigo.png)
background-size: 600px
background-position: 50% 90%

# 7.4 Importar dados matriciais

## O que é o WorldClim?
- Principal bases de **dados climáticos** para o mundo
- Dados temporais de **temperatura e precipitação**
- Construído à partir de dados de **estações meteorológicas, interpolação e topografia**
- Principal forma de uso: **variáveis bioclimáticas**

&gt; - Fick, Stephen E., Hijmans, Robert J. ["WorldClim 2: new 1‐km spatial resolution climate surfaces for global land areas."](https://doi.org/10.1002/joc.5086) International Journal of Climatology 37.12 (2017): 4302.

---

background-image: url(img/geo_raster_wc_mapas.png)
background-size: 400px
background-position: 50% 75%

# 7.4 Importar dados matriciais

## Estações meteorológicas

---

background-image: url(img/geo_raster_wc_method.png)
background-size: 600px
background-position: 50% 60%

# 7.4 Importar dados matriciais

## Interpolação

---

background-image: url(img/geo_raster_wc_interpolation.png)
background-size: 450px
background-position: 50% 65%

# 7.4 Importar dados matriciais

## Interpolação

---

background-image: url(img/geo_raster_bioclim.png)
background-size: 550px
background-position: 50% 90%

# 7.4 Importar dados matriciais

## Variáveis Bioclimáticas

- São **19 variáveis** relacionadas com a **biologia das organismos**

- Combinações temporais de **temperatura (BIO01-BIO11)** e **precipitação (BIO12-BIO19)**

---

background-image: url(img/geo_raster_bio01.png)
background-size: 800px
background-position: 50% 70%

# 7.4 Importar dados matriciais

## Variáveis Bioclimáticas

### BIO01: Temperatura média anual (º C)

---

background-image: url(img/geo_raster_merraclim.jpg)
background-size: 800px
background-position: 50% 75%

# 7.4 Importar dados matriciais

## Variáveis Bioclimáticas

### Disponível em **várias resoluções** e **períodos (passado, presente e futuro)**

---

background-image: url(img/geo_raster_worldclim.png)
background-size: 800px
background-position: 50% 55%

# 7.4 Importar dados matriciais

## Site

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://www.worldclim.org/

---

# 7.4 Importar dados matriciais

## Download
### Download de dados bioclimáticos

```r
# download
download.file(url = "https://biogeo.ucdavis.edu/data/worldclim/v2.1/base/wc2.1_10m_bio.zip",
              destfile = here::here("03_dados", "raster", "wc2.0_10m_bio.zip"), mode = "wb")
```

--

### Unzip

```r
# unzip
unzip(zipfile = here::here("03_dados", "raster", "wc2.0_10m_bio.zip"),
      exdir = here::here("03_dados", "raster"))
```

---

# 7.4 Importar dados matriciais

## Importar várias camadas

### Listar arquivos

```r
# list files
fi &lt;- dir(path = here::here("03_dados", "raster"), pattern = "wc") %&gt;% 
  grep(".tif", ., value = TRUE)
fi
```

```
##  [1] "wc2.1_10m_bio_1.tif"  "wc2.1_10m_bio_10.tif" "wc2.1_10m_bio_11.tif" "wc2.1_10m_bio_12.tif" "wc2.1_10m_bio_13.tif"
##  [6] "wc2.1_10m_bio_14.tif" "wc2.1_10m_bio_15.tif" "wc2.1_10m_bio_16.tif" "wc2.1_10m_bio_17.tif" "wc2.1_10m_bio_18.tif"
## [11] "wc2.1_10m_bio_19.tif" "wc2.1_10m_bio_2.tif"  "wc2.1_10m_bio_3.tif"  "wc2.1_10m_bio_4.tif"  "wc2.1_10m_bio_5.tif" 
## [16] "wc2.1_10m_bio_6.tif"  "wc2.1_10m_bio_7.tif"  "wc2.1_10m_bio_8.tif"  "wc2.1_10m_bio_9.tif"
```

---

# 7.4 Importar dados matriciais

## Importar várias camadas

### RasterStack

```r
# import stack
st &lt;- raster::stack(here::here("03_dados", "raster", fi))
st
```

```
## class      : RasterStack 
## dimensions : 1080, 2160, 2332800, 19  (nrow, ncol, ncell, nlayers)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## names      : wc2.1_10m_bio_1, wc2.1_10m_bio_10, wc2.1_10m_bio_11, wc2.1_10m_bio_12, wc2.1_10m_bio_13, wc2.1_10m_bio_14, wc2.1_10m_bio_15, wc2.1_10m_bio_16, wc2.1_10m_bio_17, wc2.1_10m_bio_18, wc2.1_10m_bio_19, wc2.1_10m_bio_2, wc2.1_10m_bio_3, wc2.1_10m_bio_4, wc2.1_10m_bio_5, ... 
## min values :      -54.724354,       -37.781418,       -66.311249,         0.000000,         0.000000,         0.000000,         0.000000,         0.000000,         0.000000,         0.000000,         0.000000,        1.000000,        9.131122,        0.000000,      -29.686001, ... 
## max values :        30.98764,         38.21617,         29.15299,      11191.00000,       2381.00000,        484.00000,        229.00169,       5284.00000,       1507.00000,       5282.00000,       4467.00000,        21.14754,       100.00000,      2363.84595,        48.08275, ...
```

---

# 7.4 Importar dados matriciais

## Importar várias camadas

### RasterStack

```r
# plot
raster::plot(st[[1:2]], col = viridis::viridis(10))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-24-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

class: inverse, center, middle
# Objeto raster

---

# 7.5 Descrição de objetos raster

## Informações

```r
ra_rc
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : srtm_27_17 
## values     : 491, 985  (min, max)
```

- *class*: classe raster do objeto
- *dimensions*: número de linhas, colunas, células e camadas
- *resolution*: largura e altura da célula
- *extent*: coordenadas mínimas e máximas da longitude e latitude
- *crs*: Sistema de Referência de Coordenadas
- *source*: fonte dos dados (memória ou disco)
- *names*: nome das camadas
- *values*: valores máximos e mínimos das células

---

# 7.5 Descrição de objetos raster

## Informações

#### Classe

```r
class(ra_rc)
```

```
## [1] "RasterLayer"
## attr(,"package")
## [1] "raster"
```
--
#### Dimensões

```r
dim(ra_rc)
```

```
## [1] 370 364   1
```
--
#### Número de camadas

```r
nlayers(ra_rc)
```

```
## [1] 1
```

---

background-image: url(img/geo_raster.png)
background-size: 450px
background-position: 50% 90%

# 7.5 Descrição de objetos raster

## Informações

### Número de linhas, colunas e células

---

# 7.5 Descrição de objetos raster

## Informações

#### Número de linhas

```r
nrow(ra_rc)
```

```
## [1] 370
```
--
#### Número de colunas

```r
ncol(ra_rc)
```

```
## [1] 364
```
--
#### Número de células

```r
ncell(ra_rc)
```

```
## [1] 134680
```

---

background-image: url(img/geo_raster_resolution.png)
background-size: 650px
background-position: 50% 80%

# 7.5 Descrição de objetos raster

## Informações

### Resolução

---

# 7.5 Descrição de objetos raster

## Informações

### Resolução

```r
# raster resolution
res(ra_rc)
```

```
## [1] 0.0008333333 0.0008333333
```
--

```r
# stack resolution
res(st)
```

```
## [1] 0.1666667 0.1666667
```

---

background-image: url(img/geo_raster_extent.png)
background-size: 600px
background-position: 50% 90%

# 7.5 Descrição de objetos raster

## Informações

### Extenção

---

# 7.5 Descrição de objetos raster

## Informações

### Extenção

```r
# raster extent
extent(ra_rc)
```

```
## class      : Extent 
## xmin       : -47.765 
## xmax       : -47.46167 
## ymin       : -22.55167 
## ymax       : -22.24333
```
--

```r
# stack extent
extent(st)
```

```
## class      : Extent 
## xmin       : -180 
## xmax       : 180 
## ymin       : -90 
## ymax       : 90
```

---

# 7.5 Descrição de objetos raster

## Informações

### Projeção

```r
# projection
projection(ra_rc)
```

```
## [1] "+proj=longlat +datum=WGS84 +no_defs"
```
--

```r
# projection
projection(st)
```

```
## [1] "+proj=longlat +datum=WGS84 +no_defs"
```

---

# 7.5 Descrição de objetos raster

## Informações

### Nomes

```r
# raster names
names(ra_rc)
```

```
## [1] "srtm_27_17"
```
--

```r
# stack names
names(st)
```

```
##  [1] "wc2.1_10m_bio_1"  "wc2.1_10m_bio_10" "wc2.1_10m_bio_11" "wc2.1_10m_bio_12" "wc2.1_10m_bio_13" "wc2.1_10m_bio_14"
##  [7] "wc2.1_10m_bio_15" "wc2.1_10m_bio_16" "wc2.1_10m_bio_17" "wc2.1_10m_bio_18" "wc2.1_10m_bio_19" "wc2.1_10m_bio_2" 
## [13] "wc2.1_10m_bio_3"  "wc2.1_10m_bio_4"  "wc2.1_10m_bio_5"  "wc2.1_10m_bio_6"  "wc2.1_10m_bio_7"  "wc2.1_10m_bio_8" 
## [19] "wc2.1_10m_bio_9"
```

---

background-image: url(img/geo_raster_values.gif)
background-size: 650px
background-position: 50% 90%

# 7.5 Descrição de objetos raster

## Informações

### Valores

---

# 7.5 Descrição de objetos raster

## Informações

### Valores

```r
# raster values
getValues(ra_rc) %&gt;% head
```

```
## [1] 859 856 856 856 853 852
```

---

# 7.5 Descrição de objetos raster

## Informações

### Valores

```r
# raster values
values(ra_rc) %&gt;% head
```

```
## [1] 859 856 856 856 853 852
```

---

# 7.5 Descrição de objetos raster

## Informações

### Valores

```r
# raster values
ra_rc[] %&gt;% head
```

```
## [1] 859 856 856 856 853 852
```

---

# 7.5 Descrição de objetos raster

## Informações

### Valores

```r
# raster values histogram
ra_rc %&gt;% 
  raster::values() %&gt;% 
  hist(col = "steelblue", border = "white", main = NA, xlab = "Elevação (m)", ylab = "Frequência")
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-43-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.5 Descrição de objetos raster

## Informações

### Valores

```r
# stack values
values(st[[1:3]]) %&gt;% head
```

```
##      wc2.1_10m_bio_1 wc2.1_10m_bio_10 wc2.1_10m_bio_11
## [1,]              NA               NA               NA
## [2,]              NA               NA               NA
## [3,]              NA               NA               NA
## [4,]              NA               NA               NA
## [5,]              NA               NA               NA
## [6,]              NA               NA               NA
```

---

# 7.5 Descrição de objetos raster

## Informações

### Valores

```r
# stack values - pairs
st[[1:3]] %&gt;% 
  raster::values() %&gt;% 
  tibble::as_tibble() %&gt;% 
  dplyr::sample_n(1e3) %&gt;% 
  pairs(cex = 1.4, pch = 20, col = adjustcolor("steelblue", .7))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-45-1.png" width="35" style="display: block; margin: auto;" /&gt;

---

class: inverse, center, middle

# Conversão do CRS

---

background-image: url(img/geo_raster_reprojection.png)
background-size: 550px
background-position: 50% 70%

# 7.6 Conversão do CRS

## Reprojeção

---

background-image: url(img/geo_raster_crs.png)
background-size: 800px
background-position: 50% 90%

# 7.6 Conversão do CRS

## Reprojeção
1. Reprojeção vetorial de centróides celulares (muda a **posição e tamanho** do pixel)
1. Cálculo de novos valores dos pixels por meio de reamostragem (muda o **valor** do pixel)

---

# 7.6 Conversão do CRS

## Converter CRS local

### WGS84/GCS -&gt; SIRGAS2000/UTM23S (proj4string)

```r
# projection
ra_rc
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : srtm_27_17 
## values     : 491, 985  (min, max)
```

---

background-image: url(img/geo_utm_zones.png)
background-size: 400px
background-position: 80% 80%

# 7.6 Conversão do CRS

## Converter CRS local

### WGS84/GCS -&gt; SIRGAS2000/UTM23S (proj4string)

```r
# proj4string utm 23s
utm23 &lt;- "+proj=utm +zone=23 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
utm23
```

```
## [1] "+proj=utm +zone=23 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://epsg.io/31983

[*] https://pro.arcgis.com/en/pro-app/help/mapping/properties/transverse-mercator.htm

---

# 7.6 Conversão do CRS

## Converter CRS local

### WGS84/GCS -&gt; SIRGAS2000/UTM23S (proj4string)

```r
# reprojection
ra_rc_utm23 &lt;- raster::projectRaster(ra_rc, crs = utm23)
ra_rc_utm23
```

```
## class      : RasterLayer 
## dimensions : 386, 381, 147066  (nrow, ncol, ncell)
## resolution : 85.8, 92.3  (x, y)
## extent     : 214575.4, 247265.2, 7503009, 7538637  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=23 +south +ellps=GRS80 +units=m +no_defs 
## source     : memory
## names      : srtm_27_17 
## values     : 491.6033, 980.4151  (min, max)
```

---

# 7.6 Conversão do CRS

## Converter CRS local - especificando parâmetros

### WGS84/GCS -&gt; SIRGAS2000/UTM23S (proj4string)

```r
# reprojection
ra_rc_utm23 &lt;- raster::projectRaster(ra_rc, crs = utm23, res = 90, method = "bilinear")
ra_rc_utm23
```

```
## class      : RasterLayer 
## dimensions : 396, 364, 144144  (nrow, ncol, ncell)
## resolution : 90, 90  (x, y)
## extent     : 214554.4, 247314.4, 7502985, 7538625  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=23 +south +ellps=GRS80 +units=m +no_defs 
## source     : memory
## names      : srtm_27_17 
## values     : 493.2395, 986.686  (min, max)
```

---

# 7.6 Conversão do CRS

## Converter CRS local - especificando parâmetros

### WGS84/GCS -&gt; SIRGAS2000/UTM23S (proj4string)

```r
# reprojection vector
rc_2019_utm23 &lt;- sf::st_transform(rc_2019, crs = utm23)
rc_2019_utm23
```

```
## Simple feature collection with 1 feature and 7 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 215151.7 ymin: 7503729 xmax: 246553 ymax: 7537978
## CRS:            +proj=utm +zone=23 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs
##     code_muni name_muni code_state abbrev_state name_state code_region name_region                           geom
## 493   3543907 Rio Claro         35           SP  São Paulo           3     Sudeste MULTIPOLYGON (((225813.8 75...
```

---

# 7.6 Conversão do CRS

## Converter CRS local

### WGS84/GCS -&gt; SIRGAS2000/UTM23S (proj4string)

```r
# plot
raster::plot(ra_rc_utm23, col = viridis::viridis(10))
plot(rc_2019_utm23$geom, col = adjustcolor("red", .3), lwd = 2, add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-51-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.6 Conversão do CRS

## Converter CRS global

### Datum WGS84 e coordenadas geográficas

```r
# WGS84/GCS
st$wc2.1_10m_bio_1
```

```
## class      : RasterLayer 
## dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : /home/mude/data/github/disciplina-analise-geoespacial/03_dados/raster/wc2.1_10m_bio_1.tif 
## names      : wc2.1_10m_bio_1 
## values     : -54.72435, 30.98764  (min, max)
```

---

# 7.6 Conversão do CRS

## Converter CRS global

### Datum WGS84 e coordenadas geográficas

```r
# plot
raster::plot(st$wc2.1_10m_bio_1, col = viridis::viridis(10))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-53-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_proj_moll.png)
background-size: 450px
background-position: 80% 80%

# 7.6 Conversão do CRS

## Converter CRS global

### Projeção de Mollweide: preserva as relações de área

```r
# proj4string mollweide
moll &lt;- "+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"
moll
```

```
## [1] "+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://epsg.io/54009

[*] https://pro.arcgis.com/en/pro-app/help/mapping/properties/mollweide.htm

---

# 7.6 Conversão do CRS

## Converter CRS global

### Projeção de Mollweide

```r
# reprojection
bio01_moll &lt;- raster::projectRaster(st$wc2.1_10m_bio_1, crs = moll, res = 25e3, method = "bilinear")
bio01_moll
```

```
## class      : RasterLayer 
## dimensions : 732, 1453, 1063596  (nrow, ncol, ncell)
## resolution : 25000, 25000  (x, y)
## extent     : -18159905, 18165095, -9154952, 9145048  (xmin, xmax, ymin, ymax)
## crs        : +proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs 
## source     : memory
## names      : wc2.1_10m_bio_1 
## values     : -54.66752, 30.71805  (min, max)
```

---

# 7.6 Conversão do CRS

## Converter CRS global

### Projeção de Mollweide

```r
# plot
raster::plot(bio01_moll, col = viridis::viridis(10))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-56-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_proj_wintri.png)
background-size: 320px
background-position: 50% 80%

# 7.6 Conversão do CRS

## Converter CRS global

### Projeção de Winkel Tripel: mínimo de distorção para área, direção e distância

```r
# proj4string winkel tripel
wintri &lt;- "+proj=wintri +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"
wintri
```

```
## [1] "+proj=wintri +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://pro.arcgis.com/en/pro-app/help/mapping/properties/winkel-tripel.htm

---

# 7.6 Conversão do CRS

## Converter CRS global

### Projeção de Winkel Tripel

```r
# reprojection
bio01_wintri &lt;- raster::projectRaster(st$wc2.1_10m_bio_1, crs = wintri, res = 25e3, method = "bilinear")
bio01_wintri
```

```
## class      : RasterLayer 
## dimensions : 812, 1613, 1309756  (nrow, ncol, ncell)
## resolution : 25000, 25000  (x, y)
## extent     : -20157836, 20167164, -10156246, 10143754  (xmin, xmax, ymin, ymax)
## crs        : +proj=wintri +lon_0=0 +lat_1=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs 
## source     : memory
## names      : wc2.1_10m_bio_1 
## values     : -54.68495, 30.7076  (min, max)
```

---

# 7.6 Conversão do CRS

## Converter CRS global

### Projeção de Winkel Tripel

```r
# plot
raster::plot(bio01_wintri, col = viridis::viridis(10))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-59-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_proj_eck4.png)
background-size: 400px
background-position: 80% 82%

# 7.6 Conversão do CRS

## Converter CRS global

### Projeção de Eckert IV: presenva a área e com meridianos elípticos

```r
# proj4string eckert iv
eck4 &lt;- "+proj=eck4 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"
eck4
```

```
## [1] "+proj=eck4 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://epsg.io/54012

[*] https://pro.arcgis.com/en/pro-app/help/mapping/properties/eckert-iv.htm

---

# 7.6 Conversão do CRS

## Converter CRS global

### Projeção de Eckert IV

```r
# reprojection
bio01_eck4 &lt;- raster::projectRaster(st$wc2.1_10m_bio_1, crs = eck4, res = 25e3, method = "bilinear")
bio01_eck4
```

```
## class      : RasterLayer 
## dimensions : 687, 1363, 936381  (nrow, ncol, ncell)
## resolution : 25000, 25000  (x, y)
## extent     : -17043058, 17031942, -8589399, 8585601  (xmin, xmax, ymin, ymax)
## crs        : +proj=eck4 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs 
## source     : memory
## names      : wc2.1_10m_bio_1 
## values     : -54.66945, 30.72149  (min, max)
```

---

# 7.6 Conversão do CRS

## Converter CRS global

### Projeção de Eckert IV

```r
# plot
raster::plot(bio01_eck4, col = viridis::viridis(10))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-62-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_proj_laea.png)
background-size: 180px
background-position: 50% 78%

# 7.6 Conversão do CRS

## Converter CRS global

### Projeção azimutal de Lambert: preserva os tamanhos relativos e senso de direção a partir do centro

```r
# proj4string lambert 
laea &lt;- "+proj=laea +x_0=0 +y_0=0 +lon_0=0 +lat_0=0"
laea
```

```
## [1] "+proj=laea +x_0=0 +y_0=0 +lon_0=0 +lat_0=0"
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://pro.arcgis.com/en/pro-app/help/mapping/properties/lambert-azimuthal-equal-area.htm

---

# 7.6 Conversão do CRS

## Converter CRS global

```r
# reprojection
bio01_laea &lt;- raster::projectRaster(st$wc2.1_10m_bio_1, crs = laea, res = 25e3, method = "bilinear")
bio01_laea
```

```
## class      : RasterLayer 
## dimensions : 1028, 1029, 1057812  (nrow, ncol, ncell)
## resolution : 25000, 25000  (x, y)
## extent     : -12863885, 12861115, -12848994, 12851006  (xmin, xmax, ymin, ymax)
## crs        : +proj=laea +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs 
## source     : memory
## names      : wc2.1_10m_bio_1 
## values     : -54.70442, 30.71119  (min, max)
```

---

# 7.6 Conversão do CRS

## Converter CRS global

### Projeção azimutal de Lambert

```r
# plot
raster::plot(bio01_laea, col = viridis::viridis(10))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-65-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

class: inverse, center, middle
# Manipulação de raster

---

# 7.7 Manipulação de dados raster

## Subset do raster

### Indexação de linha-coluna ou id da célula

```r
# raster - row 1, column 1
ra[1, 1]
```

```
##     
## 382
```
--

```r
# cell is 1
ra[1]
```

```
##     
## 382
```

---

# 7.7 Manipulação de dados raster

## Subset do raster

### Indexação de linha-coluna ou id da célula

```r
# stack - row 1, column 1
st[1, 1]
```

```
##      wc2.1_10m_bio_1 wc2.1_10m_bio_10 wc2.1_10m_bio_11 wc2.1_10m_bio_12 wc2.1_10m_bio_13 wc2.1_10m_bio_14 wc2.1_10m_bio_15
## [1,]              NA               NA               NA               NA               NA               NA               NA
##      wc2.1_10m_bio_16 wc2.1_10m_bio_17 wc2.1_10m_bio_18 wc2.1_10m_bio_19 wc2.1_10m_bio_2 wc2.1_10m_bio_3 wc2.1_10m_bio_4
## [1,]               NA               NA               NA               NA              NA              NA              NA
##      wc2.1_10m_bio_5 wc2.1_10m_bio_6 wc2.1_10m_bio_7 wc2.1_10m_bio_8 wc2.1_10m_bio_9
## [1,]              NA              NA              NA              NA              NA
```

---

# 7.7 Manipulação de dados raster

## Subset do raster

### Indexação de linha-coluna ou id da célula

```r
# cell is 1
st[1]
```

```
##      wc2.1_10m_bio_1 wc2.1_10m_bio_10 wc2.1_10m_bio_11 wc2.1_10m_bio_12 wc2.1_10m_bio_13 wc2.1_10m_bio_14 wc2.1_10m_bio_15
## [1,]              NA               NA               NA               NA               NA               NA               NA
##      wc2.1_10m_bio_16 wc2.1_10m_bio_17 wc2.1_10m_bio_18 wc2.1_10m_bio_19 wc2.1_10m_bio_2 wc2.1_10m_bio_3 wc2.1_10m_bio_4
## [1,]               NA               NA               NA               NA              NA              NA              NA
##      wc2.1_10m_bio_5 wc2.1_10m_bio_6 wc2.1_10m_bio_7 wc2.1_10m_bio_8 wc2.1_10m_bio_9
## [1,]              NA              NA              NA              NA              NA
```

---

# 7.7 Manipulação de dados raster

## Subset do raster

### Seleção de RasterLayer no StackLayer

```r
# selection layer in stack
st_bio01 &lt;- raster::subset(st, "wc2.1_10m_bio_1")
st_bio01
```

```
## class      : RasterLayer 
## dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : /home/mude/data/github/disciplina-analise-geoespacial/03_dados/raster/wc2.1_10m_bio_1.tif 
## names      : wc2.1_10m_bio_1 
## values     : -54.72435, 30.98764  (min, max)
```

---

# 7.7 Manipulação de dados raster

## Subset do raster

### Seleção de RasterLayer no StackLayer

```r
# selection layer in stack
st_bio01 &lt;- raster::raster(st, layer = 1)
st_bio01
```

```
## class      : RasterLayer 
## dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : /home/mude/data/github/disciplina-analise-geoespacial/03_dados/raster/wc2.1_10m_bio_1.tif 
## names      : wc2.1_10m_bio_1 
## values     : -54.72435, 30.98764  (min, max)
```

---

# 7.7 Manipulação de dados raster

## Subset do raster

### Seleção de RasterLayer no StackLayer [[]]

```r
# selection layer in stack
st_bio01 &lt;- st[["wc2.1_10m_bio_1"]]
st_bio01
```

```
## class      : RasterLayer 
## dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : /home/mude/data/github/disciplina-analise-geoespacial/03_dados/raster/wc2.1_10m_bio_1.tif 
## names      : wc2.1_10m_bio_1 
## values     : -54.72435, 30.98764  (min, max)
```

---

# 7.7 Manipulação de dados raster

## Subset do raster

### Seleção de RasterLayer no StackLayer [[]]

```r
# selection layer in stack
st_bio01 &lt;- st[[1]]
st_bio01
```

```
## class      : RasterLayer 
## dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : /home/mude/data/github/disciplina-analise-geoespacial/03_dados/raster/wc2.1_10m_bio_1.tif 
## names      : wc2.1_10m_bio_1 
## values     : -54.72435, 30.98764  (min, max)
```

---

# 7.7 Manipulação de dados raster

## Subset do raster

### Seleção de RasterLayer no StackLayer $

```r
# selection layer in stack
st_bio01 &lt;- st$wc2.1_10m_bio_1
st_bio01
```

```
## class      : RasterLayer 
## dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : /home/mude/data/github/disciplina-analise-geoespacial/03_dados/raster/wc2.1_10m_bio_1.tif 
## names      : wc2.1_10m_bio_1 
## values     : -54.72435, 30.98764  (min, max)
```

---

# 7.7 Manipulação de dados raster

## Subset do raster

### Seleção de RasterLayer no StackLayer $

```r
# plot
raster::plot(st_bio01, col = viridis::viridis(10))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-75-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.7 Manipulação de dados raster

## Renomear rasters

```r
# names
names(ra_rc)
```

```
## [1] "srtm_27_17"
```
--

```r
# rename
names(ra_rc) &lt;- "elevation"
```
--

```r
# names
names(ra_rc)
```

```
## [1] "elevation"
```

---

# 7.7 Manipulação de dados raster

## Renomear rasters

```r
# names
names(st)
```

```
##  [1] "wc2.1_10m_bio_1"  "wc2.1_10m_bio_10" "wc2.1_10m_bio_11" "wc2.1_10m_bio_12" "wc2.1_10m_bio_13" "wc2.1_10m_bio_14"
##  [7] "wc2.1_10m_bio_15" "wc2.1_10m_bio_16" "wc2.1_10m_bio_17" "wc2.1_10m_bio_18" "wc2.1_10m_bio_19" "wc2.1_10m_bio_2" 
## [13] "wc2.1_10m_bio_3"  "wc2.1_10m_bio_4"  "wc2.1_10m_bio_5"  "wc2.1_10m_bio_6"  "wc2.1_10m_bio_7"  "wc2.1_10m_bio_8" 
## [19] "wc2.1_10m_bio_9"
```
--

```r
# rename
names(st) &lt;- c("bio01", paste0("bio", 10:19), paste0("bio0", 2:9))
```
--

```r
# names
names(ra_rc)
```

```
## [1] "elevation"
```

---

# 7.7 Manipulação de dados raster

## Resumir informações do raster

### Média de todos os valores

```r
# mean from all cells
raster::cellStats(ra_rc, mean)
```

```
## [1] 625.8273
```

---

# 7.7 Manipulação de dados raster

## Resumir informações do raster

### Média de todos os valores

```r
# mean from all cells
raster::cellStats(st[[1:3]], mean)
```

```
##      bio01      bio10      bio11 
##  -4.037828   7.203555 -13.896329
```

---

# 7.7 Manipulação de dados raster

## Resumir informações do raster

### Frequência de cada valor

```r
# count cells
raster::freq(ra_rc)
```

```
##        value count
##   [1,]   491     1
##   [2,]   492     4
##   [3,]   493     9
##   [4,]   494    19
##   [5,]   495    32
##   [6,]   496    44
##   [7,]   497    51
##   [8,]   498    65
##   [9,]   499    53
##  [10,]   500    83
##  [11,]   501   110
##  [12,]   502   141
##  [13,]   503   156
##  [14,]   504   162
##  [15,]   505   178
##  [16,]   506   161
##  [17,]   507   180
##  [18,]   508   160
##  [19,]   509   164
##  [20,]   510   120
##  [21,]   511   144
##  [22,]   512   127
##  [23,]   513   138
##  [24,]   514   107
##  [25,]   515   138
##  [26,]   516   120
##  [27,]   517   159
##  [28,]   518   138
##  [29,]   519   155
##  [30,]   520   173
##  [31,]   521   148
##  [32,]   522   184
##  [33,]   523   151
##  [34,]   524   175
##  [35,]   525   186
##  [36,]   526   180
##  [37,]   527   172
##  [38,]   528   195
##  [39,]   529   197
##  [40,]   530   208
##  [41,]   531   184
##  [42,]   532   219
##  [43,]   533   203
##  [44,]   534   237
##  [45,]   535   235
##  [46,]   536   243
##  [47,]   537   249
##  [48,]   538   230
##  [49,]   539   268
##  [50,]   540   276
##  [51,]   541   270
##  [52,]   542   323
##  [53,]   543   290
##  [54,]   544   329
##  [55,]   545   322
##  [56,]   546   365
##  [57,]   547   362
##  [58,]   548   380
##  [59,]   549   408
##  [60,]   550   398
##  [61,]   551   425
##  [62,]   552   403
##  [63,]   553   429
##  [64,]   554   405
##  [65,]   555   411
##  [66,]   556   432
##  [67,]   557   418
##  [68,]   558   454
##  [69,]   559   479
##  [70,]   560   472
##  [71,]   561   489
##  [72,]   562   528
##  [73,]   563   478
##  [74,]   564   577
##  [75,]   565   566
##  [76,]   566   573
##  [77,]   567   587
##  [78,]   568   576
##  [79,]   569   623
##  [80,]   570   652
##  [81,]   571   625
##  [82,]   572   679
##  [83,]   573   710
##  [84,]   574   660
##  [85,]   575   697
##  [86,]   576   671
##  [87,]   577   635
##  [88,]   578   669
##  [89,]   579   704
##  [90,]   580   739
##  [91,]   581   786
##  [92,]   582   765
##  [93,]   583   827
##  [94,]   584   764
##  [95,]   585   824
##  [96,]   586   846
##  [97,]   587   817
##  [98,]   588   849
##  [99,]   589   881
## [100,]   590   872
## [101,]   591   910
## [102,]   592   937
## [103,]   593   952
## [104,]   594   923
## [105,]   595   990
## [106,]   596  1025
## [107,]   597  1017
## [108,]   598  1074
## [109,]   599  1032
## [110,]   600  1040
## [111,]   601  1070
## [112,]   602  1109
## [113,]   603  1110
## [114,]   604  1064
## [115,]   605  1103
## [116,]   606  1074
## [117,]   607  1098
## [118,]   608  1133
## [119,]   609  1104
## [120,]   610  1086
## [121,]   611  1134
## [122,]   612  1114
## [123,]   613  1133
## [124,]   614  1070
## [125,]   615  1068
## [126,]   616  1130
## [127,]   617  1132
## [128,]   618  1079
## [129,]   619  1112
## [130,]   620  1085
## [131,]   621  1090
## [132,]   622  1094
## [133,]   623  1103
## [134,]   624  1113
## [135,]   625  1126
## [136,]   626  1175
## [137,]   627  1171
## [138,]   628  1107
## [139,]   629  1047
## [140,]   630  1060
## [141,]   631  1132
## [142,]   632  1094
## [143,]   633  1077
## [144,]   634  1037
## [145,]   635  1087
## [146,]   636   981
## [147,]   637   941
## [148,]   638   987
## [149,]   639   976
## [150,]   640   983
## [151,]   641   992
## [152,]   642   915
## [153,]   643   961
## [154,]   644   868
## [155,]   645   859
## [156,]   646   851
## [157,]   647   822
## [158,]   648   801
## [159,]   649   772
## [160,]   650   825
## [161,]   651   781
## [162,]   652   710
## [163,]   653   760
## [164,]   654   693
## [165,]   655   696
## [166,]   656   640
## [167,]   657   669
## [168,]   658   622
## [169,]   659   701
## [170,]   660   655
## [171,]   661   673
## [172,]   662   616
## [173,]   663   591
## [174,]   664   557
## [175,]   665   632
## [176,]   666   604
## [177,]   667   639
## [178,]   668   638
## [179,]   669   587
## [180,]   670   591
## [181,]   671   565
## [182,]   672   502
## [183,]   673   546
## [184,]   674   549
## [185,]   675   480
## [186,]   676   459
## [187,]   677   471
## [188,]   678   416
## [189,]   679   457
## [190,]   680   383
## [191,]   681   348
## [192,]   682   382
## [193,]   683   313
## [194,]   684   324
## [195,]   685   309
## [196,]   686   331
## [197,]   687   280
## [198,]   688   301
## [199,]   689   289
## [200,]   690   246
## [201,]   691   273
## [202,]   692   267
## [203,]   693   287
## [204,]   694   255
## [205,]   695   247
## [206,]   696   252
## [207,]   697   239
## [208,]   698   281
## [209,]   699   275
## [210,]   700   266
## [211,]   701   281
## [212,]   702   230
## [213,]   703   232
## [214,]   704   260
## [215,]   705   264
## [216,]   706   227
## [217,]   707   242
## [218,]   708   232
## [219,]   709   241
## [220,]   710   216
## [221,]   711   224
## [222,]   712   176
## [223,]   713   194
## [224,]   714   210
## [225,]   715   188
## [226,]   716   190
## [227,]   717   196
## [228,]   718   221
## [229,]   719   169
## [230,]   720   174
## [231,]   721   180
## [232,]   722   174
## [233,]   723   171
## [234,]   724   152
## [235,]   725   153
## [236,]   726   162
## [237,]   727   128
## [238,]   728   130
## [239,]   729   127
## [240,]   730   138
## [241,]   731   116
## [242,]   732    96
## [243,]   733   121
## [244,]   734   103
## [245,]   735    98
## [246,]   736   103
## [247,]   737   122
## [248,]   738   113
## [249,]   739   110
## [250,]   740    90
## [251,]   741    85
## [252,]   742    89
## [253,]   743    81
## [254,]   744    88
## [255,]   745    99
## [256,]   746    85
## [257,]   747    84
## [258,]   748    79
## [259,]   749    93
## [260,]   750    92
## [261,]   751    67
## [262,]   752    78
## [263,]   753    72
## [264,]   754    84
## [265,]   755    68
## [266,]   756    64
## [267,]   757    77
## [268,]   758    60
## [269,]   759    72
## [270,]   760    57
## [271,]   761    59
## [272,]   762    55
## [273,]   763    62
## [274,]   764    62
## [275,]   765    50
## [276,]   766    67
## [277,]   767    78
## [278,]   768    61
## [279,]   769    58
## [280,]   770    47
## [281,]   771    60
## [282,]   772    68
## [283,]   773    76
## [284,]   774    55
## [285,]   775    60
## [286,]   776    58
## [287,]   777    61
## [288,]   778    52
## [289,]   779    48
## [290,]   780    55
## [291,]   781    51
## [292,]   782    46
## [293,]   783    60
## [294,]   784    52
## [295,]   785    50
## [296,]   786    56
## [297,]   787    51
## [298,]   788    51
## [299,]   789    59
## [300,]   790    44
## [301,]   791    56
## [302,]   792    62
## [303,]   793    53
## [304,]   794    41
## [305,]   795    37
## [306,]   796    52
## [307,]   797    42
## [308,]   798    37
## [309,]   799    50
## [310,]   800    49
## [311,]   801    42
## [312,]   802    44
## [313,]   803    40
## [314,]   804    38
## [315,]   805    40
## [316,]   806    40
## [317,]   807    36
## [318,]   808    32
## [319,]   809    28
## [320,]   810    35
## [321,]   811    38
## [322,]   812    46
## [323,]   813    33
## [324,]   814    44
## [325,]   815    35
## [326,]   816    25
## [327,]   817    37
## [328,]   818    39
## [329,]   819    38
## [330,]   820    39
## [331,]   821    40
## [332,]   822    29
## [333,]   823    37
## [334,]   824    38
## [335,]   825    35
## [336,]   826    47
## [337,]   827    45
## [338,]   828    40
## [339,]   829    40
## [340,]   830    34
## [341,]   831    51
## [342,]   832    56
## [343,]   833    50
## [344,]   834    41
## [345,]   835    45
## [346,]   836    46
## [347,]   837    43
## [348,]   838    51
## [349,]   839    44
## [350,]   840    50
## [351,]   841    41
## [352,]   842    47
## [353,]   843    46
## [354,]   844    45
## [355,]   845    42
## [356,]   846    33
## [357,]   847    47
## [358,]   848    33
## [359,]   849    33
## [360,]   850    32
## [361,]   851    23
## [362,]   852    30
## [363,]   853    24
## [364,]   854    17
## [365,]   855    32
## [366,]   856    29
## [367,]   857    29
## [368,]   858    24
## [369,]   859    21
## [370,]   860    20
## [371,]   861    22
## [372,]   862    19
## [373,]   863    20
## [374,]   864     8
## [375,]   865    12
## [376,]   866     9
## [377,]   867    13
## [378,]   868    13
## [379,]   869     4
## [380,]   870     3
## [381,]   871     4
## [382,]   872     8
## [383,]   873     4
## [384,]   874     4
## [385,]   875     2
## [386,]   876     3
## [387,]   877     3
## [388,]   878     2
## [389,]   880     2
## [390,]   882     3
## [391,]   885     2
## [392,]   887     1
## [393,]   888     1
## [394,]   889     2
## [395,]   892     2
## [396,]   895     1
## [397,]   896     1
## [398,]   900     3
## [399,]   901     1
## [400,]   904     1
## [401,]   905     1
## [402,]   906     2
## [403,]   908     3
## [404,]   911     1
## [405,]   919     1
## [406,]   920     4
## [407,]   921     2
## [408,]   924     1
## [409,]   925     1
## [410,]   927     2
## [411,]   928     1
## [412,]   930     1
## [413,]   934     2
## [414,]   935     4
## [415,]   938     1
## [416,]   940     3
## [417,]   941     1
## [418,]   942     1
## [419,]   943     3
## [420,]   945     1
## [421,]   946     1
## [422,]   948     1
## [423,]   949     2
## [424,]   950     1
## [425,]   952     1
## [426,]   954     1
## [427,]   955     1
## [428,]   969     1
## [429,]   971     1
## [430,]   974     1
## [431,]   982     1
## [432,]   983     1
## [433,]   985     1
```

---

# 7.7 Manipulação de dados raster

## Resumir informações do raster

### Frequência de cada valor

```r
# count cells
raster::freq(st[[1:3]])
```

```
## $bio01
##       value   count
##  [1,]   -55     319
##  [2,]   -54    4529
##  [3,]   -53    5778
##  [4,]   -52    6128
##  [5,]   -51    6090
##  [6,]   -50    7892
##  [7,]   -49    7422
##  [8,]   -48    5834
##  [9,]   -47    7812
## [10,]   -46    8130
## [11,]   -45    7457
## [12,]   -44    7242
## [13,]   -43    7118
## [14,]   -42    7079
## [15,]   -41    6855
## [16,]   -40    6352
## [17,]   -39    6241
## [18,]   -38    6165
## [19,]   -37    6131
## [20,]   -36    7635
## [21,]   -35    5591
## [22,]   -34    5705
## [23,]   -33    5079
## [24,]   -32    6257
## [25,]   -31    5530
## [26,]   -30    4924
## [27,]   -29    4324
## [28,]   -28    4027
## [29,]   -27    4615
## [30,]   -26    6749
## [31,]   -25    6789
## [32,]   -24    8227
## [33,]   -23    7621
## [34,]   -22    6429
## [35,]   -21    5691
## [36,]   -20    5631
## [37,]   -19    5450
## [38,]   -18    5747
## [39,]   -17    5699
## [40,]   -16    6983
## [41,]   -15   11203
## [42,]   -14   12106
## [43,]   -13   11107
## [44,]   -12   10073
## [45,]   -11    9433
## [46,]   -10    9620
## [47,]    -9    8864
## [48,]    -8    9088
## [49,]    -7    9785
## [50,]    -6   10670
## [51,]    -5   10767
## [52,]    -4   10766
## [53,]    -3   11046
## [54,]    -2   11953
## [55,]    -1   12994
## [56,]     0   14164
## [57,]     1   12694
## [58,]     2   13079
## [59,]     3   11599
## [60,]     4   10762
## [61,]     5   10355
## [62,]     6   10174
## [63,]     7   11806
## [64,]     8   11440
## [65,]     9   10828
## [66,]    10    9836
## [67,]    11    8717
## [68,]    12    7621
## [69,]    13    7220
## [70,]    14    7356
## [71,]    15    8567
## [72,]    16    9836
## [73,]    17   10151
## [74,]    18    9692
## [75,]    19   10200
## [76,]    20   13173
## [77,]    21   13958
## [78,]    22   16012
## [79,]    23   18701
## [80,]    24   20783
## [81,]    25   26891
## [82,]    26   33824
## [83,]    27   30371
## [84,]    28   14688
## [85,]    29    7316
## [86,]    30    1451
## [87,]    31      36
## [88,]    NA 1524747
## 
## $bio10
##       value   count
##  [1,]   -38     232
##  [2,]   -37    2562
##  [3,]   -36    4184
##  [4,]   -35    5513
##  [5,]   -34    6355
##  [6,]   -33    8056
##  [7,]   -32   10075
##  [8,]   -31    9909
##  [9,]   -30   11767
## [10,]   -29   11883
## [11,]   -28   12073
## [12,]   -27    9569
## [13,]   -26    9015
## [14,]   -25    8164
## [15,]   -24   10412
## [16,]   -23   10563
## [17,]   -22    6980
## [18,]   -21    7277
## [19,]   -20    8104
## [20,]   -19    6323
## [21,]   -18    5197
## [22,]   -17    5123
## [23,]   -16    5272
## [24,]   -15    4709
## [25,]   -14    4548
## [26,]   -13    5076
## [27,]   -12    6305
## [28,]   -11    7268
## [29,]   -10    6927
## [30,]    -9    5807
## [31,]    -8    5032
## [32,]    -7    4242
## [33,]    -6    3752
## [34,]    -5    3647
## [35,]    -4    3370
## [36,]    -3    3016
## [37,]    -2    3166
## [38,]    -1    3674
## [39,]     0    5606
## [40,]     1    4851
## [41,]     2    5133
## [42,]     3    4612
## [43,]     4    5726
## [44,]     5    7553
## [45,]     6    8557
## [46,]     7    9276
## [47,]     8   11558
## [48,]     9   14822
## [49,]    10   16413
## [50,]    11   19241
## [51,]    12   18592
## [52,]    13   19703
## [53,]    14   23614
## [54,]    15   24054
## [55,]    16   21424
## [56,]    17   17045
## [57,]    18   14723
## [58,]    19   13629
## [59,]    20   14378
## [60,]    21   14960
## [61,]    22   17207
## [62,]    23   19127
## [63,]    24   21443
## [64,]    25   25962
## [65,]    26   33787
## [66,]    27   36249
## [67,]    28   25302
## [68,]    29   16289
## [69,]    30   15960
## [70,]    31   15007
## [71,]    32   12516
## [72,]    33   10394
## [73,]    34    8073
## [74,]    35    5011
## [75,]    36    3330
## [76,]    37    1586
## [77,]    38     193
## [78,]    NA 1524747
## 
## $bio11
##       value   count
##  [1,]   -66    2233
##  [2,]   -65    4965
##  [3,]   -64    3370
##  [4,]   -63    3086
##  [5,]   -62    5031
##  [6,]   -61    6551
##  [7,]   -60    7371
##  [8,]   -59    5355
##  [9,]   -58    4571
## [10,]   -57    5605
## [11,]   -56    9178
## [12,]   -55    6908
## [13,]   -54    6315
## [14,]   -53    6092
## [15,]   -52    6235
## [16,]   -51    6155
## [17,]   -50    5976
## [18,]   -49    5568
## [19,]   -48    5316
## [20,]   -47    5500
## [21,]   -46    5322
## [22,]   -45    5423
## [23,]   -44    5948
## [24,]   -43    5996
## [25,]   -42    5775
## [26,]   -41    5495
## [27,]   -40    6335
## [28,]   -39    6945
## [29,]   -38    7161
## [30,]   -37    9550
## [31,]   -36   10041
## [32,]   -35   12751
## [33,]   -34   13197
## [34,]   -33   14151
## [35,]   -32   15008
## [36,]   -31   13050
## [37,]   -30   12692
## [38,]   -29   10425
## [39,]   -28    9019
## [40,]   -27   10248
## [41,]   -26   10117
## [42,]   -25    9856
## [43,]   -24    8640
## [44,]   -23    8867
## [45,]   -22    9964
## [46,]   -21    9537
## [47,]   -20    9335
## [48,]   -19    9289
## [49,]   -18    9215
## [50,]   -17   10253
## [51,]   -16   10407
## [52,]   -15   10033
## [53,]   -14    9265
## [54,]   -13    9066
## [55,]   -12    8680
## [56,]   -11    8196
## [57,]   -10    8083
## [58,]    -9    7153
## [59,]    -8    7453
## [60,]    -7    7378
## [61,]    -6    7721
## [62,]    -5    7189
## [63,]    -4    6775
## [64,]    -3    6687
## [65,]    -2    6871
## [66,]    -1    6908
## [67,]     0    8368
## [68,]     1    6992
## [69,]     2    6249
## [70,]     3    6166
## [71,]     4    6552
## [72,]     5    6240
## [73,]     6    6363
## [74,]     7    6389
## [75,]     8    7035
## [76,]     9    6142
## [77,]    10    6041
## [78,]    11    8152
## [79,]    12   10705
## [80,]    13   13900
## [81,]    14   11526
## [82,]    15    8450
## [83,]    16    9792
## [84,]    17   11792
## [85,]    18   11689
## [86,]    19   11177
## [87,]    20   12010
## [88,]    21   12192
## [89,]    22   12401
## [90,]    23   15330
## [91,]    24   18704
## [92,]    25   21787
## [93,]    26   21245
## [94,]    27    4983
## [95,]    28     755
## [96,]    29      75
## [97,]    NA 1524747
```

---

class: inverse, center, middle
# Operação espaciais

---

# 7.8 Operações espaciais

## Operações locais 

### Álgebra de raster 

```r
# sum
ra_rc2 &lt;- ra_rc + ra_rc
ra_rc2
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : layer 
## values     : 982, 1970  (min, max)
```

---

# 7.8 Operações espaciais

## Operações locais 

### Álgebra de raster 

```r
# plot
raster::plot(ra_rc2, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-87-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.8 Operações espaciais

## Operações locais 

### Álgebra de raster 

```r
# division
ra_rc_km &lt;- ra_rc / 1e3
ra_rc_km
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : elevation 
## values     : 0.491, 0.985  (min, max)
```

---

# 7.8 Operações espaciais

## Operações locais 

### Álgebra de raster 

```r
# plot
raster::plot(ra_rc_km, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-89-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.8 Operações espaciais

## Operações locais 

### Álgebra de raster 

```r
# log10
ra_rc_log10 &lt;- log10(ra_rc)
ra_rc_log10
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : layer 
## values     : 2.691081, 2.993436  (min, max)
```

---

# 7.8 Operações espaciais

## Operações locais 

### Álgebra de raster 

```r
# plot
raster::plot(ra_rc_log10, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-91-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.8 Operações espaciais

## Operações locais 

### Álgebra de raster por valor

```r
# upper 600
ra_rc_up_600 &lt;- ra_rc &gt; 600
ra_rc_up_600
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : layer 
## values     : 0, 1  (min, max)
```

---

# 7.8 Operações espaciais

## Operações locais 

### Álgebra de raster por valor

```r
# plot
raster::plot(ra_rc_up_600)
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-93-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.8 Operações espaciais

## Operações locais 

### Álgebra de raster por valor

```r
# bottom
ra_rc_bot_600 &lt;- ra_rc &lt;= 600
ra_rc_bot_600
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : layer 
## values     : 0, 1  (min, max)
```

---

# 7.8 Operações espaciais

## Operações locais 

### Álgebra de raster por valor

```r
# plot
raster::plot(ra_rc_bot_600)
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-95-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.8 Operações espaciais

## Operações locais 

### Alterar valores

```r
# values
ra_rc[]
```

```
##    [1] 859 856 856 856 853 852 852 852 850 848 847 847 846 846 847 847 849 849 849 849 845 840 836 834 833 835 837 837 839 841 843
##   [32] 847 850 854 857 863 863 865 865 866 868 870 872 875 874 876 876 875 876 882 880 871 869 867 865 861 859 854 850 849 844 844
##   [63] 844 844 844 844 844 844 844 842 846 846 845 846 848 848 848 849 850 852 855 857 861 861 863 864 862 859 860 864 862 859 854
##   [94] 852 844 836 832 825 820 817 814 809 805 798 790 771 742 717 701 687 678 680 679 673 661 658 657 655 654 670 686 692 684 691
##  [125] 698 686 666 652 661 675 680 695 706 711 714 719 724 723 724 729 740 747 754 755 758 755 745 729 699 676 662 659 656 653 642
##  [156] 631 624 618 615 604 594 592 592 596 599 595 590 589 587 586 587 591 599 608 619 625 627 621 622 627 619 602 601 605 614 617
##  [187] 621 611 603 595 586 579 576 590 607 619 629 630 617 608 614 621 617 612 603 596 589 588 592 593 587 581 578 576 579 590 599
##  [218] 601 602 600 600 599 600 597 598 605 609 612 616 619 613 616 631 641 653 673 689 701 705 701 697 694 690 688 684 682 675 669
##  [249] 662 657 657 652 650 646 644 643 641 643 643 641 647 656 664 672 674 677 684 697 707 717 721 715 709 700 690 683 674 665 658
##  [280] 656 655 655 644 640 649 657 656 650 649 642 642 644 649 651 656 662 668 674 679 679 675 667 663 667 676 687 693 695 701 710
##  [311] 717 722 725 737 750 755 756 750 743 730 723 710 700 696 694 687 684 685 685 684 678 680 679 681 679 680 681 676 668 665 668
##  [342] 669 671 679 686 687 686 684 681 676 675 674 670 666 665 671 678 686 690 693 697 700 703 706 852 853 852 852 851 851 849 845
##  [373] 845 843 843 844 843 845 845 845 846 847 848 847 844 839 833 831 832 835 839 841 842 840 840 843 847 852 856 861 861 861 863
##  [404] 866 868 872 873 877 877 874 872 870 872 877 872 868 867 867 865 863 862 859 853 848 844 842 839 840 841 844 843 842 842 840
##  [435] 843 841 844 846 845 845 847 848 849 851 855 856 860 861 864 861 855 855 856 857 857 855 847 845 839 835 830 826 821 814 812
##  [466] 810 802 792 774 752 728 712 697 690 693 695 694 688 678 668 662 658 649 654 673 673 663 682 695 685 669 659 671 699 711 717
##  [497] 726 734 744 749 750 749 749 759 773 793 805 797 786 777 760 747 717 693 674 658 649 643 640 630 617 613 610 605 596 591 596
##  [528] 605 605 599 598 592 587 587 592 600 605 607 611 619 626 626 624 628 618 615 627 627 630 625 620 611 600 588 580 576 575 582
##  [559] 590 603 619 634 630 621 617 616 614 609 607 601 592 586 584 585 582 575 575 575 577 585 597 601 604 602 600 598 595 593 594
##  [590] 600 608 613 623 625 621 623 633 640 655 682 693 705 709 702 698 699 698 695 690 688 683 675 669 667 663 658 656 653 647 643
##  [621] 642 641 639 642 650 659 667 676 680 684 688 698 708 714 719 717 712 697 684 675 674 669 664 661 658 653 643 635 638 647 647
##  [652] 643 642 642 643 649 657 663 667 669 675 683 687 684 683 676 673 668 673 685 690 697 707 714 722 734 744 747 754 758 756 751
##  [683] 739 729 716 707 702 701 700 696 687 683 683 684 687 687 685 680 674 671 672 669 666 670 678 680 678 685 689 692 691 688 684
##  [714] 678 678 675 671 668 665 668 671 679 684 686 690 696 700 703 850 850 849 849 849 848 847 843 842 841 839 840 842 843 842 844
##  [745] 844 846 847 845 841 836 834 830 831 833 838 842 841 839 837 841 845 851 856 858 860 863 867 871 872 873 868 869 868 869 868
##  [776] 868 868 872 874 867 865 865 865 865 864 859 855 851 845 841 837 837 841 841 842 840 838 840 838 837 839 842 844 845 845 847
##  [807] 848 849 854 858 861 862 861 857 853 851 851 855 855 854 847 843 839 833 830 826 819 815 813 806 801 791 772 748 731 714 708
##  [838] 706 711 711 708 701 695 689 680 673 657 645 648 653 656 674 685 676 666 673 688 707 731 751 761 764 773 776 779 780 789 810
##  [869] 822 828 834 835 829 797 768 750 722 697 676 663 645 635 629 627 614 606 601 598 594 597 603 612 611 608 604 595 592 590 591
##  [900] 597 605 614 620 625 632 638 633 633 633 638 647 643 631 621 609 614 613 596 581 575 574 574 577 589 605 618 621 620 618 617
##  [931] 613 612 611 608 599 591 588 581 577 575 574 573 576 583 593 598 600 596 592 588 590 595 602 609 614 619 628 633 630 631 633
##  [962] 639 653 677 694 705 707 706 705 704 704 700 700 697 692 687 680 674 670 664 661 659 652 644 640 640 637 642 649 657 664 673
##  [993] 679 686 692 702 711 717 721 720
##  [ reached getOption("max.print") -- omitted 133680 entries ]
```

---

# 7.8 Operações espaciais

## Operações locais 

### Alterar valores

```r
# copy
ra_rc_up_700 &lt;- ra_rc
ra_rc_up_700
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : elevation 
## values     : 491, 985  (min, max)
```

---

# 7.8 Operações espaciais

## Operações locais 

### Alterar valores

```r
# values bottom 700 == NA
ra_rc_up_700[ra_rc_up_700 &lt; 700] &lt;- NA
ra_rc_up_700
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : elevation 
## values     : 700, 985  (min, max)
```

---

# 7.8 Operações espaciais

## Operações locais 

### Alterar valores

```r
# plot
raster::plot(ra_rc_up_700, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-99-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_raster_reclass.gif)
background-size: 700px
background-position: 50% 70%

# 7.8 Operações espaciais

## Operações locais 

### Reclassify

---

# 7.8 Operações espaciais

## Operações locais 

### Reclassify

```r
# matrix for reclassification
rcl  &lt;- matrix(c(400,500,4, 
                 500,600,5, 
                 600,700,6,
                 700,800,7,
                 800,900,8,
                 900,1000,9), 
               ncol = 3, byrow = TRUE)
rcl
```

```
##      [,1] [,2] [,3]
## [1,]  400  500    4
## [2,]  500  600    5
## [3,]  600  700    6
## [4,]  700  800    7
## [5,]  800  900    8
## [6,]  900 1000    9
```

---

# 7.8 Operações espaciais

## Operações locais 

### Reclassify

```r
# reclassify
ra_rc_rcl &lt;- raster::reclassify(ra_rc, rcl = rcl)
ra_rc_rcl
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : elevation 
## values     : 4, 9  (min, max)
```

---

# 7.8 Operações espaciais

## Operações locais 

### Reclassify

```r
# plot
raster::plot(ra_rc_rcl, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-102-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_raster_focal.png)
background-size: 600px
background-position: 50% 70%

# 7.8 Operações espaciais

## Operação focal

### Moving window

---

background-image: url(img/geo_raster_moving_window.gif),url(img/geo_raster_focal.png)
background-size: 400px,600px
background-position: 20% 65%,50% 70%

# 7.8 Operações espaciais

## Operação focal

### Moving window

---

# 7.8 Operações espaciais

## Operação focal

### Moving window

```r
# moving window
ra_rc_mw_sd &lt;- raster::focal(ra_rc, w = matrix(1, nrow = 3, ncol = 3), fun = sd)
ra_rc_mw_sd
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : layer 
## values     : 0, 50.38959  (min, max)
```

---

# 7.8 Operações espaciais

## Operação focal

### Moving window

```r
# plot
raster::plot(ra_rc_mw_sd, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-104-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.8 Operações espaciais

## Operação zonal

```r
# zonal statistics
raster::zonal(ra_rc, ra_rc_rcl, fun = "mean")
```

```
##      zone     mean
## [1,]    4 497.5346
## [2,]    5 568.1564
## [3,]    6 638.7920
## [4,]    7 734.6626
## [5,]    8 832.1058
## [6,]    9 935.5577
```

---

# 7.8 Operações espaciais

## Operação zonal

```r
# zonal statistics
ra_rc_stats &lt;- data.frame(raster::zonal(ra_rc, ra_rc_rcl, fun = "summary"))
colnames(ra_rc_stats) &lt;- c("zone", "min", "1qt", "median", "mean", "3qt", "max")
ra_rc_stats
```

```
##   zone min 1qt median     mean   3qt max
## 1    4 491 496    498 497.5346 499.0 500
## 2    5 501 553    574 568.1564 589.0 600
## 3    6 601 618    635 638.7920 657.0 700
## 4    7 701 712    727 734.6626 753.0 800
## 5    8 801 817    832 832.1058 845.0 900
## 6    9 901 920    935 935.5577 946.5 985
```

---

class: inverse, center, middle
# Operações geométricas

---

background-image: url(img/geo_raster_resolution_diff.png)
background-size: 900px
background-position: 50% 50%

# 7.9 Operações geométricas

## Agregação e desagregação

---

background-image: url(img/geo_raster_aggregate.png)
background-size: 700px
background-position: 50% 70%

# 7.9 Operações geométricas

## Agregação e desagregação

---

background-image: url(img/geo_raster_long_lat_dist.gif)
background-size: 650px
background-position: 50% 90%

# 7.9 Operações geométricas

## Resolução - Relação de graus e distância em metros

---

# 7.9 Operações geométricas

## Agregação - aumenta o tamanho do pixel

```r
# resolution
res(ra_rc)[1]
```

```
## [1] 0.0008333333
```
--

```r
# aggregation - increases the pixel size of the raster
ra_rc_agg_mean &lt;- raster::aggregate(ra_rc, fact = 10, fun = "mean")
ra_rc_agg_mean
```

```
## class      : RasterLayer 
## dimensions : 37, 37, 1369  (nrow, ncol, ncell)
## resolution : 0.008333333, 0.008333333  (x, y)
## extent     : -47.765, -47.45667, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : elevation 
## values     : 500.03, 859.14  (min, max)
```

---

# 7.9 Operações geométricas

## Agregação

```r
# plot
raster::plot(ra_rc_agg_mean, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-109-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_raster_disaggregate.png)
background-size: 700px
background-position: 50% 70%

# 7.9 Operações geométricas

## Desagregação

---

# 7.9 Operações geométricas

## Desagregação - diminui o tamanho do pixel

```r
# resolution
res(ra_rc)[1]
```

```
## [1] 0.0008333333
```
--

```r
# disaggregate - decreases the pixel size of the raster
ra_rc_dis_bil &lt;- raster::disaggregate(ra_rc, fact = 2, fun = "bilinear")
ra_rc_dis_bil
```

```
## class      : RasterLayer 
## dimensions : 740, 728, 538720  (nrow, ncol, ncell)
## resolution : 0.0004166667, 0.0004166667  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : elevation 
## values     : 491, 985  (min, max)
```

---

# 7.9 Operações geométricas

## Desagregação

```r
# plot
raster::plot(ra_rc_dis_bil, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-112-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

class: inverse, center, middle
# Interações raster-vetor

---

background-image: url(img/geo_raster_crop_mask.png)
background-size: 800px
background-position: 50% 60%

# 7.10 Interações raster-vetor

## Raster cropping

---

# 7.10 Interações raster-vetor

## Raster cropping

### Crop

```r
# crop - adjust extension
ra_rc_crop &lt;- raster::crop(ra, rc_2019)
ra_rc_crop
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : srtm_27_17 
## values     : 491, 985  (min, max)
```

---

# 7.10 Interações raster-vetor

## Raster cropping

### Crop

```r
# plot
raster::plot(ra_rc_crop, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-114-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.10 Interações raster-vetor

## Raster cropping

### Mask

```r
# mask - adjust limit
ra_rc_mask &lt;- raster::mask(ra, rc_2019)
ra_rc_mask
```

```
## class      : RasterLayer 
## dimensions : 6000, 6000, 3.6e+07  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -50, -45, -25, -20  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : srtm_27_17 
## values     : 497, 860  (min, max)
```

---

# 7.10 Interações raster-vetor

## Raster cropping

### Mask

```r
# plot
raster::plot(ra_rc_mask, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-116-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.10 Interações raster-vetor

## Raster cropping

### Crop and Mask

```r
# crop and mask - adjust extension and limit
ra_rc_crop_mask &lt;- ra %&gt;% 
  raster::crop(rc_2019) %&gt;% 
  raster::mask(rc_2019)
ra_rc_crop_mask
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : srtm_27_17 
## values     : 497, 860  (min, max)
```

---

# 7.10 Interações raster-vetor

## Raster cropping

### Crop and Mask

```r
# plot
raster::plot(ra_rc_crop_mask, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-118-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.10 Interações raster-vetor

## Raster cropping

### Crop and Mask inverse

```r
# crop and mask inverse - adjust extension and limit
ra_rc_crop_mask_inv &lt;- ra %&gt;% 
  raster::crop(rc_2019) %&gt;% 
  raster::mask(rc_2019, inverse = TRUE)
ra_rc_crop_mask_inv
```

```
## class      : RasterLayer 
## dimensions : 370, 364, 134680  (nrow, ncol, ncell)
## resolution : 0.0008333333, 0.0008333333  (x, y)
## extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : srtm_27_17 
## values     : 491, 985  (min, max)
```

---

# 7.10 Interações raster-vetor

## Raster cropping

### Crop and Mask inverse

```r
# plot
raster::plot(ra_rc_crop_mask_inv, col = viridis::viridis(10))
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-120-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.10 Interações raster-vetor

## Raster cropping

### Crop and Mask

```r
# download atlantic forest
af &lt;- geobr::read_biomes(year = 2004, showProgress = FALSE) %&gt;% 
  dplyr::filter(name_biome == "Mata Atlântica")
af
```

```
## Simple feature collection with 1 feature and 4 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -55.6635 ymin: -29.9515 xmax: -28.8405 ymax: 0.8254
## geographic CRS: SIRGAS 2000
##   code_biome     name_biome ID1 year                           geom
## 1        MAT Mata Atlântica   6 2004 MULTIPOLYGON (((-29.3661 0....
```

---

# 7.10 Interações raster-vetor

## Raster cropping

### Crop and Mask

```r
# plot
plot(af$geom, col = "gray", main = NA, axes = TRUE, gratidule = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-122-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.10 Interações raster-vetor

## Raster cropping

### Crop and Mask

```r
# crop and mask - adjust extension and limit
st_af_crop_mask &lt;- st %&gt;% 
  raster::crop(af) %&gt;% 
  raster::mask(af)
st_af_crop_mask
```

```
## class      : RasterBrick 
## dimensions : 185, 161, 29785, 19  (nrow, ncol, ncell, nlayers)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -55.66667, -28.83333, -30, 0.8333333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      :      bio01,      bio10,      bio11,      bio12,      bio13,      bio14,      bio15,      bio16,      bio17,      bio18,      bio19,      bio02,      bio03,      bio04,      bio05, ... 
## min values :  13.148541,  16.710209,   9.684667, 548.000000,  63.000000,   2.000000,   5.869632, 171.000000,  11.000000,  90.000000,  11.000000,   5.807735,  45.740639,  95.181488,  21.779499, ... 
## max values :   26.04424,   27.15365,   24.60201, 2782.00000,  364.00000,  155.00000,   93.85548, 1016.00000,  520.00000, 1016.00000,  790.00000,   13.92485,   76.95371,  406.24945,   32.58175, ...
```

---

# 7.10 Interações raster-vetor

## Raster cropping

### Crop and Mask

```r
# plot
raster::plot(st_af_crop_mask[[1:4]], col = viridis::viridis(10))
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-124-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.10 Interações raster-vetor

## Raster extraction

### Importar pontos

```r
# import points
rc_spr &lt;- sf::st_read(here::here("03_dados", "vetor", "SP_3543907_NASCENTES.shp"), quiet = TRUE) %&gt;% 
  sf::st_transform(crs = 4326)
rc_spr
```

```
## Simple feature collection with 1220 features and 5 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -47.74126 ymin: -22.54837 xmax: -47.46367 ymax: -22.24496
## geographic CRS: WGS 84
## First 10 features:
##    GEOCODIGO MUNICIPIO UF CD_UF    HIDRO                    geometry
## 1    3543907 RIO CLARO SP    35 nascente POINT (-47.74126 -22.32786)
## 2    3543907 RIO CLARO SP    35 nascente POINT (-47.73922 -22.32981)
## 3    3543907 RIO CLARO SP    35 nascente POINT (-47.73773 -22.32894)
## 4    3543907 RIO CLARO SP    35 nascente POINT (-47.73481 -22.32868)
## 5    3543907 RIO CLARO SP    35 nascente POINT (-47.73384 -22.30751)
## 6    3543907 RIO CLARO SP    35 nascente POINT (-47.73384 -22.33055)
## 7    3543907 RIO CLARO SP    35 nascente  POINT (-47.73264 -22.3266)
## 8    3543907 RIO CLARO SP    35 nascente   POINT (-47.732 -22.30701)
## 9    3543907 RIO CLARO SP    35 nascente POINT (-47.73196 -22.32892)
## 10   3543907 RIO CLARO SP    35 nascente POINT (-47.72989 -22.31052)
```

---

# 7.10 Interações raster-vetor

## Raster extraction

### Importar pontos

```r
# plot
plot(rc_spr$geometry, pch = 20, col = "blue", main = NA, axes = TRUE, graticule = TRUE)
plot(rc_2019$geom, add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-126-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.10 Interações raster-vetor

## Raster extraction

### Extração

```r
# extraction
rc_spr_ele &lt;- raster::extract(ra_rc, rc_spr)
rc_spr_ele
```

```
##    [1] 730 716 718 704 672 715 720 670 715 662 701 688 713 676 709 679 690 673 698 674 694 658 661 668 694 683 687 671 684 677 675
##   [32] 667 675 669 656 666 647 660 661 660 657 667 645 658 650 661 645 675 663 658 654 669 687 643 663 663 610 624 648 666 659 672
##   [63] 672 616 674 646 654 652 668 646 670 635 654 660 626 659 629 639 661 641 637 650 632 650 637 650 685 646 636 631 640 626 655
##   [94] 643 630 654 627 642 678 634 642 620 638 619 641 656 656 643 642 652 674 629 628 653 640 624 632 632 624 650 639 648 651 630
##  [125] 643 649 625 654 646 614 615 638 626 589 615 626 602 620 606 602 623 635 628 614 597 635 631 654 645 657 592 642 613 654 629
##  [156] 636 629 625 607 618 661 614 663 667 641 636 527 635 646 612 644 646 645 579 662 609 628 656 648 669 650 652 642 660 659 631
##  [187] 657 659 660 569 606 565 655 644 655 615 598 558 660 667 587 566 605 609 527 580 524 637 636 636 586 617 618 585 661 601 622
##  [218] 603 602 586 646 583 658 524 647 612 629 591 633 567 636 613 534 526 610 630 635 612 631 637 617 621 535 652 651 646 525 516
##  [249] 634 636 629 641 584 596 585 634 644 589 603 632 637 639 642 618 556 641 588 659 547 634 628 649 634 637 619 607 649 601 637
##  [280] 655 597 593 604 548 602 548 649 601 643 591 535 599 631 599 607 606 545 628 594 562 598 637 608 635 606 632 562 630 638 643
##  [311] 597 600 593 614 605 602 648 614 542 598 648 628 636 623 616 605 618 593 614 626 536 643 544 545 621 591 594 601 630 546 542
##  [342] 563 628 595 609 622 544 561 595 571 579 524 606 621 608 592 562 652 536 547 538 603 606 601 559 558 593 602 571 613 616 573
##  [373] 578 565 618 618 567 645 651 616 531 572 600 621 581 632 543 586 598 639 536 640 576 535 639 649 621 583 623 609 624 655 583
##  [404] 622 593 631 636 592 631 614 574 545 594 622 584 606 548 588 631 573 628 623 624 617 624 602 639 617 623 605 613 627 623 642
##  [435] 623 652 604 578 604 607 625 622 563 537 631 620 617 638 605 623 611 636 623 613 554 638 554 569 695 571 575 582 620 606 524
##  [466] 642 623 694 595 562 624 621 607 597 579 522 500 594 608 624 586 587 594 599 615 677 603 617 622 617 631 585 617 600 631 622
##  [497] 614 657 641 672 577 689 641 578 614 591 663 594 626 604 622 592 630 610 624 566 575 584 619 634 575 619 554 614 589 550 562
##  [528] 602 588 689 629 702 617 608 568 599 622 611 581 610 614 559 585 599 599 552 583 634 582 626 596 637 610 624 625 603 668 623
##  [559] 628 565 619 596 636 624 624 591 640 628 604 594 681 624 588 591 567 606 630 628 547 589 589 569 594 628 606 590 575 610 614
##  [590] 561 591 577 593 598 620 625 610 628 552 580 608 549 552 589 635 562 585 604 603 634 571 538 634 629 611 582 588 558 581 562
##  [621] 576 576 635 580 618 604 636 645 598 557 556 585 646 584 568 616 597 605 580 564 570 624 578 584 588 624 603 567 624 622 589
##  [652] 638 582 596 601 537 641 627 560 561 584 595 604 537 572 542 592 637 576 599 555 628 636 621 649 529 584 546 619 588 584 542
##  [683] 571 554 601 562 623 599 580 573 609 652 611 595 617 556 635 594 594 571 617 621 619 614 608 548 599 653 623 651 578 559 608
##  [714] 531 572 535 646 622 569 591 584 580 598 581 597 647 584 591 564 589 579 597 551 595 589 640 646 607 590 595 614 633 595 597
##  [745] 642 645 593 609 633 583 575 605 644 615 649 595 597 601 590 573 612 597 643 570 589 603 552 587 586 614 639 593 603 571 554
##  [776] 606 590 598 632 599 645 623 635 624 616 635 610 623 549 600 554 554 550 639 629 620 598 605 608 602 558 568 612 645 555 577
##  [807] 572 572 591 565 566 595 620 622 573 626 625 607 600 589 570 625 609 587 614 614 568 606 619 613 618 610 614 584 624 571 595
##  [838] 602 615 582 619 609 601 598 565 573 610 644 597 621 630 591 556 574 570 630 589 627 643 607 600 621 559 594 601 594 607 620
##  [869] 612 554 565 607 613 627 614 564 574 632 590 624 607 617 593 602 597 614 561 604 592 615 602 614 593 623 620 592 605 550 599
##  [900] 619 598 658 658 603 691 593 562 644 616 631 592 614 610 591 596 654 651 617 610 698 572 561 659 564 579 594 667 691 612 598
##  [931] 698 560 577 653 656 617 699 598 641 619 583 602 601 617 591 670 665 643 622 590 611 584 684 665 704 607 688 671 706 686 609
##  [962] 642 725 582 614 687 662 610 677 709 689 672 599 612 673 614 599 675 583 629 633 628 600 694 608 636 595 580 673 674 642 669
##  [993] 645 638 600 600 670 605 641 648
##  [ reached getOption("max.print") -- omitted 220 entries ]
```

---

# 7.10 Interações raster-vetor

## Raster extraction

### Extração

```r
# extraction
rc_spr_ele &lt;- rc_spr %&gt;% 
  dplyr::mutate(elev = raster::extract(ra_rc, .))
rc_spr_ele
```

```
## Simple feature collection with 1220 features and 6 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -47.74126 ymin: -22.54837 xmax: -47.46367 ymax: -22.24496
## geographic CRS: WGS 84
## First 10 features:
##    GEOCODIGO MUNICIPIO UF CD_UF    HIDRO                    geometry elev
## 1    3543907 RIO CLARO SP    35 nascente POINT (-47.74126 -22.32786)  730
## 2    3543907 RIO CLARO SP    35 nascente POINT (-47.73922 -22.32981)  716
## 3    3543907 RIO CLARO SP    35 nascente POINT (-47.73773 -22.32894)  718
## 4    3543907 RIO CLARO SP    35 nascente POINT (-47.73481 -22.32868)  704
## 5    3543907 RIO CLARO SP    35 nascente POINT (-47.73384 -22.30751)  672
## 6    3543907 RIO CLARO SP    35 nascente POINT (-47.73384 -22.33055)  715
## 7    3543907 RIO CLARO SP    35 nascente  POINT (-47.73264 -22.3266)  720
## 8    3543907 RIO CLARO SP    35 nascente   POINT (-47.732 -22.30701)  670
## 9    3543907 RIO CLARO SP    35 nascente POINT (-47.73196 -22.32892)  715
## 10   3543907 RIO CLARO SP    35 nascente POINT (-47.72989 -22.31052)  662
```

---

# 7.10 Interações raster-vetor

## Raster extraction

### Extração

```r
# plot
plot(rc_spr_ele["elev"], pch = 20, main = NA, axes = TRUE, graticule = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-129-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.10 Interações raster-vetor

## Raster extraction

### Extração

```r
# histogram
rc_spr_ele %&gt;% 
  dplyr::pull(elev) %&gt;% 
  hist(col = "steelblue", border = "white", main = NA, xlab = "Elevação (m)", ylab = "Frequência")
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-130-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.10 Interações raster-vetor

## Zonal statistics

### Buffers

```r
# buffers
set.seed(42)
rc_spr_buf &lt;- rc_spr %&gt;% 
  dplyr::sample_n(10) %&gt;% 
  sf::as_Spatial() %&gt;% 
  raster::buffer(width = 1000, dissolve = FALSE) %&gt;% 
  sf::st_as_sf()
rc_spr_buf
```

```
## Simple feature collection with 10 features and 5 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -47.73232 ymin: -22.44296 xmax: -47.47012 ymax: -22.2435
## geographic CRS: WGS 84 (with axis order normalized for visualization)
##    GEOCODIGO MUNICIPIO UF CD_UF    HIDRO                       geometry
## 1    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.61015 -22.355...
## 2    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.638 -22.3553,...
## 3    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.47966 -22.339...
## 4    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.50825 -22.374...
## 5    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.48058 -22.243...
## 6    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.60273 -22.424...
## 7    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.71117 -22.323...
## 8    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.48795 -22.362...
## 9    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.72244 -22.325...
## 10   3543907 RIO CLARO SP    35 nascente POLYGON ((-47.63349 -22.363...
```

---

# 7.10 Interações raster-vetor

## Zonal statistics

### Buffers

```r
# plot
plot(rc_spr_buf$geometry, col = adjustcolor("steelblue", .7), pch = 20, main = NA, axes = TRUE, graticule = TRUE)
plot(rc_2019$geom, add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-132-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.10 Interações raster-vetor

## Zonal statistics

### Buffers

```r
# zonal statistics
raster::extract(x = ra_rc, y = rc_spr_buf, fun = mean, na.rm = TRUE, df = TRUE)
```

```
##    ID elevation
## 1   1  601.4461
## 2   2  617.4470
## 3   3  656.2843
## 4   4  646.9322
## 5   5  699.5970
## 6   6  577.2166
## 7   7  650.4125
## 8   8  643.0127
## 9   9  659.5418
## 10 10  594.8601
```

---

# 7.10 Interações raster-vetor

## Zonal statistics

### Buffers

```r
# zonal statistics
rc_spr_buf &lt;- rc_spr_buf %&gt;% 
  dplyr::mutate(elev_mean = raster::extract(x = ra_rc, y = rc_spr_buf, fun = mean, na.rm = TRUE))
rc_spr_buf
```

```
## Simple feature collection with 10 features and 6 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -47.73232 ymin: -22.44296 xmax: -47.47012 ymax: -22.2435
## geographic CRS: WGS 84 (with axis order normalized for visualization)
##    GEOCODIGO MUNICIPIO UF CD_UF    HIDRO                       geometry elev_mean
## 1    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.61015 -22.355...  601.4461
## 2    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.638 -22.3553,...  617.4470
## 3    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.47966 -22.339...  656.2843
## 4    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.50825 -22.374...  646.9322
## 5    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.48058 -22.243...  699.5970
## 6    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.60273 -22.424...  577.2166
## 7    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.71117 -22.323...  650.4125
## 8    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.48795 -22.362...  643.0127
## 9    3543907 RIO CLARO SP    35 nascente POLYGON ((-47.72244 -22.325...  659.5418
## 10   3543907 RIO CLARO SP    35 nascente POLYGON ((-47.63349 -22.363...  594.8601
```

---

# 7.10 Interações raster-vetor

## Zonal statistics

### Buffers

```r
# plot
plot(rc_spr_buf["elev_mean"], pch = 20, main = NA, axes = TRUE, graticule = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-135-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

class: inverse, center, middle
# Conversões raster-vetor

---

background-image: url(img/geo_data_convert.png)
background-size: 500px
background-position: 50% 50%

# 7.11 Conversões raster-vetor

---

# 7.11 Conversões raster-vetor

## Rasterização de pontos

```r
# rasterize points
rc_spr_rast &lt;- raster::rasterize(x = rc_spr, y = ra_rc_agg_mean, field = 1, fun = "count")
rc_spr_rast
```

```
## class      : RasterLayer 
## dimensions : 37, 37, 1369  (nrow, ncol, ncell)
## resolution : 0.008333333, 0.008333333  (x, y)
## extent     : -47.765, -47.45667, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : layer 
## values     : 1, 15  (min, max)
```

---

# 7.11 Conversões raster-vetor

## Rasterização de pontos

```r
# plot
raster::plot(rc_spr_rast, col = viridis::viridis(10))
plot(rc_spr$geometry, pch = 20, cex = 1, col = adjustcolor("gray50", .6), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-137-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

class: inverse, center, middle
# Será que existe relação entre a elevação e o número de nascentes?

---

# 7.11 Conversões raster-vetor

## Estatística

```r
# statistics
plot(ra_rc_agg_mean[], rc_spr_rast[], col = adjustcolor("gray30", .5), 
     pch = 20, cex = 1.5, bty = "l", xlab = "Elevação (m)", ylab = "Número de nascentes")
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-138-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.11 Conversões raster-vetor

## Rasterização de polígonos

```r
# import polygons
rc_use &lt;- sf::st_read(here::here("03_dados", "vetor", "SP_3543907_USO.shp"), quiet = TRUE) %&gt;% 
  dplyr::mutate(CLASSE_USO = as.factor(CLASSE_USO)) %&gt;% 
  sf::st_transform(crs = 4326)
rc_use
```

```
## Simple feature collection with 5 features and 6 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -47.76536 ymin: -22.55207 xmax: -47.46161 ymax: -22.24368
## geographic CRS: WGS 84
##   GEOCODIGO MUNICIPIO UF CD_UF         CLASSE_USO   AREA_HA                       geometry
## 1   3543907 RIO CLARO SP    35               água   357.027 MULTIPOLYGON (((-47.56643 -...
## 2   3543907 RIO CLARO SP    35   área antropizada 37297.800 MULTIPOLYGON (((-47.60317 -...
## 3   3543907 RIO CLARO SP    35     área edificada  5078.330 MULTIPOLYGON (((-47.58953 -...
## 4   3543907 RIO CLARO SP    35 formação florestal  7017.990 MULTIPOLYGON (((-47.60238 -...
## 5   3543907 RIO CLARO SP    35       silvicultura   138.173 MULTIPOLYGON (((-47.49338 -...
```

---

# 7.11 Conversões raster-vetor

## Rasterização de polígonos

```r
# rasterize polygons
rc_use_rast &lt;- raster::rasterize(x = rc_use, y = ra_rc_agg_mean, field = "CLASSE_USO")
rc_use_rast
```

```
## class      : RasterLayer 
## dimensions : 37, 37, 1369  (nrow, ncol, ncell)
## resolution : 0.008333333, 0.008333333  (x, y)
## extent     : -47.765, -47.45667, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : layer 
## values     : 1, 5  (min, max)
```

---

# 7.11 Conversões raster-vetor

## Rasterização de polígonos

```r
# plot
raster::plot(rc_use_rast, col = viridis::viridis(10))
plot(rc_use$geom, add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-141-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# 7.11 Conversões raster-vetor

## Rasterização de polígonos

### Fasterize

```r
# package fasterize
# install.packages("fasterize")
library(fasterize)
```

---

# 7.11 Conversões raster-vetor

## Rasterização de polígonos

### Fasterize

```r
# rasterize with fasterize
rc_use_fast &lt;- fasterize::fasterize(sf = rc_use, raster = ra_rc_agg_mean, field = "CLASSE_USO")
rc_use_fast
```

```
## class      : RasterLayer 
## dimensions : 37, 37, 1369  (nrow, ncol, ncell)
## resolution : 0.008333333, 0.008333333  (x, y)
## extent     : -47.765, -47.45667, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : layer 
## values     : 1, 5  (min, max)
```

---

# 7.11 Conversões raster-vetor

## Rasterização de polígonos

### Fasterize

```r
# plot
raster::plot(rc_use_fast, col = viridis::viridis(10))
plot(rc_use$geom, add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-144-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_raster_vectorization_points.png)
background-size: 700px
background-position: 50% 70%

# 7.11 Conversões raster-vetor

## Vetorização - Raster para pontos

---

# 7.11 Conversões raster-vetor

## Vetorização - Raster para pontos

```r
# vectorization points
ra_rc_agg_mean_points = raster::rasterToPoints(ra_rc_agg_mean, spatial = TRUE) %&gt;% 
  sf::st_as_sf()
ra_rc_agg_mean_points
```

```
## Simple feature collection with 1369 features and 1 field
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -47.76083 ymin: -22.5475 xmax: -47.46083 ymax: -22.2475
## CRS:            +proj=longlat +datum=WGS84 +no_defs
## First 10 features:
##    elevation                   geometry
## 1     842.41 POINT (-47.76083 -22.2475)
## 2     837.64  POINT (-47.7525 -22.2475)
## 3     832.85 POINT (-47.74417 -22.2475)
## 4     852.08 POINT (-47.73583 -22.2475)
## 5     859.14  POINT (-47.7275 -22.2475)
## 6     854.19 POINT (-47.71917 -22.2475)
## 7     816.84 POINT (-47.71083 -22.2475)
## 8     840.05  POINT (-47.7025 -22.2475)
## 9     851.15 POINT (-47.69417 -22.2475)
## 10    831.51 POINT (-47.68583 -22.2475)
```

---

# 7.11 Conversões raster-vetor

## Vetorização - Raster para pontos

```r
# plot
raster::plot(ra_rc_agg_mean, col = viridis::viridis(10))
plot(ra_rc_agg_mean_points, pch = 20, main = FALSE, add = TRUE)
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-146-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_raster_vectorization_lines_contour.png)
background-size: 800px
background-position: 50% 70%

# 7.11 Conversões raster-vetor

## Vetorização - Raster para linhas

---

# 7.11 Conversões raster-vetor

## Vetorização - Raster para linhas

```r
# vectorization points
ra_rc_agg_mean_lines = raster::rasterToContour(ra_rc_agg_mean) %&gt;% 
  sf::st_as_sf()
ra_rc_agg_mean_lines
```

```
## Simple feature collection with 7 features and 1 field
## geometry type:  MULTILINESTRING
## dimension:      XY
## bbox:           xmin: -47.76083 ymin: -22.5475 xmax: -47.46083 ymax: -22.2475
## CRS:            +proj=longlat +datum=WGS84 +no_defs
##     level                       geometry
## C_1   550 MULTILINESTRING ((-47.70684...
## C_2   600 MULTILINESTRING ((-47.76083...
## C_3   650 MULTILINESTRING ((-47.76083...
## C_4   700 MULTILINESTRING ((-47.76083...
## C_5   750 MULTILINESTRING ((-47.76083...
## C_6   800 MULTILINESTRING ((-47.76083...
## C_7   850 MULTILINESTRING ((-47.71823...
```

---

# 7.11 Conversões raster-vetor

## Vetorização - Raster para linhas

```r
# plot
raster::plot(ra_rc_agg_mean, col = viridis::viridis(10))
plot(ra_rc_agg_mean_lines$geometry, col = "white", pch = 20, lwd = 2, main = FALSE, add = TRUE)
plot(rc_2019$geom, col = adjustcolor("red", .2), add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-148-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

background-image: url(img/geo_raster_vectorization_polygons.png)
background-size: 800px
background-position: 50% 70%

# 7.11 Conversões raster-vetor

## Vetorização - Raster para polígonos

---

# 7.11 Conversões raster-vetor

## Vetorização - Raster para polígonos

```r
# vectorization polygons
rc_use_fast_polygon &lt;- raster::rasterToPolygons(rc_use_fast) %&gt;% 
  sf::st_as_sf() %&gt;% 
  dplyr::group_by(layer) %&gt;% 
  summarise()
rc_use_fast_polygon
```

```
## Simple feature collection with 5 features and 1 field
## geometry type:  GEOMETRY
## dimension:      XY
## bbox:           xmin: -47.765 ymin: -22.55167 xmax: -47.465 ymax: -22.24333
## CRS:            +proj=longlat +datum=WGS84 +no_defs
## # A tibble: 5 x 2
##   layer                                                                                             geometry
##   &lt;dbl&gt;                                                                                       &lt;GEOMETRY [°]&gt;
## 1     1 MULTIPOLYGON (((-47.64833 -22.51, -47.64 -22.51, -47.64 -22.51833, -47.64833 -22.51833, -47.64833...
## 2     2 MULTIPOLYGON (((-47.57333 -22.535, -47.57333 -22.54333, -47.58167 -22.54333, -47.59 -22.54333, -4...
## 3     3 MULTIPOLYGON (((-47.59 -22.49333, -47.58167 -22.49333, -47.58167 -22.50167, -47.59 -22.50167, -47...
## 4     4 MULTIPOLYGON (((-47.57333 -22.51833, -47.565 -22.51833, -47.565 -22.52667, -47.57333 -22.52667, -...
## 5     5 POLYGON ((-47.49833 -22.26, -47.49 -22.26, -47.49 -22.26833, -47.49833 -22.26833, -47.49833 -22.26))
```

---

# 7.11 Conversões raster-vetor

## Vetorização - Raster para polígonos

```r
# plot
raster::plot(rc_use_fast, col = viridis::viridis(10))
plot(rc_use_fast_polygon, col = viridis::viridis(5), pch = 20, lwd = 2, main = FALSE, add = TRUE)
```

&lt;img src="07_pres_intro_geocomp_r_files/figure-html/unnamed-chunk-150-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

class: inverse, center, middle
# Exportar rasters

---

background-image: url(img/geo_raster_single_raster.png)
background-size: 350px
background-position: 50% 80%

# 7.12 Exportar dados matriciais

## Exportar raster

```r
# export raster
raster::writeRaster(x = ra_rc, 
                    filename = here::here("03_dados", "raster", "srtm_27_17_rc"),
                    format = "GTiff",
                    progress = "text",
                    overwrite = TRUE)
```

---

background-image: url(img/geo_raster_multi_raster.png)
background-size: 350px
background-position: 50% 80%

# 7.12 Exportar dados matriciais

## Exportar stack ou brick

```r
# export stack
raster::writeRaster(x = st_af_crop_mask, 
                    filename = here::here("03_dados", "raster", names(st_af_crop_mask)), 
                    bylayer = TRUE, 
                    format = "GTiff",
                    progress = "text",
                    overwrite = TRUE)
```

---

class: inverse, middle, center

# Dúvidas?

---

class: clear, middle

## Maurício Vancine

&lt;br&gt;

Contatos:

&lt;br&gt;
<i class="fas  fa-envelope " style="color:#0000ee;"></i> [mauricio.vancine@gmail.com]()
&lt;br&gt;
<i class="fab  fa-twitter " style="color:#0000ee;"></i> [@mauriciovancine](https://twitter.com/mauriciovancine)
&lt;br&gt;
<i class="fab  fa-github " style="color:#0000ee;"></i> [mauriciovancine](https://mauriciovancine.netlify.com/)
&lt;br&gt;
<i class="fas  fa-link " style="color:#0000ee;"></i> [mauriciovancine.netlify.com](https://mauriciovancine.netlify.com/)

Slides criados via pacote [xaringan](https://github.com/yihui/xaringan) e tema [Metropolis](https://github.com/pat-s/xaringan-metropolis)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "rainbow",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
