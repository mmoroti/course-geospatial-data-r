<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introdu√ß√£o ao uso de dados geoespaciais no R    </title>
    <meta charset="utf-8" />
    <meta name="author" content="Maur√≠cio H. Vancine   Milton C. Ribeiro" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introdu√ß√£o ao uso de dados geoespaciais no R <br><br><br>
## 4 Introdu√ß√£o ao tidyverse
### Maur√≠cio H. Vancine <br> Milton C. Ribeiro
### UNESP - Rio Claro <br> Laborat√≥rio de Ecologia Espacial e Conserva√ß√£o (LEEC)
### 25/10/2021-05/11/2021

---




class: clear
background-image: url(img/general_data_science_r4ds.png)
background-size: 800px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/package_tidyverse.png)
background-size: 300px
background-position: 85% 75%

# 4 Introdu√ß√£o ao tidyverse

## Conte√∫do

1. Contextualiza√ß√£o
1. tidyverse
1. here
1. readr, readxl e writexl
1. tibble
1. magrittr (pipe - %&gt;%)
1. tidyr
1. dplyr
1. stringr
1. forcats
1. lubridate
1. purrr

&lt;br&gt;
[tidyverse](https://www.tidyverse.org/)

---

# 4 tidyverse

## Script

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

## .center[`04_script_intro_geoespacial_r.R`]

---

background-image: url(img/tidyverse-default.png)
background-size: 500px
background-position: 90% 80%

# 1. Contextualiza√ß√£o

## Descri√ß√£o

### O tidyverse √© um **conjunto de pacotes** designados para **Data Science**

--

### Todos os pacotes compartilham uma **filosofia** de design, gram√°tica e estruturas de dados

--

### √â um **"dialeto"** novo para a linguagem R

--

### **tidy**: organizado, arrumado, ordenado
### **verse**: universo

&lt;br&gt;&lt;br&gt;
[What is the tidyverse?](https://rviews.rstudio.com/2017/06/08/what-is-the-tidyverse/)

---

class: inverse, center
background-image: url(img/gif_avenger_reference.gif)
background-size: 800px

# Iniciativa Vingadores do R

---

background-image: url(img/general_data_science.png)
background-size: 900px
background-position: 50% 60%

# 1. Contextualiza√ß√£o

## Fluxo de trabalho

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Wickham &amp; Grolemund (2017)](https://r4ds.had.co.nz/)

---

background-image: url(img/tidyverse_flow.png)
background-size: 650px
background-position: 50% 60%

# 1. Contextualiza√ß√£o

## Pacotes

---

background-image: url(img/tidyverse_packages.png)
background-size: 650px
background-position: 50% 60%

# 1. Contextualiza√ß√£o

## Pacotes e suas fun√ß√µes

---

background-image: url(img/person_hadley_wickham.jpg)
background-size: 550px
background-position: 50% 60%

# 1. Contextualiza√ß√£o

### O idealizador foi o **Hadley Wickham** e atualmente **muitas pessoas** t√™m contribu√≠do para sua expans√£o

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Hadley Wickham](http://hadley.nz/)

---

background-image: url(img/tidyverse_papers.png)
background-size: 400px
background-position: 50% 90%

# 1. Contextualiza√ß√£o

## Artigos

&gt; - Wickham, Hadley. ["Tidy data."](https://www.jstatsoft.org/article/view/v059i10) Journal of Statistical Software 59.10 (2014): 1-23.

&gt; - Wickham, Hadley, et al. ["Welcome to the Tidyverse."](https://joss.theoj.org/papers/10.21105/joss.01686) Journal of Open Source Software 4.43 (2019): 1686.

---

background-image: url(img/cover_data_science_r.png)
background-size: 300px
background-position: 50% 55%

# 1. Contextualiza√ß√£o

## R for Data Science (2017)

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Wickham &amp; Grolemund (2017)](https://r4ds.had.co.nz/)

---

background-image: url(img/tidyverse_site1.png)
background-size: 800px
background-position: 50% 50%

# 1. Contextualiza√ß√£o

## Sites

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[tidyverse](https://www.tidyverse.org/)

---

background-image: url(img/tidyverse_site2.png)
background-size: 800px
background-position: 50% 50%

# 1. Contextualiza√ß√£o

## Sites

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[R para data science](https://rpubs.com/modelthinkingbr/dados)

---

class: clear
background-image: url(img/package_tidyverse.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[tidyverse](https://tidyverse.tidyverse.org/)

---

# 2. tidyverse

## Descri√ß√£o

### Para utilizar os pacotes do **tidyverse** √© preciso instalar e carregar o pacote `tidyverse`


```r
# instalar pacote
install.packages("tidyverse")
```


```r
# carregar pacote
library(tidyverse)
```

---

# 2. tidyverse

## Listar todos os pacotes do tidyverse


```r
# listar todos os pacotes no tidyverse 
tidyverse::tidyverse_packages(include_self = TRUE)
```

```
##  [1] "broom"         "cli"           "crayon"        "dbplyr"        "dplyr"         "dtplyr"        "forcats"       "googledrive"  
##  [9] "googlesheets4" "ggplot2"       "haven"         "hms"           "httr"          "jsonlite"      "lubridate"     "magrittr"     
## [17] "modelr"        "pillar"        "purrr"         "readr"         "readxl"        "reprex"        "rlang"         "rstudioapi"   
## [25] "rvest"         "stringr"       "tibble"        "tidyr"         "xml2"          "tidyverse"
```

---

background-image: url(img/code_snake_case.png)
background-size: 500px
background-position: 80% 80%

# 2. tidyverse

## Sintaxe

### Todas as fun√ß√µes dos pacotes **tidyverse** usam fonte min√∫scula e usam `_` para separar os nomes internos das fun√ß√µes (snake_case)

&lt;br&gt;

`read_csv()`

`read_xlsx()`

`as_tibble()`

`left_join()`

`group_by()`

---

background-image: url(img/code_snake_case.png)
background-size: 500px
background-position: 80% 80%

# 2. tidyverse

## Sintaxe

### √â interessante **indicar de quais pacotes as fun√ß√µes** s√£o utilizadas (`pacote::fun√ß√£o`), para **evitar erros** com fun√ß√µes de outros pacotes

&lt;br&gt;

`readr::read_csv()`

`readxl::read_xlsx()`

`tibble::as_tibble()`

`dplyr::left_join()`

`dplyr::group_by()`

---

class: clear
background-image: url(img/here.png)
background-size: 700px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[here](https://here.r-lib.org/)
[@allison_horst](https://twitter.com/allison_horst)

---

# 3. here

## Descri√ß√£o

### Constr√≥i caminhos para os arquivos do seu projeto

### - **Mudar o diret√≥rio**: tende √† ser chato demais (principalmente se √© um c√≥digo alheio)

--

### - **Fragilidade**: conectado exatamente a um lugar e a um momento (baixa reprodutibilidade)

--

### - **Subdiret√≥rios**: facilita importar ou exportar para subpastas (Lei do M√≠nimo Esfor√ßo)

---

background-image: url(img/here.png)
background-size: 400px
background-position: 50% 90%

# 3. here

## Pacote


```r
# instalar
install.packages("here")

# carregar
library(here)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/here.png)
background-size: 400px
background-position: 50% 90%

# 3. here

## Diversos crit√©rios para encontrar o diret√≥rio raiz


```r
# conferir
here::here()

# criar um arquivo .here
here::set_here()
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[@allison_horst](https://twitter.com/allison_horst)

---

class: clear
background-image: url(img/package_readr.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[readr](https://readr.tidyverse.org/)

---

background-image: url(img/cheatsheet_readr.png)
background-size: 600px
background-position: 50% 70%

# 4. readr, readxl e writexl

## Data Import Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Data Import Cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf)

---

# 4. readr, readxl e writexl

## readr - Descri√ß√£o

### **Carrega e salva** grandes arquivos de forma **mais r√°pida**

--

### As fun√ß√µes **read.csv()** e **read.csv2()** s√£o substitu√≠das pelas fun√ß√µes **read_csv()** e **read_csv2()**

--

### Essas fun√ß√µes fornecem **medidores de progresso**

--

### E tamb√©m **classificam** automaticamente o **modo** dos dados de cada coluna

--

### A classe do objeto atribu√≠do √© **tibble**

--

### Para salvar arquivos no formato .csv: **write_csv()** e **write_csv2()**

---

background-image: url(img/general_data_eu_mesmo.png)
background-size: 600px
background-position: 50% 80%

# 4. readr, readxl e writexl

## ATLANTIC AMPHIBIANS: a dataset of amphibian communities from the Atlantic Forests of South America

### Eu mesmo et al. (2018)

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Vancine et al. (2018)](https://doi.org/10.1002/ecy.2392)

---

# 4. readr, readxl e writexl

## readr

### **Formato .csv**


```r
# importar sites com here
si &lt;- readr::read_csv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.csv"),
                      locale = readr::locale(encoding = "latin1"))
si
```

```
## [90m# A tibble: 1,163 √ó 25[39m
##    id      reference_number species_number record sampled_habitat active_methods passive_methods complementary_me‚Ä¶ period  month_start year_start
##    [3m[90m&lt;chr&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m          [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m  [3m[90m&lt;chr&gt;[39m[23m           [3m[90m&lt;chr&gt;[39m[23m          [3m[90m&lt;chr&gt;[39m[23m           [3m[90m&lt;chr&gt;[39m[23m             [3m[90m&lt;chr&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m      [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m amp1001             [4m1[24m001             19 ab     fo,ll           as             pt              [31mNA[39m                mo,da,‚Ä¶           9       [4m2[24m000
## [90m 2[39m amp1002             [4m1[24m002             16 co     fo,la,ll        as             pt              [31mNA[39m                mo,da,‚Ä¶          12       [4m2[24m007
## [90m 3[39m amp1003             [4m1[24m002             14 co     fo,la,ll        as             pt              [31mNA[39m                mo,da,‚Ä¶          12       [4m2[24m007
## [90m 4[39m amp1004             [4m1[24m002             13 co     fo,la,ll        as             pt              [31mNA[39m                mo,da,‚Ä¶          12       [4m2[24m007
## [90m 5[39m amp1005             [4m1[24m003             30 co     fo,ll,br        as             [31mNA[39m              [31mNA[39m                mo,da,‚Ä¶           7       [4m1[24m988
## [90m 6[39m amp1006             [4m1[24m004             42 co     tp,pp,la,ll,is  [31mNA[39m             [31mNA[39m              [31mNA[39m                [31mNA[39m               [31mNA[39m         [31mNA[39m
## [90m 7[39m amp1007             [4m1[24m005             23 co     sp              as             [31mNA[39m              [31mNA[39m                [31mNA[39m                4       [4m2[24m007
## [90m 8[39m amp1008             [4m1[24m005             19 co     sp,la,sw        as,sb,tr       [31mNA[39m              [31mNA[39m                tw,ni             4       [4m2[24m007
## [90m 9[39m amp1009             [4m1[24m005             13 ab     fo              [31mNA[39m             pt              [31mNA[39m                mo,da,‚Ä¶           4       [4m2[24m007
## [90m10[39m amp1010             [4m1[24m006              1 ab     fo              [31mNA[39m             pt              [31mNA[39m                mo,da,‚Ä¶           5       [4m2[24m011
## [90m# ‚Ä¶ with 1,153 more rows, and 14 more variables: month_finish &lt;dbl&gt;, year_finish &lt;dbl&gt;, effort_months &lt;dbl&gt;, country &lt;chr&gt;, state &lt;chr&gt;,[39m
## [90m#   state_abbreviation &lt;chr&gt;, municipality &lt;chr&gt;, site &lt;chr&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, coordinate_precision &lt;chr&gt;, altitude &lt;dbl&gt;,[39m
## [90m#   temperature &lt;dbl&gt;, precipitation &lt;dbl&gt;[39m
```

---

# 4. readr, readxl e writexl

## readr

### **Formato .csv**


```r
# importar sites sem here
si &lt;- readr::read_csv("./03_dados/tabelas/ATLANTIC_AMPHIBIANS_sites.csv",
                      locale = readr::locale(encoding = "latin1"))
si
```


```
## [90m# A tibble: 1,163 √ó 25[39m
##    id      reference_number species_number record sampled_habitat active_methods passive_methods complementary_me‚Ä¶ period  month_start year_start
##    [3m[90m&lt;chr&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m          [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m  [3m[90m&lt;chr&gt;[39m[23m           [3m[90m&lt;chr&gt;[39m[23m          [3m[90m&lt;chr&gt;[39m[23m           [3m[90m&lt;chr&gt;[39m[23m             [3m[90m&lt;chr&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m      [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m amp1001             [4m1[24m001             19 ab     fo,ll           as             pt              [31mNA[39m                mo,da,‚Ä¶           9       [4m2[24m000
## [90m 2[39m amp1002             [4m1[24m002             16 co     fo,la,ll        as             pt              [31mNA[39m                mo,da,‚Ä¶          12       [4m2[24m007
## [90m 3[39m amp1003             [4m1[24m002             14 co     fo,la,ll        as             pt              [31mNA[39m                mo,da,‚Ä¶          12       [4m2[24m007
## [90m 4[39m amp1004             [4m1[24m002             13 co     fo,la,ll        as             pt              [31mNA[39m                mo,da,‚Ä¶          12       [4m2[24m007
## [90m 5[39m amp1005             [4m1[24m003             30 co     fo,ll,br        as             [31mNA[39m              [31mNA[39m                mo,da,‚Ä¶           7       [4m1[24m988
## [90m 6[39m amp1006             [4m1[24m004             42 co     tp,pp,la,ll,is  [31mNA[39m             [31mNA[39m              [31mNA[39m                [31mNA[39m               [31mNA[39m         [31mNA[39m
## [90m 7[39m amp1007             [4m1[24m005             23 co     sp              as             [31mNA[39m              [31mNA[39m                [31mNA[39m                4       [4m2[24m007
## [90m 8[39m amp1008             [4m1[24m005             19 co     sp,la,sw        as,sb,tr       [31mNA[39m              [31mNA[39m                tw,ni             4       [4m2[24m007
## [90m 9[39m amp1009             [4m1[24m005             13 ab     fo              [31mNA[39m             pt              [31mNA[39m                mo,da,‚Ä¶           4       [4m2[24m007
## [90m10[39m amp1010             [4m1[24m006              1 ab     fo              [31mNA[39m             pt              [31mNA[39m                mo,da,‚Ä¶           5       [4m2[24m011
## [90m# ‚Ä¶ with 1,153 more rows, and 14 more variables: month_finish &lt;dbl&gt;, year_finish &lt;dbl&gt;, effort_months &lt;dbl&gt;, country &lt;chr&gt;, state &lt;chr&gt;,[39m
## [90m#   state_abbreviation &lt;chr&gt;, municipality &lt;chr&gt;, site &lt;chr&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, coordinate_precision &lt;chr&gt;, altitude &lt;dbl&gt;,[39m
## [90m#   temperature &lt;dbl&gt;, precipitation &lt;dbl&gt;[39m
```

---

# 4. readr, readxl e writexl

## readr

### **Formato .txt**


```r
# importar sites
si &lt;- readr::read_tsv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.txt"))
si
```

```
## [90m# A tibble: 1,163 √ó 25[39m
##    id      reference_number species_number record sampled_habitat active_methods passive_methods complementary_me‚Ä¶ period  month_start year_start
##    [3m[90m&lt;chr&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m          [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m  [3m[90m&lt;chr&gt;[39m[23m           [3m[90m&lt;chr&gt;[39m[23m          [3m[90m&lt;chr&gt;[39m[23m           [3m[90m&lt;chr&gt;[39m[23m             [3m[90m&lt;chr&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m      [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m amp1001             [4m1[24m001             19 ab     fo,ll           as             pt              [31mNA[39m                mo,da,‚Ä¶           9       [4m2[24m000
## [90m 2[39m amp1002             [4m1[24m002             16 co     fo,la,ll        as             pt              [31mNA[39m                mo,da,‚Ä¶          12       [4m2[24m007
## [90m 3[39m amp1003             [4m1[24m002             14 co     fo,la,ll        as             pt              [31mNA[39m                mo,da,‚Ä¶          12       [4m2[24m007
## [90m 4[39m amp1004             [4m1[24m002             13 co     fo,la,ll        as             pt              [31mNA[39m                mo,da,‚Ä¶          12       [4m2[24m007
## [90m 5[39m amp1005             [4m1[24m003             30 co     fo,ll,br        as             [31mNA[39m              [31mNA[39m                mo,da,‚Ä¶           7       [4m1[24m988
## [90m 6[39m amp1006             [4m1[24m004             42 co     tp,pp,la,ll,is  [31mNA[39m             [31mNA[39m              [31mNA[39m                [31mNA[39m               [31mNA[39m         [31mNA[39m
## [90m 7[39m amp1007             [4m1[24m005             23 co     sp              as             [31mNA[39m              [31mNA[39m                [31mNA[39m                4       [4m2[24m007
## [90m 8[39m amp1008             [4m1[24m005             19 co     sp,la,sw        as,sb,tr       [31mNA[39m              [31mNA[39m                tw,ni             4       [4m2[24m007
## [90m 9[39m amp1009             [4m1[24m005             13 ab     fo              [31mNA[39m             pt              [31mNA[39m                mo,da,‚Ä¶           4       [4m2[24m007
## [90m10[39m amp1010             [4m1[24m006              1 ab     fo              [31mNA[39m             pt              [31mNA[39m                mo,da,‚Ä¶           5       [4m2[24m011
## [90m# ‚Ä¶ with 1,153 more rows, and 14 more variables: month_finish &lt;dbl&gt;, year_finish &lt;dbl&gt;, effort_months &lt;dbl&gt;, country &lt;chr&gt;, state &lt;chr&gt;,[39m
## [90m#   state_abbreviation &lt;chr&gt;, municipality &lt;chr&gt;, site &lt;chr&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, coordinate_precision &lt;chr&gt;, altitude &lt;dbl&gt;,[39m
## [90m#   temperature &lt;dbl&gt;, precipitation &lt;dbl&gt;[39m
```

---

class: clear
background-image: url(img/package_readxl.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[readxl](https://readxl.tidyverse.org/)

---

# 4. readr, readxl e writexl

## readxl e writexl

### Pacotes para importar e exportar planilhas no formato Excel¬Æ


```r
# importar .xlsx
install.packages("readxl")
library("readxl")
```


```r
# exportar .xlsx
install.packages("writexl")
library("writexl")
```

---

# 4. readr, readxl e writexl

## readxl - Desccri√ß√£o

### **Carrega e salva** grandes arquivos de forma **mais r√°pida** no formato **.xlsx**

--

### Fun√ß√µes **read_xlsx()** e **read_xlsx2()**

--

### Essas fun√ß√µes fornecem **medidores de progresso**

--

### E tamb√©m **classificam** automaticamente o **modo** dos dados de cada coluna

--

### A classe do objeto atribu√≠do √© **tibble**

--

### Para salvar arquivos no formato .xlsx: **write_xlsx()** e **write_xlsx2()**

---

# 4. readr, readxl e writexl

## **Formato .xlsx**

### O argumento `sheet` define a aba a ser importada (n√∫mero ou nome)


```r
# importar sites
si &lt;- readxl::read_xlsx(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.xlsx"), 
                        sheet = 1)
si
```

```
## [90m# A tibble: 1,163 √ó 25[39m
##    id      reference_number species_number record sampled_habitat active_methods passive_methods complementary_me‚Ä¶ period  month_start year_start
##    [3m[90m&lt;chr&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m          [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m  [3m[90m&lt;chr&gt;[39m[23m           [3m[90m&lt;chr&gt;[39m[23m          [3m[90m&lt;chr&gt;[39m[23m           [3m[90m&lt;chr&gt;[39m[23m             [3m[90m&lt;chr&gt;[39m[23m   [3m[90m&lt;chr&gt;[39m[23m       [3m[90m&lt;chr&gt;[39m[23m     
## [90m 1[39m amp1001             [4m1[24m001             19 ab     fo,ll           as             pt              NA                mo,da,‚Ä¶ 9           2000      
## [90m 2[39m amp1002             [4m1[24m002             16 co     fo,la,ll        as             pt              NA                mo,da,‚Ä¶ 12          2007      
## [90m 3[39m amp1003             [4m1[24m002             14 co     fo,la,ll        as             pt              NA                mo,da,‚Ä¶ 12          2007      
## [90m 4[39m amp1004             [4m1[24m002             13 co     fo,la,ll        as             pt              NA                mo,da,‚Ä¶ 12          2007      
## [90m 5[39m amp1005             [4m1[24m003             30 co     fo,ll,br        as             NA              NA                mo,da,‚Ä¶ 7           1988      
## [90m 6[39m amp1006             [4m1[24m004             42 co     tp,pp,la,ll,is  NA             NA              NA                NA      NA          NA        
## [90m 7[39m amp1007             [4m1[24m005             23 co     sp              as             NA              NA                NA      4           2007      
## [90m 8[39m amp1008             [4m1[24m005             19 co     sp,la,sw        as,sb,tr       NA              NA                tw,ni   4           2007      
## [90m 9[39m amp1009             [4m1[24m005             13 ab     fo              NA             pt              NA                mo,da,‚Ä¶ 4           2007      
## [90m10[39m amp1010             [4m1[24m006              1 ab     fo              NA             pt              NA                mo,da,‚Ä¶ 5           2011      
## [90m# ‚Ä¶ with 1,153 more rows, and 14 more variables: month_finish &lt;chr&gt;, year_finish &lt;chr&gt;, effort_months &lt;chr&gt;, country &lt;chr&gt;, state &lt;chr&gt;,[39m
## [90m#   state_abbreviation &lt;chr&gt;, municipality &lt;chr&gt;, site &lt;chr&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, coordinate_precision &lt;chr&gt;, altitude &lt;dbl&gt;,[39m
## [90m#   temperature &lt;chr&gt;, precipitation &lt;chr&gt;[39m
```

---

# Importar os dados

## **Formato .csv**

### Dados das localidades




```r
# importar sites
si &lt;- readr::read_csv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.csv"),
                      locale = readr::locale(encoding = "latin1"))
si
```

### Dados das esp√©cies




```r
# importar species
sp &lt;- readr::read_csv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_species.csv"),
                      locale = readr::locale(encoding = "latin1"))
sp
```

---

class: clear
background-image: url(img/package_tibble.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[tibble](https://tibble.tidyverse.org/)

---

# 5. tibble

### O tibble (classe *tbl_df*) √© um **tipo especial de data frame**

--

### √â o **formato** aconselhado para que as fun√ß√µes do tidyverse **funcionem**

--

### Converter **data frame** em **tibble** usa-se a fun√ß√£o `as_tibble()`

--

### Converter **tibble** em **data frame** usa-se a fun√ß√£o `as_data_frame()`

--

### Cada vari√°vel pode ser do modo *numbers(int, dbl)*, *character(chr)*, *logical(lgl)* ou *factor(fctr)*

---

# 5. tibble

## Descri√ß√£o dos modos das colunas atrav√©s da fun√ß√£o `glimpse()` - "espiar os dados"


```r
# descricao dos dados de sites
tibble::glimpse(si)
```

```
## Rows: 1,163
## Columns: 25
## $ id                    [3m[90m&lt;chr&gt;[39m[23m "amp1001", "amp1002", "amp1003", "amp1004", "amp1005", "amp1006", "amp1007", "amp1008", "amp1009", "amp1010", "am‚Ä¶
## $ reference_number      [3m[90m&lt;dbl&gt;[39m[23m 1001, 1002, 1002, 1002, 1003, 1004, 1005, 1005, 1005, 1006, 1006, 1006, 1006, 1006, 1006, 1006, 1006, 1006, 1006,‚Ä¶
## $ species_number        [3m[90m&lt;dbl&gt;[39m[23m 19, 16, 14, 13, 30, 42, 23, 19, 13, 1, 1, 2, 4, 4, 6, 5, 8, 2, 5, 1, 2, 2, 1, 2, 2, 1, 2, 3, 7, 8, 7, 7, 7, 7, 7,‚Ä¶
## $ record                [3m[90m&lt;chr&gt;[39m[23m "ab", "co", "co", "co", "co", "co", "co", "co", "ab", "ab", "ab", "ab", "ab", "ab", "ab", "ab", "ab", "ab", "ab",‚Ä¶
## $ sampled_habitat       [3m[90m&lt;chr&gt;[39m[23m "fo,ll", "fo,la,ll", "fo,la,ll", "fo,la,ll", "fo,ll,br", "tp,pp,la,ll,is", "sp", "sp,la,sw", "fo", "fo", "fo", "f‚Ä¶
## $ active_methods        [3m[90m&lt;chr&gt;[39m[23m "as", "as", "as", "as", "as", NA, "as", "as,sb,tr", NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶
## $ passive_methods       [3m[90m&lt;chr&gt;[39m[23m "pt", "pt", "pt", "pt", NA, NA, NA, NA, "pt", "pt", "pt", "pt", "pt", "pt", "pt", "pt", "pt", "pt", "pt", "pt", "‚Ä¶
## $ complementary_methods [3m[90m&lt;chr&gt;[39m[23m NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶
## $ period                [3m[90m&lt;chr&gt;[39m[23m "mo,da,tw,ni", "mo,da,tw,ni", "mo,da,tw,ni", "mo,da,tw,ni", "mo,da,ni", NA, NA, "tw,ni", "mo,da,tw,ni", "mo,da,tw‚Ä¶
## $ month_start           [3m[90m&lt;dbl&gt;[39m[23m 9, 12, 12, 12, 7, NA, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 3, 3, 3, 3, 3‚Ä¶
## $ year_start            [3m[90m&lt;dbl&gt;[39m[23m 2000, 2007, 2007, 2007, 1988, NA, 2007, 2007, 2007, 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2‚Ä¶
## $ month_finish          [3m[90m&lt;dbl&gt;[39m[23m 1, 5, 5, 5, 8, NA, 4, 4, 4, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 2, 2, 2, 2, 2, 2‚Ä¶
## $ year_finish           [3m[90m&lt;dbl&gt;[39m[23m 2002, 2009, 2009, 2009, 2001, NA, 2009, 2009, 2009, 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2‚Ä¶
## $ effort_months         [3m[90m&lt;dbl&gt;[39m[23m 16, 17, 17, 17, 157, NA, 24, 24, 24, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 11, 11,‚Ä¶
## $ country               [3m[90m&lt;chr&gt;[39m[23m "Brazil", "Brazil", "Brazil", "Brazil", "Brazil", "Brazil", "Brazil", "Brazil", "Brazil", "Brazil", "Brazil", "Br‚Ä¶
## $ state                 [3m[90m&lt;chr&gt;[39m[23m "Piau√É¬≠", "Cear√É¬°", "Cear√É¬°", "Cear√É¬°", "Cear√É¬°", "Cear√É¬°", "Cear√É¬°", "Cear√É¬°", "Cear√É¬°", "Rio Grande do Norte", ‚Ä¶
## $ state_abbreviation    [3m[90m&lt;chr&gt;[39m[23m "BR-PI", "BR-CE", "BR-CE", "BR-CE", "BR-CE", "BR-CE", "BR-CE", "BR-CE", "BR-CE", "BR-RN", "BR-RN", "BR-RN", "BR-R‚Ä¶
## $ municipality          [3m[90m&lt;chr&gt;[39m[23m "Canto do Buriti", "S√É¬£o Gon√É¬ßalo do Amarante", "S√É¬£o Gon√É¬ßalo do Amarante", "S√É¬£o Gon√É¬ßalo do Amarante", "Baturi‚Ä¶
## $ site                  [3m[90m&lt;chr&gt;[39m[23m "Parque Nacional Serra das Confus√É¬µes", "Dunas", "Jardim Bot√É¬¢nico√Ç¬†Municipal de√Ç¬†Bauru", "Ta√É¬≠ba", "Serra de Bat‚Ä¶
## $ latitude              [3m[90m&lt;dbl&gt;[39m[23m -8.680000, -3.545527, -3.574194, -3.515250, -4.280556, -9.229167, -3.846111, -3.825833, -3.837500, -6.136944, -6.‚Ä¶
## $ longitude             [3m[90m&lt;dbl&gt;[39m[23m -43.42194, -38.85783, -38.88869, -38.91880, -38.91083, -36.42806, -40.89444, -40.91944, -40.91028, -35.22944, -35‚Ä¶
## $ coordinate_precision  [3m[90m&lt;chr&gt;[39m[23m "gm", "dd", "dd", "dd", "gm", NA, "gms", "gms", "gms", NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA‚Ä¶
## $ altitude              [3m[90m&lt;dbl&gt;[39m[23m 543, 15, 29, 25, 750, 745, 863, 878, 826, 93, 35, 69, 93, 130, 69, 93, 59, 58, 38, 122, 117, 100, 111, 57, 95, 95‚Ä¶
## $ temperature           [3m[90m&lt;dbl&gt;[39m[23m 24.98, 26.53, 26.45, 26.55, 21.35, 20.45, 21.57, 21.47, 21.76, 25.40, 25.78, 25.59, 25.42, 25.14, 25.57, 25.41, 2‚Ä¶
## $ precipitation         [3m[90m&lt;dbl&gt;[39m[23m 853, 1318, 1248, 1376, 1689, 1249, 1520, 1474, 1450, 1332, 1331, 1352, 1327, 1133, 1147, 1223, 1349, 1356, 1421, ‚Ä¶
```

---

# 5. tibble

## Descri√ß√£o dos modos das colunas atrav√©s da fun√ß√£o `glimpse()` - "espiar os dados"


```r
# descricao dos dados de especies
tibble::glimpse(sp)
```

```
## Rows: 17,618
## Columns: 10
## $ id          [3m[90m&lt;chr&gt;[39m[23m "amp1001", "amp1001", "amp1009", "amp1009", "amp1009", "amp1009", "amp1009", "amp1011", "amp1013", "amp1014", "amp1014", "a‚Ä¶
## $ order       [3m[90m&lt;chr&gt;[39m[23m "Anura", NA, "Anura", NA, "Anura", "Anura", "Anura", "Anura", "Anura", "Anura", NA, "Anura", "Anura", "Anura", "Anura", "An‚Ä¶
## $ superfamily [3m[90m&lt;chr&gt;[39m[23m NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,‚Ä¶
## $ family      [3m[90m&lt;chr&gt;[39m[23m "Hylidae", NA, "Hylidae", NA, "Odontophrynidae", "Phyllomedusidae", "Bufonidae", "Leptodactylidae", "Leptodactylidae", "Lep‚Ä¶
## $ subfamily   [3m[90m&lt;chr&gt;[39m[23m "Dendropsophinae", NA, "Lophyohylinae", NA, NA, NA, NA, "Leiuperinae", "Leptodactylinae", "Leptodactylinae", NA, "Gastrophr‚Ä¶
## $ genus       [3m[90m&lt;chr&gt;[39m[23m "Dendropsophus", NA, "Corythomantis", NA, "Odontophrynus", "Pithecopus", "Rhinella", "Physalaemus", "Leptodactylus", "Lepto‚Ä¶
## $ species     [3m[90m&lt;chr&gt;[39m[23m "Dendropsophus soaresi", "Scinax sp.", "Corythomantis greeningi", "Leptodactylus sp. (aff. andreae)", "Odontophrynus carval‚Ä¶
## $ valid_name  [3m[90m&lt;chr&gt;[39m[23m "Dendropsophus soaresi", NA, "Corythomantis greeningi", NA, "Odontophrynus carvalhoi", "Pithecopus nordestinus", "Rhinella ‚Ä¶
## $ individuals [3m[90m&lt;dbl&gt;[39m[23m 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ‚Ä¶
## $ endemic     [3m[90m&lt;dbl&gt;[39m[23m 0, NA, NA, NA, 0, 0, 0, 0, 0, 0, NA, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, NA, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, NA, 0, 1, NA, 1, 1,‚Ä¶
```

---

# 5. tibble

## tibble vs data.frame

### 1. Nunca converte um tipo **character como factor** (corrigido nas vers√µes &gt;R 4.0.x)


```r
df &lt;- data.frame(ch = c("a", "b"), nu = 1:2)
str(df)
```

```
## 'data.frame':	2 obs. of  2 variables:
##  $ ch: chr  "a" "b"
##  $ nu: int  1 2
```
--

```r
tb &lt;- tibble::tibble(ch = c("a", "b"), nu = 1:2)
tibble::glimpse(tb)
```

```
## Rows: 2
## Columns: 2
## $ ch [3m[90m&lt;chr&gt;[39m[23m "a", "b"
## $ nu [3m[90m&lt;int&gt;[39m[23m 1, 2
```

---

# 5. tibble

## tibble vs data.frame

### 2. A indexa√ß√£o com colchetes retorna um **tibble**

```r
df_ch &lt;- df[, 1]
class(df_ch)
```

```
## [1] "character"
```
--

```r
tb_ch &lt;- tb[, 1]
class(tb_ch)
```

```
## [1] "tbl_df"     "tbl"        "data.frame"
```
--

```r
# indexacao pelo nome devolve um vetor
tb_ch &lt;- tb$ch
class(tb_ch)
```

```
## [1] "character"
```

---

# 5. tibble

## tibble vs data.frame

### 3. N√£o faz correspond√™ncia parcial, retorna **NULL** se a coluna n√£o existe com o nome especificado

```r
df$c 
```

```
## [1] "a" "b"
```
--

```r
tb$c
```

```
## NULL
```

---

class: clear
background-image: url(img/package_magrittr.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[magrittr](https://magrittr.tidyverse.org/)

---

background-image: url(img/person_rene_magritte.jpg), url(img/tidyverse_magritte_pipe.jpg)
background-size: 350px, 550px
background-position: 7% 60%, 85% 75%

# 6. magrittr (pipe - %&gt;%)

## Ren√© Magritte (1898-1967)

---

# 6. magrittr (pipe - %&gt;%)

## Descri√ß√£o

### O operador pipe (*%&gt;%*) permite o ‚Äúencadeamento‚Äù de v√°rias fun√ß√µes e **n√£o √© preciso de objetos** para armazenar resultados intermedi√°rios

--

### Essa fun√ß√£o torna os c√≥digos em R **mais simples**, pois realizamos **m√∫ltiplas opera√ß√µes** em uma **√∫nica linha**

--

### Ele captura o **resultado de uma declara√ß√£o** e o **torna a entrada da pr√≥xima declara√ß√£o**. Podemos pensar como *‚ÄúEM SEGUIDA FA√áA‚Äù*

--

### O operador pipe √© **%&gt;%**

---

background-image: url(img/general_fog01.jpg)
background-size: 500px
background-position: 50% 70%

# 6. magrittr (pipe - %&gt;%)

### Atalho: `Crtl + Shift + M`


```r
# sem pipe
sqrt(sum(1:100))
```

```
## [1] 71.06335
```

---

background-image: url(img/general_fog02.jpg)
background-size: 350px
background-position: 50% 80%

# 6. magrittr (pipe - %&gt;%)

### Atalho: `Crtl + Shift + M`


```r
# sem pipe
sqrt(sum(1:100))
```

```
## [1] 71.06335
```

---

# 6. magrittr (pipe - %&gt;%)

### Atalho: `Crtl + Shift + M`


```r
# sem pipe
sqrt(sum(1:100))
```

```
## [1] 71.06335
```


```r
# com pipe
1:100 %&gt;% 
  sum() %&gt;% 
  sqrt()
```

```
## [1] 71.06335
```

---

# 6. magrittr (pipe - %&gt;%)

### Atalho: `Crtl + Shift + M`


```r
# fixar amostragem
set.seed(42)

# sem pipe
ve &lt;- sum(sqrt(sort(log10(rpois(100, 10)))))
ve
```

```
## [1] 99.91426
```
--

```r
# fixar amostragem
set.seed(42)

# com pipe
ve &lt;- rpois(100, 10) %&gt;% 
  log10() %&gt;%
  sort() %&gt;% 
  sqrt() %&gt;% 
  sum()
ve  
```

```
## [1] 99.91426
```

---

class: clear, inverse
background-image: url(img/gif_mario.gif)
background-size: 700px

---

class: clear, inverse
background-image: url(img/waterfall.gif)
background-size: 900px

---

# 6. magrittr (pipe - %&gt;%)

## Outros pipes

### maggritr

- `%T&gt;%`: retorna o lado esquerdo em vez do lado direito
- `%$%`: ‚Äúexplode‚Äù as vari√°veis em um quadro de dados
- `%&lt;&gt;%`: permite atribui√ß√£o usando pipes

### Nativo do R: 

A partir da vers√£o do R 4.1+ (18/05/2021), o operador pipe se tornou nativo do R

&gt; Tools &gt; Global Options &gt; Code &gt; [x] Use native pipe operator, |&gt; (requires R 4.1+)

- `|&gt;`: pipe nativo do R

---

class: inverse, center, middle

# Exerc√≠cios

---

# Exerc√≠cio 09

## Reescreva cada uma das opera√ß√µes utilizando pipes `%&gt;%`:
&lt;br&gt;
`log10(cumsum(1:100))`
&lt;br&gt;
`sum(sqrt(abs(rnorm(100))))`
&lt;br&gt;
`sum(sort(sample(1:10, 10000, rep = TRUE)))`

<div class="countdown" id="timer_617077a8" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exerc√≠cio 09
## Solu√ß√£o

```r
# solucao
# 1.
log10(cumsum(1:100))

1:100 %&gt;%
  cumsum %&gt;% 
  log10
```

---

# Exerc√≠cio 09
## Solu√ß√£o


```r
# 2.
sum(sort(abs(rnorm(100))))

rnorm(100) %&gt;% 
  abs %&gt;% 
  sort %&gt;% 
  sum
```

---

# Exerc√≠cio 09
## Solu√ß√£o


```r
# 3.
sum(sort(sample(1:10, 10000, rep = TRUE)))

1:10 %&gt;% 
  sample(10000, rep = TRUE) %&gt;% 
  sort %&gt;% 
  sum
```

---

class: clear
background-image: url(img/package_palmerpenguins.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[palmerpenguins](https://allisonhorst.github.io/palmerpenguins/)

---

background-image: url(img/lter_penguins.png)
background-size: 600px
background-position: 50% 80%

# palmerpenguins

## Dados de medidas de pinguins chamados `palmerpenguins`

#### Esses dados foram coletados e disponibilizados pela [Dra. Kristen Gorman](https://www.uaf.edu/cfos/people/faculty/detail/kristen-gorman.php) e pela [Palmer Station, Antarctica LTER](https://pal.lternet.edu/), membro da [Long Term Ecological Research Network](https://lternet.edu/)

#### Dois conjuntos de dados: **penguins_raw** (dados brutos) e **penguins** (vers√£o simplificada)

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[palmerpenguins](https://allisonhorst.github.io/palmerpenguins/)

---

background-image: url(img/culmen_depth.png), url(img/lter_penguins.png)
background-size: 400px, 400px
background-position: 20% 90%, 80% 90%

# palmerpenguins

## Dados de medidas de pinguins chamados `palmerpenguins`


```r
# instalar 
install.packages("palmerpenguins")

# carregar
library(palmerpenguins)

# ajuda dos dados
?penguins
?penguins_raw
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[palmerpenguins](https://allisonhorst.github.io/palmerpenguins/)

---

background-image: url(img/culmen_depth.png), url(img/lter_penguins.png)
background-size: 400px, 400px
background-position: 20% 90%, 80% 90%

# palmerpenguins

## Dados de medidas de pinguins chamados `palmerpenguins`


```r
# visualizar os dados
penguins
penguins_raw

# glimpse
tibble::glimpse(penguins)
tibble::glimpse(penguins_raw)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[palmerpenguins ](https://allisonhorst.github.io/palmerpenguins/)

---

class: clear
background-image: url(img/package_tidyr.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[tidyr](https://tidyr.tidyverse.org/)

---

background-image: url(img/cheatsheet_tidyr.png)
background-size: 600px
background-position: 50% 70%

# 7. tidyr

## Data Import Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Data Import Cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf)

---

# 7. tidyr

## Descri√ß√£o

### O pacote tidyr tem **fun√ß√£o de tornar** um conjunto de dados **tidy** (organizados), sendo esses f√°ceis de manipular, modelar e visualizar

--

### Um conjunto de dados est√° **arrumado ou n√£o**, dependendo de como linhas, colunas e c√©lulas s√£o combinadas com observa√ß√µes, vari√°veis e valores

--

## Nos dados tidy:
### 1. Cada vari√°vel em uma coluna
### 2. Cada observa√ß√£o em uma linha
### 3. Cada valor como uma c√©lula

---

background-image: url(img/tidyr_data01.png)
background-size: 1000px
background-position: 50% 50%

# 7. tidyr

## Conjunto de dados 'tidy'

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Wickham &amp; Grolemund (2017)](https://r4ds.had.co.nz/)

---

background-image: url(img/tidyr_data02.jpg)
background-size: 600px
background-position: 75% 85%

# 7. tidyr

## Fun√ß√µes

1. **unite()**: junta dados de m√∫ltiplas colunas em uma
1. **separate()**: separa caracteres em m√∫lplica colunas
1. **separate_rows()**: separa caracteres em m√∫lplica colunas e linhas
1. **drop_na()**: retira linhas com NA
1. **replace_na()**: substitui NA
1. **pivot_wider()**: long para wide
1. **pivot_longer()**: wide para long

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[@allison_horst](https://twitter.com/allison_horst)

---

# 7. tidyr

## **1. `unite()`**

### Unir as colunas "Region" e "Island" na nova coluna "region_island"


```r
# unir colunas
penguins_raw_unir &lt;- tidyr::unite(data = penguins_raw, 
                                  col = "region_island",
                                  Region:Island, 
                                  sep = ", ",
                                  remove = FALSE)
head(penguins_raw_unir[, c("Region", "Island", "region_island")])
```

```
## [90m# A tibble: 6 √ó 3[39m
##   Region Island    region_island    
##   [3m[90m&lt;chr&gt;[39m[23m  [3m[90m&lt;chr&gt;[39m[23m     [3m[90m&lt;chr&gt;[39m[23m            
## [90m1[39m Anvers Torgersen Anvers, Torgersen
## [90m2[39m Anvers Torgersen Anvers, Torgersen
## [90m3[39m Anvers Torgersen Anvers, Torgersen
## [90m4[39m Anvers Torgersen Anvers, Torgersen
## [90m5[39m Anvers Torgersen Anvers, Torgersen
## [90m6[39m Anvers Torgersen Anvers, Torgersen
```

---

# 7. tidyr

## **2. `separate()`**

### Separar a coluna ‚ÄúStage‚Äù nas colunas ‚Äústage‚Äù e ‚Äúegg_stage‚Äù


```r
# separar colunas
penguins_raw_separar &lt;- tidyr::separate(data = penguins_raw, 
                                        col = Stage,
                                        into = c("stage", "egg_stage"), 
                                        sep = ", ",
                                        remove = FALSE)
head(penguins_raw_separar[, c("Stage", "stage", "egg_stage")])
```

```
## [90m# A tibble: 6 √ó 3[39m
##   Stage              stage egg_stage  
##   [3m[90m&lt;chr&gt;[39m[23m              [3m[90m&lt;chr&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m      
## [90m1[39m Adult, 1 Egg Stage Adult 1 Egg Stage
## [90m2[39m Adult, 1 Egg Stage Adult 1 Egg Stage
## [90m3[39m Adult, 1 Egg Stage Adult 1 Egg Stage
## [90m4[39m Adult, 1 Egg Stage Adult 1 Egg Stage
## [90m5[39m Adult, 1 Egg Stage Adult 1 Egg Stage
## [90m6[39m Adult, 1 Egg Stage Adult 1 Egg Stage
```

---

# 7. tidyr

## **3. `separate_rows()`**

### Separar a coluna "Stage" nas colunas "stage" e "egg_stage" em novas linhas


```r
# separar colunas em linhas
penguins_raw_separar_linhas &lt;- tidyr::separate_rows(data = penguins_raw,
                                                    Stage,
                                                    sep = ", ")
head(penguins_raw_separar_linhas[, c("studyName", "Sample Number", "Species", 
                                     "Region", "Island", "Stage")])
```

```
## [90m# A tibble: 6 √ó 6[39m
##   studyName `Sample Number` Species                             Region Island    Stage      
##   [3m[90m&lt;chr&gt;[39m[23m               [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m                               [3m[90m&lt;chr&gt;[39m[23m  [3m[90m&lt;chr&gt;[39m[23m     [3m[90m&lt;chr&gt;[39m[23m      
## [90m1[39m PAL0708                 1 Adelie Penguin (Pygoscelis adeliae) Anvers Torgersen Adult      
## [90m2[39m PAL0708                 1 Adelie Penguin (Pygoscelis adeliae) Anvers Torgersen 1 Egg Stage
## [90m3[39m PAL0708                 2 Adelie Penguin (Pygoscelis adeliae) Anvers Torgersen Adult      
## [90m4[39m PAL0708                 2 Adelie Penguin (Pygoscelis adeliae) Anvers Torgersen 1 Egg Stage
## [90m5[39m PAL0708                 3 Adelie Penguin (Pygoscelis adeliae) Anvers Torgersen Adult      
## [90m6[39m PAL0708                 3 Adelie Penguin (Pygoscelis adeliae) Anvers Torgersen 1 Egg Stage
```

---

# 7. tidyr

## **4. `drop_na()`**

### Remove as linhas com NA de todas as colunas


```r
# remover linhas com na
penguins_raw_todas_na &lt;- tidyr::drop_na(data = penguins_raw)
head(penguins_raw_todas_na)
```

```
## [90m# A tibble: 6 √ó 17[39m
##   studyName `Sample Number` Species        Region Island  Stage    `Individual ID` `Clutch Completi‚Ä¶ `Date Egg` `Culmen Length ‚Ä¶ `Culmen Depth (‚Ä¶
##   [3m[90m&lt;chr&gt;[39m[23m               [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m          [3m[90m&lt;chr&gt;[39m[23m  [3m[90m&lt;chr&gt;[39m[23m   [3m[90m&lt;chr&gt;[39m[23m    [3m[90m&lt;chr&gt;[39m[23m           [3m[90m&lt;chr&gt;[39m[23m             [3m[90m&lt;date&gt;[39m[23m                [3m[90m&lt;dbl&gt;[39m[23m            [3m[90m&lt;dbl&gt;[39m[23m
## [90m1[39m PAL0708                 7 Adelie Pengui‚Ä¶ Anvers Torger‚Ä¶ Adult, ‚Ä¶ N4A1            No                2007-11-15             38.9             17.8
## [90m2[39m PAL0708                 8 Adelie Pengui‚Ä¶ Anvers Torger‚Ä¶ Adult, ‚Ä¶ N4A2            No                2007-11-15             39.2             19.6
## [90m3[39m PAL0708                29 Adelie Pengui‚Ä¶ Anvers Biscoe  Adult, ‚Ä¶ N18A1           No                2007-11-10             37.9             18.6
## [90m4[39m PAL0708                30 Adelie Pengui‚Ä¶ Anvers Biscoe  Adult, ‚Ä¶ N18A2           No                2007-11-10             40.5             18.9
## [90m5[39m PAL0708                39 Adelie Pengui‚Ä¶ Anvers Dream   Adult, ‚Ä¶ N25A1           No                2007-11-13             37.6             19.3
## [90m6[39m PAL0809                69 Adelie Pengui‚Ä¶ Anvers Torger‚Ä¶ Adult, ‚Ä¶ N32A1           No                2008-11-11             35.9             16.6
## [90m# ‚Ä¶ with 6 more variables: Flipper Length (mm) &lt;dbl&gt;, Body Mass (g) &lt;dbl&gt;, Sex &lt;chr&gt;, Delta 15 N (o/oo) &lt;dbl&gt;, Delta 13 C (o/oo) &lt;dbl&gt;,[39m
## [90m#   Comments &lt;chr&gt;[39m
```

---

# 7. tidyr

## **4. `drop_na()`**

### Remove as linhas com NA da coluna "Comments"


```r
# remover linhas com na de uma coluna
penguins_raw_colunas_na &lt;- tidyr::drop_na(data = penguins_raw,
                                          any_of("Comments"))
head(penguins_raw_colunas_na[, "Comments"])
```

```
## [90m# A tibble: 6 √ó 1[39m
##   Comments                             
##   [3m[90m&lt;chr&gt;[39m[23m                                
## [90m1[39m Not enough blood for isotopes.       
## [90m2[39m Adult not sampled.                   
## [90m3[39m Nest never observed with full clutch.
## [90m4[39m Nest never observed with full clutch.
## [90m5[39m No blood sample obtained.            
## [90m6[39m No blood sample obtained for sexing.
```

---

# 7. tidyr

## **5. `replace_na()`**

### Substituir os NAs da coluna "Unknown" por 0 


```r
# substituir nas por 0 em uma coluna
penguins_raw_subs_na &lt;- tidyr::replace_na(data = penguins_raw,
                                          list(Comments = "Unknown"))
head(penguins_raw_subs_na[, "Comments"])
```

```
## [90m# A tibble: 6 √ó 1[39m
##   Comments                      
##   [3m[90m&lt;chr&gt;[39m[23m                         
## [90m1[39m Not enough blood for isotopes.
## [90m2[39m Unknown                       
## [90m3[39m Unknown                       
## [90m4[39m Adult not sampled.            
## [90m5[39m Unknown                       
## [90m6[39m Unknown
```

---

background-image: url(img/gif_tidyr_pivot.gif), url(img/tidyr_tb_pivot.png)
background-size: 400px, 550px
background-position: 10% 90%, 90% 40%

# 7. tidyr

## Pivotar os dados

### `pivot_longer()` | `pivot_wider()`

---

# 7. tidyr

## **6. `pivot_wider()`** 

### Long para wide

1. **names_from**: vari√°vel categ√≥rica que definir√° os nomes das colunas
2. **values_from**: vari√°vel num√©rica que preencher√° os dados
3. **values_fill**: valor para preencher os NAs


```r
# long para wide
penguins_raw_pivot_wider &lt;- tidyr::pivot_wider(data = penguins_raw[, c(2, 3, 13)], 
                                               names_from = Species, 
                                               values_from = `Body Mass (g)`)
head(penguins_raw_pivot_wider)
```

```
## [90m# A tibble: 6 √ó 4[39m
##   `Sample Number` `Adelie Penguin (Pygoscelis adeliae)` `Gentoo penguin (Pygoscelis papua)` `Chinstrap penguin (Pygoscelis antarctica)`
##             [3m[90m&lt;dbl&gt;[39m[23m                                 [3m[90m&lt;dbl&gt;[39m[23m                               [3m[90m&lt;dbl&gt;[39m[23m                                       [3m[90m&lt;dbl&gt;[39m[23m
## [90m1[39m               1                                  [4m3[24m750                                [4m4[24m500                                        [4m3[24m500
## [90m2[39m               2                                  [4m3[24m800                                [4m5[24m700                                        [4m3[24m900
## [90m3[39m               3                                  [4m3[24m250                                [4m4[24m450                                        [4m3[24m650
## [90m4[39m               4                                    [31mNA[39m                                [4m5[24m700                                        [4m3[24m525
## [90m5[39m               5                                  [4m3[24m450                                [4m5[24m400                                        [4m3[24m725
## [90m6[39m               6                                  [4m3[24m650                                [4m4[24m550                                        [4m3[24m950
```

---

# 7. tidyr

## **7. `pivot_longer()`**

### Wide para long

1. **names_to**: nome da coluna que receber√° os nomes
2. **values_to**: nome da coluna que receber√° os valores


```r
# wide para long
penguins_raw_pivot_longer &lt;- tidyr::pivot_longer(data = penguins_raw[, c(2, 3, 10:13)], 
                                                 cols = `Culmen Length (mm)`:`Body Mass (g)`,
                                                 names_to = "medidas", 
                                                 values_to = "valores")
head(penguins_raw_pivot_longer)
```

```
## [90m# A tibble: 6 √ó 4[39m
##   `Sample Number` Species                             medidas             valores
##             [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m                               [3m[90m&lt;chr&gt;[39m[23m                 [3m[90m&lt;dbl&gt;[39m[23m
## [90m1[39m               1 Adelie Penguin (Pygoscelis adeliae) Culmen Length (mm)     39.1
## [90m2[39m               1 Adelie Penguin (Pygoscelis adeliae) Culmen Depth (mm)      18.7
## [90m3[39m               1 Adelie Penguin (Pygoscelis adeliae) Flipper Length (mm)   181  
## [90m4[39m               1 Adelie Penguin (Pygoscelis adeliae) Body Mass (g)        [4m3[24m750  
## [90m5[39m               2 Adelie Penguin (Pygoscelis adeliae) Culmen Length (mm)     39.5
## [90m6[39m               2 Adelie Penguin (Pygoscelis adeliae) Culmen Depth (mm)      17.4
```

---

class: inverse, center, middle

# Exerc√≠cios

---

# Exerc√≠cio 10

### Separe os nomes comuns dos nomes cient√≠ficos dos pinguins dos dados `penguins_raw`

<div class="countdown" id="timer_61707844" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exerc√≠cio 10

## Solu√ß√£o


```r
# exercicio 10
penguins_raw_sep &lt;- penguins_raw %&gt;% 
  tidyr::separate(col = "Species", 
                  into = c("common_names", "scientific_names"), 
                  sep = "[(]",
                  remove = FALSE)
head(penguins_raw_sep)
```

```
## [90m# A tibble: 6 √ó 19[39m
##   studyName `Sample Number` Species          common_names   scientific_names  Region Island  Stage    `Individual ID` `Clutch Complet‚Ä¶ `Date Egg`
##   [3m[90m&lt;chr&gt;[39m[23m               [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m            [3m[90m&lt;chr&gt;[39m[23m          [3m[90m&lt;chr&gt;[39m[23m             [3m[90m&lt;chr&gt;[39m[23m  [3m[90m&lt;chr&gt;[39m[23m   [3m[90m&lt;chr&gt;[39m[23m    [3m[90m&lt;chr&gt;[39m[23m           [3m[90m&lt;chr&gt;[39m[23m            [3m[90m&lt;date&gt;[39m[23m    
## [90m1[39m PAL0708                 1 Adelie Penguin ‚Ä¶ [90m"[39mAdelie Pengu‚Ä¶ Pygoscelis adeli‚Ä¶ Anvers Torger‚Ä¶ Adult, ‚Ä¶ N1A1            Yes              2007-11-11
## [90m2[39m PAL0708                 2 Adelie Penguin ‚Ä¶ [90m"[39mAdelie Pengu‚Ä¶ Pygoscelis adeli‚Ä¶ Anvers Torger‚Ä¶ Adult, ‚Ä¶ N1A2            Yes              2007-11-11
## [90m3[39m PAL0708                 3 Adelie Penguin ‚Ä¶ [90m"[39mAdelie Pengu‚Ä¶ Pygoscelis adeli‚Ä¶ Anvers Torger‚Ä¶ Adult, ‚Ä¶ N2A1            Yes              2007-11-16
## [90m4[39m PAL0708                 4 Adelie Penguin ‚Ä¶ [90m"[39mAdelie Pengu‚Ä¶ Pygoscelis adeli‚Ä¶ Anvers Torger‚Ä¶ Adult, ‚Ä¶ N2A2            Yes              2007-11-16
## [90m5[39m PAL0708                 5 Adelie Penguin ‚Ä¶ [90m"[39mAdelie Pengu‚Ä¶ Pygoscelis adeli‚Ä¶ Anvers Torger‚Ä¶ Adult, ‚Ä¶ N3A1            Yes              2007-11-16
## [90m6[39m PAL0708                 6 Adelie Penguin ‚Ä¶ [90m"[39mAdelie Pengu‚Ä¶ Pygoscelis adeli‚Ä¶ Anvers Torger‚Ä¶ Adult, ‚Ä¶ N3A2            Yes              2007-11-16
## [90m# ‚Ä¶ with 8 more variables: Culmen Length (mm) &lt;dbl&gt;, Culmen Depth (mm) &lt;dbl&gt;, Flipper Length (mm) &lt;dbl&gt;, Body Mass (g) &lt;dbl&gt;, Sex &lt;chr&gt;,[39m
## [90m#   Delta 15 N (o/oo) &lt;dbl&gt;, Delta 13 C (o/oo) &lt;dbl&gt;, Comments &lt;chr&gt;[39m
```

---

# Exerc√≠cio 11

### Calcule a massa m√©dia dos indiv√≠duos das esp√©cies de penguins por ilha. Dicas: `tidyr::replace_na()` e `tidyr::pivot_wider()`

<div class="countdown" id="timer_6170794d" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exerc√≠cio 11

## Solu√ß√£o


```r
# exercicio 11
penguins_raw_pivot_wider &lt;- penguins_raw[, c("Island", "Species", "Body Mass (g)")] %&gt;% 
  tidyr::replace_na(list(`Body Mass (g)` = 0)) %&gt;% 
  tidyr::pivot_wider(names_from = c(Species), 
                     values_from = `Body Mass (g)`,
                     values_fn = mean)
head(penguins_raw_pivot_wider)
```

```
## [90m# A tibble: 3 √ó 4[39m
##   Island    `Adelie Penguin (Pygoscelis adeliae)` `Gentoo penguin (Pygoscelis papua)` `Chinstrap penguin (Pygoscelis antarctica)`
##   [3m[90m&lt;chr&gt;[39m[23m                                     [3m[90m&lt;dbl&gt;[39m[23m                               [3m[90m&lt;dbl&gt;[39m[23m                                       [3m[90m&lt;dbl&gt;[39m[23m
## [90m1[39m Torgersen                                 [4m3[24m635.                                 [31mNA[39m                                          [31mNA[39m 
## [90m2[39m Biscoe                                    [4m3[24m710.                               [4m5[24m035.                                         [31mNA[39m 
## [90m3[39m Dream                                     [4m3[24m688.                                 [31mNA[39m                                        [4m3[24m733.
```

---

class: inverse, center, middle

# D√∫vidas?

---

class: clear
background-image: url(img/package_dplyr.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[dplyr](https://dplyr.tidyverse.org/)

---

class: clear
background-image: url(img/dplyr_wrangling.png)
background-size: 800px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/cheatsheet_dplyr.png)
background-size: 600px
background-position: 50% 70%

# 8. dplyr

## Data Transformation Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Data Transformation Cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf)

---

background-image: url(img/dplyr_functions.png)
background-size: 400px
background-position: 50% 80%

# 8. dplyr

## Descri√ß√£o

### O **dplyr** √© um pacote que **facilita** o trabalho com dados, com uma **gram√°tica de manipula√ß√£o** de dados **simples e flex√≠vel** (filtragem, reordenamento, sele√ß√£o, ...)

---

# 8. dplyr

## Fun√ß√µes

### Sua gram√°tica simples cont√©m **fun√ß√µes verbais** para manipula√ß√£o de dados

&lt;br&gt;

-   Verbos: `mutate()`, `select()`, `filter()`, `arrange()`, `summarise()`, `slice()`, `rename()`, etc.
-   Replica√ß√£o: `across()`, `if_any()`, `if_all()`, `where()`, `starts_with()`, `ends_with()`, `contains()`, etc.
-   Agrupamento: `group_by()` e `ungroup()`
-   Jun√ß√µes: `inner_join()`, `full_join()`, `left_join()`, `right_join()`, etc.
-   Combina√ß√µes: `bind_rows()` e `bind_cols()`
-   Resumos, contagem e sele√ß√£o: `n()`, `n_distinct()`, `first()`, `last()`, `nth()`, etc.

---

# 8. dplyr

## Fun√ß√µes

### Exemplos

-   `relocate()`: muda a ordem das colunas
-   `rename()`: muda o nome das colunas
-   `select()`: seleciona colunas pelo nome ou posi√ß√£o
-   `pull()`: seleciona uma coluna como vetor
-   `mutate()`: adiciona novas colunas ou resultados em colunas existentes
-   `arrange()`: reordena as linhas com base nos valores de colunas
-   `filter()`: seleciona linhas com base em valores de colunas
-   `slice()`: seleciona linhas de diferente formas
-   `distinct()`: remove linhas com valores repetidos com base nos valores de colunas
-   `count()`: conta observa√ß√µes para um grupo
-   `group_by()`: agrupa linhas pelos valores das colunas
-   `summarise()`: resume os dados atrav√©s de fun√ß√µes considerando valores das colunas
-   `*_join()`: fun√ß√µes que juntam dados de duas tabelas atrav√©s de uma coluna chave

---

# 8. dplyr

## Sintaxe

### O **tibble** √© sempre o **primeiro argumento** das fun√ß√µes verbais

--

### Todas seguem a mesma sintaxe: 

#### 1. tibble
#### 2. operador pipe 
#### 3. nome da fun√ß√£o verbal com os argumentos entre par√™nteses 

--

### As fun√ß√µes verbais **n√£o modificam** o tibble original


```r
# sintaxe
tb_dplyr &lt;- tb %&gt;% 
  funcao_verbal1(argumento1, argumento2, ...) %&gt;% 
  funcao_verbal2(argumento1, argumento2, ...) %&gt;% 
  funcao_verbal3(argumento1, argumento2, ...)
```

---

# 8. dplyr

## **1. `relocate()`**

### Reordena as colunas por nome ou posi√ß√£o


```r
# reordenar colunas - nome
penguins_relocate_col &lt;- penguins %&gt;% 
  dplyr::relocate(sex, year, .after = island)
head(penguins_relocate_col)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species island    sex     year bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m          [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Torgersen male    [4m2[24m007           39.1          18.7               181        [4m3[24m750
## [90m2[39m Adelie  Torgersen female  [4m2[24m007           39.5          17.4               186        [4m3[24m800
## [90m3[39m Adelie  Torgersen female  [4m2[24m007           40.3          18                 195        [4m3[24m250
## [90m4[39m Adelie  Torgersen [31mNA[39m      [4m2[24m007           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m
## [90m5[39m Adelie  Torgersen female  [4m2[24m007           36.7          19.3               193        [4m3[24m450
## [90m6[39m Adelie  Torgersen male    [4m2[24m007           39.3          20.6               190        [4m3[24m650
```

---

# 8. dplyr

## **1. `relocate()`**

### Reordena as colunas por nome ou posi√ß√£o


```r
# reordenar colunas - posicao
penguins_relocate_ncol &lt;- penguins %&gt;% 
  dplyr::relocate(sex, year, .after = 2)
head(penguins_relocate_ncol)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species island    sex     year bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m          [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Torgersen male    [4m2[24m007           39.1          18.7               181        [4m3[24m750
## [90m2[39m Adelie  Torgersen female  [4m2[24m007           39.5          17.4               186        [4m3[24m800
## [90m3[39m Adelie  Torgersen female  [4m2[24m007           40.3          18                 195        [4m3[24m250
## [90m4[39m Adelie  Torgersen [31mNA[39m      [4m2[24m007           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m
## [90m5[39m Adelie  Torgersen female  [4m2[24m007           36.7          19.3               193        [4m3[24m450
## [90m6[39m Adelie  Torgersen male    [4m2[24m007           39.3          20.6               190        [4m3[24m650
```

---

# 8. dplyr

## **2. `rename()`**

### Renomeia as colunas


```r
# renomear colunas
penguins_rename &lt;- penguins %&gt;% 
  dplyr::rename(bill_length = bill_length_mm,
                bill_depth = bill_depth_mm,
                flipper_length = flipper_length_mm,
                body_mass = body_mass_g)
head(penguins_rename)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species island    bill_length bill_depth flipper_length body_mass sex     year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m           [3m[90m&lt;dbl&gt;[39m[23m      [3m[90m&lt;dbl&gt;[39m[23m          [3m[90m&lt;int&gt;[39m[23m     [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Torgersen        39.1       18.7            181      [4m3[24m750 male    [4m2[24m007
## [90m2[39m Adelie  Torgersen        39.5       17.4            186      [4m3[24m800 female  [4m2[24m007
## [90m3[39m Adelie  Torgersen        40.3       18              195      [4m3[24m250 female  [4m2[24m007
## [90m4[39m Adelie  Torgersen        [31mNA[39m         [31mNA[39m               [31mNA[39m        [31mNA[39m [31mNA[39m      [4m2[24m007
## [90m5[39m Adelie  Torgersen        36.7       19.3            193      [4m3[24m450 female  [4m2[24m007
## [90m6[39m Adelie  Torgersen        39.3       20.6            190      [4m3[24m650 male    [4m2[24m007
```

---

# 8. dplyr

## **2. `rename()`**

### Renomeia as v√°rias colunas


```r
# renomear todas as colunas
penguins_rename_with &lt;- penguins %&gt;% 
  dplyr::rename_with(toupper)
head(penguins_rename_with)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   SPECIES ISLAND    BILL_LENGTH_MM BILL_DEPTH_MM FLIPPER_LENGTH_MM BODY_MASS_G SEX     YEAR
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Torgersen           39.1          18.7               181        [4m3[24m750 male    [4m2[24m007
## [90m2[39m Adelie  Torgersen           39.5          17.4               186        [4m3[24m800 female  [4m2[24m007
## [90m3[39m Adelie  Torgersen           40.3          18                 195        [4m3[24m250 female  [4m2[24m007
## [90m4[39m Adelie  Torgersen           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m [31mNA[39m      [4m2[24m007
## [90m5[39m Adelie  Torgersen           36.7          19.3               193        [4m3[24m450 female  [4m2[24m007
## [90m6[39m Adelie  Torgersen           39.3          20.6               190        [4m3[24m650 male    [4m2[24m007
```

---

# 8. dplyr

## **3. `select()`**

### Seleciona colunas pela posi√ß√£o ou pelo nome


```r
# selecionar colunas por posicao
penguins_select_position &lt;- penguins %&gt;% 
  dplyr::select(3:6)
head(penguins_select_position)
```

```
## [90m# A tibble: 6 √ó 4[39m
##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##            [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m           39.1          18.7               181        [4m3[24m750
## [90m2[39m           39.5          17.4               186        [4m3[24m800
## [90m3[39m           40.3          18                 195        [4m3[24m250
## [90m4[39m           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m
## [90m5[39m           36.7          19.3               193        [4m3[24m450
## [90m6[39m           39.3          20.6               190        [4m3[24m650
```

---

# 8. dplyr

## **3. `select()`**

### Seleciona colunas pela posi√ß√£o ou pelo nome


```r
# selecionar colunas por nomes
penguins_select_names &lt;- penguins %&gt;% 
  dplyr::select(bill_length_mm:body_mass_g)
head(penguins_select_names)
```

```
## [90m# A tibble: 6 √ó 4[39m
##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##            [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m           39.1          18.7               181        [4m3[24m750
## [90m2[39m           39.5          17.4               186        [4m3[24m800
## [90m3[39m           40.3          18                 195        [4m3[24m250
## [90m4[39m           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m
## [90m5[39m           36.7          19.3               193        [4m3[24m450
## [90m6[39m           39.3          20.6               190        [4m3[24m650
```

---

# 8. dplyr

## **3. `select()`**

### Remove as colunas pela posi√ß√£o ou pelo nome


```r
# remover colunas pelo nome
penguins_select_names_remove &lt;- penguins %&gt;% 
  dplyr::select(-(bill_length_mm:body_mass_g))
head(penguins_select_names_remove)
```

```
## [90m# A tibble: 6 √ó 4[39m
##   species island    sex     year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Torgersen male    [4m2[24m007
## [90m2[39m Adelie  Torgersen female  [4m2[24m007
## [90m3[39m Adelie  Torgersen female  [4m2[24m007
## [90m4[39m Adelie  Torgersen [31mNA[39m      [4m2[24m007
## [90m5[39m Adelie  Torgersen female  [4m2[24m007
## [90m6[39m Adelie  Torgersen male    [4m2[24m007
```
---

# 8. dplyr

## **3. `select()`**

### Seleciona colunas por um padr√£o


```r
# selecionar colunas por padrao - starts_with(), ends_with() e contains()
penguins_select_contains &lt;- penguins %&gt;% 
  dplyr::select(contains("_mm"))
head(penguins_select_contains)
```

```
## [90m# A tibble: 6 √ó 3[39m
##   bill_length_mm bill_depth_mm flipper_length_mm
##            [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m           39.1          18.7               181
## [90m2[39m           39.5          17.4               186
## [90m3[39m           40.3          18                 195
## [90m4[39m           [31mNA[39m            [31mNA[39m                  [31mNA[39m
## [90m5[39m           36.7          19.3               193
## [90m6[39m           39.3          20.6               190
```

---

# 8. dplyr

## **4. `pull()`**

### Seleciona uma coluna como vetor


```r
# coluna para vetor
penguins_select_pull &lt;- penguins %&gt;% 
  dplyr::pull(bill_length_mm)
head(penguins_select_pull, 15)
```

```
##  [1] 39.1 39.5 40.3   NA 36.7 39.3 38.9 39.2 34.1 42.0 37.8 37.8 41.1 38.6 34.6
```

---

# 8. dplyr

## **5. `mutate()`**

### Adiciona colunas novas ou vindas de opera√ß√µes


```r
# adicionar colunas
penguins_mutate &lt;- penguins %&gt;% 
  dplyr::mutate(body_mass_kg = body_mass_g/1e3, .before = sex)
head(penguins_mutate)
```

```
## [90m# A tibble: 6 √ó 9[39m
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g body_mass_kg sex     year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m        [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Torgersen           39.1          18.7               181        [4m3[24m750         3.75 male    [4m2[24m007
## [90m2[39m Adelie  Torgersen           39.5          17.4               186        [4m3[24m800         3.8  female  [4m2[24m007
## [90m3[39m Adelie  Torgersen           40.3          18                 195        [4m3[24m250         3.25 female  [4m2[24m007
## [90m4[39m Adelie  Torgersen           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m        [31mNA[39m    [31mNA[39m      [4m2[24m007
## [90m5[39m Adelie  Torgersen           36.7          19.3               193        [4m3[24m450         3.45 female  [4m2[24m007
## [90m6[39m Adelie  Torgersen           39.3          20.6               190        [4m3[24m650         3.65 male    [4m2[24m007
```

---

# 8. dplyr

## **5. `mutate()`**

### Adiciona colunas novas ou vindas de opera√ß√µes


```r
## modificar varias colunas
penguins_mutate_across &lt;- penguins %&gt;% 
  dplyr::mutate(across(where(is.factor), as.character))
head(penguins_mutate_across)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
##   [3m[90m&lt;chr&gt;[39m[23m   [3m[90m&lt;chr&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Torgersen           39.1          18.7               181        [4m3[24m750 male    [4m2[24m007
## [90m2[39m Adelie  Torgersen           39.5          17.4               186        [4m3[24m800 female  [4m2[24m007
## [90m3[39m Adelie  Torgersen           40.3          18                 195        [4m3[24m250 female  [4m2[24m007
## [90m4[39m Adelie  Torgersen           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m [31mNA[39m      [4m2[24m007
## [90m5[39m Adelie  Torgersen           36.7          19.3               193        [4m3[24m450 female  [4m2[24m007
## [90m6[39m Adelie  Torgersen           39.3          20.6               190        [4m3[24m650 male    [4m2[24m007
```

---

# 8. dplyr

## **6. `arrange()`**

### Reordena de forma crescente pelos valores de uma coluna


```r
# reordenar os valores por ordem crescente
penguins_arrange &lt;- penguins %&gt;% 
  dplyr::arrange(body_mass_g)
head(penguins_arrange)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species   island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
##   [3m[90m&lt;fct&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Chinstrap Dream               46.9          16.6               192        [4m2[24m700 female  [4m2[24m008
## [90m2[39m Adelie    Biscoe              36.5          16.6               181        [4m2[24m850 female  [4m2[24m008
## [90m3[39m Adelie    Biscoe              36.4          17.1               184        [4m2[24m850 female  [4m2[24m008
## [90m4[39m Adelie    Biscoe              34.5          18.1               187        [4m2[24m900 female  [4m2[24m008
## [90m5[39m Adelie    Dream               33.1          16.1               178        [4m2[24m900 female  [4m2[24m008
## [90m6[39m Adelie    Torgersen           38.6          17                 188        [4m2[24m900 female  [4m2[24m009
```

---

# 8. dplyr

## **6. `arrange()`**

### Reordena de forma decrescente pelos valores de uma coluna


```r
# reordenar os valores por ordem decrescente
penguins_arrange_desc &lt;- penguins %&gt;% 
  dplyr::arrange(desc(body_mass_g))
head(penguins_arrange_desc)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex    year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m           [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Gentoo  Biscoe           49.2          15.2               221        [4m6[24m300 male   [4m2[24m007
## [90m2[39m Gentoo  Biscoe           59.6          17                 230        [4m6[24m050 male   [4m2[24m007
## [90m3[39m Gentoo  Biscoe           51.1          16.3               220        [4m6[24m000 male   [4m2[24m008
## [90m4[39m Gentoo  Biscoe           48.8          16.2               222        [4m6[24m000 male   [4m2[24m009
## [90m5[39m Gentoo  Biscoe           45.2          16.4               223        [4m5[24m950 male   [4m2[24m008
## [90m6[39m Gentoo  Biscoe           49.8          15.9               229        [4m5[24m950 male   [4m2[24m009
```

---

# 8. dplyr

## **6. `arrange()`**

### Reordena de forma crescente ou decrescente pelos valores de uma coluna


```r
# reordenar os valores por ordem decrescente
penguins_arrange_desc_m &lt;- penguins %&gt;% 
  dplyr::arrange(-body_mass_g)
head(penguins_arrange_desc_m)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex    year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m           [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Gentoo  Biscoe           49.2          15.2               221        [4m6[24m300 male   [4m2[24m007
## [90m2[39m Gentoo  Biscoe           59.6          17                 230        [4m6[24m050 male   [4m2[24m007
## [90m3[39m Gentoo  Biscoe           51.1          16.3               220        [4m6[24m000 male   [4m2[24m008
## [90m4[39m Gentoo  Biscoe           48.8          16.2               222        [4m6[24m000 male   [4m2[24m009
## [90m5[39m Gentoo  Biscoe           45.2          16.4               223        [4m5[24m950 male   [4m2[24m008
## [90m6[39m Gentoo  Biscoe           49.8          15.9               229        [4m5[24m950 male   [4m2[24m009
```

---

# 8. dplyr

## **6. `arrange()`**

### Reordena de forma crescente ou decrescente pelos valores de v√°rias colunas


```r
# reordenar os valores por ordem crescente de varias colunas
penguins_arrange_across &lt;- penguins %&gt;% 
  dplyr::arrange(across(where(is.numeric)))
head(penguins_arrange_across)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Dream               32.1          15.5               188        [4m3[24m050 female  [4m2[24m009
## [90m2[39m Adelie  Dream               33.1          16.1               178        [4m2[24m900 female  [4m2[24m008
## [90m3[39m Adelie  Torgersen           33.5          19                 190        [4m3[24m600 female  [4m2[24m008
## [90m4[39m Adelie  Dream               34            17.1               185        [4m3[24m400 female  [4m2[24m008
## [90m5[39m Adelie  Torgersen           34.1          18.1               193        [4m3[24m475 [31mNA[39m      [4m2[24m007
## [90m6[39m Adelie  Torgersen           34.4          18.4               184        [4m3[24m325 female  [4m2[24m007
```

---

# 8. dplyr

## **7. `filter()`**

### Filtro de linhas por valores de uma coluna


```r
# filtrar linhas por valores de uma coluna
penguins_filter &lt;- penguins %&gt;% 
  dplyr::filter(species == "Adelie")
head(penguins_filter)
```

---

# 8. dplyr

## **7. `filter()`**

### Filtro de linhas por valores de uma coluna


```r
# filtrar linhas por valores de duas colunas
penguins_filter_two &lt;- penguins %&gt;% 
  dplyr::filter(species == "Adelie" &amp; sex == "female")
head(penguins_filter_two)
```

---

# 8. dplyr

## **7. `filter()`**

### Filtro de linhas por valores de uma coluna e v√°rios valores


```r
# filtrar linhas por mais de um valor e mais de uma coluna
penguins_filter_in &lt;- penguins %&gt;% 
  dplyr::filter(species %in% c("Adelie", "Gentoo"),
                sex == "female")
head(penguins_filter_in)
```

---

# 8. dplyr

## **7. `filter()`**

### Filtro por valores n√£o-NA


```r
# filtrar linhas por nas
penguins_filter_na &lt;- penguins %&gt;% 
  dplyr::filter(!is.na(sex) == TRUE)
head(penguins_filter_na)
```

---

# 8. dplyr

## **7. `filter()`**

### Filtro por intervalos


```r
# filtrar linhas por valores em um intervalo
penguins_filter_between &lt;- penguins %&gt;% 
  dplyr::filter(between(body_mass_g, 3000, 4000))
head(penguins_filter_between)
```

---

# 8. dplyr

## **7. `filter()`**

### Filtro linhas por v√°rias colunas simultaneamente


```r
# filtrar linhas por valores de varias colunas
penguins_filter_if &lt;- penguins %&gt;% 
  dplyr::filter(if_all(where(is.integer), ~ . &gt; 200))
head(penguins_filter_if)
```

---

# 8. dplyr

## **8. `slice()`** 

### Sele√ß√£o das linhas por intervalos, indicando quais linhas desejamos


```r
# selecionar linhas por intervalos
penguins_slice &lt;- penguins %&gt;% 
  dplyr::slice(n = c(1, 3, 300:n()))
head(penguins_slice)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species   island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
##   [3m[90m&lt;fct&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie    Torgersen           39.1          18.7               181        [4m3[24m750 male    [4m2[24m007
## [90m2[39m Adelie    Torgersen           40.3          18                 195        [4m3[24m250 female  [4m2[24m007
## [90m3[39m Chinstrap Dream               50.6          19.4               193        [4m3[24m800 male    [4m2[24m007
## [90m4[39m Chinstrap Dream               46.7          17.9               195        [4m3[24m300 female  [4m2[24m007
## [90m5[39m Chinstrap Dream               52            19                 197        [4m4[24m150 male    [4m2[24m007
## [90m6[39m Chinstrap Dream               50.5          18.4               200        [4m3[24m400 female  [4m2[24m008
```

---

# 8. dplyr

## **8. `slice()`** 

### Sele√ß√£o das linhas iniciais


```r
# selecionar linhas iniciais
penguins_slice_head &lt;- penguins %&gt;% 
  dplyr::slice_head(n = 5)
head(penguins_slice_head)
```

```
## [90m# A tibble: 5 √ó 8[39m
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Torgersen           39.1          18.7               181        [4m3[24m750 male    [4m2[24m007
## [90m2[39m Adelie  Torgersen           39.5          17.4               186        [4m3[24m800 female  [4m2[24m007
## [90m3[39m Adelie  Torgersen           40.3          18                 195        [4m3[24m250 female  [4m2[24m007
## [90m4[39m Adelie  Torgersen           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m [31mNA[39m      [4m2[24m007
## [90m5[39m Adelie  Torgersen           36.7          19.3               193        [4m3[24m450 female  [4m2[24m007
```

---

# 8. dplyr

## **8. `slice()`** 

### Sele√ß√£o de linhas por valores de uma coluna


```r
# selecionar linhas por valores de uma coluna
penguins_slice_max &lt;- penguins %&gt;% 
  dplyr::slice_max(body_mass_g, n = 5)
head(penguins_slice_max)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex    year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m           [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Gentoo  Biscoe           49.2          15.2               221        [4m6[24m300 male   [4m2[24m007
## [90m2[39m Gentoo  Biscoe           59.6          17                 230        [4m6[24m050 male   [4m2[24m007
## [90m3[39m Gentoo  Biscoe           51.1          16.3               220        [4m6[24m000 male   [4m2[24m008
## [90m4[39m Gentoo  Biscoe           48.8          16.2               222        [4m6[24m000 male   [4m2[24m009
## [90m5[39m Gentoo  Biscoe           45.2          16.4               223        [4m5[24m950 male   [4m2[24m008
## [90m6[39m Gentoo  Biscoe           49.8          15.9               229        [4m5[24m950 male   [4m2[24m009
```

---

# 8. dplyr

## **8. `slice()`** 

### Sele√ß√£o de linhas aleatoriamente


```r
# selecionar linhas aleatoriamente
penguins_slice_sample &lt;- penguins %&gt;% 
  dplyr::slice_sample(n = 30)
head(penguins_slice_sample)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m           [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Gentoo  Biscoe           48.2          15.6               221        [4m5[24m100 male    [4m2[24m008
## [90m2[39m Adelie  Biscoe           35.7          16.9               185        [4m3[24m150 female  [4m2[24m008
## [90m3[39m Adelie  Biscoe           41            20                 203        [4m4[24m725 male    [4m2[24m009
## [90m4[39m Gentoo  Biscoe           46.2          14.5               209        [4m4[24m800 female  [4m2[24m007
## [90m5[39m Adelie  Dream            37.8          18.1               193        [4m3[24m750 male    [4m2[24m009
## [90m6[39m Gentoo  Biscoe           50            15.3               220        [4m5[24m550 male    [4m2[24m007
```

---

# 8. dplyr

## **9. `distinct()`**

###  Retira linhas com valores duplicados com base nos valores de colunas


```r
# retirar linhas com valores duplicados
penguins_distinct &lt;- penguins %&gt;% 
  dplyr::distinct(body_mass_g)
head(penguins_distinct)
```

```
## [90m# A tibble: 6 √ó 1[39m
##   body_mass_g
##         [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m        [4m3[24m750
## [90m2[39m        [4m3[24m800
## [90m3[39m        [4m3[24m250
## [90m4[39m          [31mNA[39m
## [90m5[39m        [4m3[24m450
## [90m6[39m        [4m3[24m650
```

---

# 8. dplyr

## **9. `distinct()`**

###  Retira linhas com valores duplicados com base nos valores de colunas, mas mantendo as colunas


```r
# retirar linhas com valores duplicados e manter colunas
penguins_distinct_keep_all &lt;- penguins %&gt;% 
  dplyr::distinct(body_mass_g, .keep_all = TRUE)
head(penguins_distinct_keep_all)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Torgersen           39.1          18.7               181        [4m3[24m750 male    [4m2[24m007
## [90m2[39m Adelie  Torgersen           39.5          17.4               186        [4m3[24m800 female  [4m2[24m007
## [90m3[39m Adelie  Torgersen           40.3          18                 195        [4m3[24m250 female  [4m2[24m007
## [90m4[39m Adelie  Torgersen           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m [31mNA[39m      [4m2[24m007
## [90m5[39m Adelie  Torgersen           36.7          19.3               193        [4m3[24m450 female  [4m2[24m007
## [90m6[39m Adelie  Torgersen           39.3          20.6               190        [4m3[24m650 male    [4m2[24m007
```

---

# 8. dplyr

## **9. `distinct()`**

###  Retira linhas com valores duplicados para v√°rias colunas


```r
# retirar linhas com valores duplicados para varias colunas
penguins_distinct_keep_all_across &lt;- penguins %&gt;% 
  dplyr::distinct(across(where(is.integer)), .keep_all = TRUE)
head(penguins_distinct_keep_all_across)
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Torgersen           39.1          18.7               181        [4m3[24m750 male    [4m2[24m007
## [90m2[39m Adelie  Torgersen           39.5          17.4               186        [4m3[24m800 female  [4m2[24m007
## [90m3[39m Adelie  Torgersen           40.3          18                 195        [4m3[24m250 female  [4m2[24m007
## [90m4[39m Adelie  Torgersen           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m [31mNA[39m      [4m2[24m007
## [90m5[39m Adelie  Torgersen           36.7          19.3               193        [4m3[24m450 female  [4m2[24m007
## [90m6[39m Adelie  Torgersen           39.3          20.6               190        [4m3[24m650 male    [4m2[24m007
```

---

# 8. dplyr

## **10. `count()`**

### Conta valores de uma ou mais colunas, geralmente para vari√°veis categ√≥ricas


```r
# contagens de valores para uma coluna
penguins_count &lt;- penguins %&gt;% 
  dplyr::count(species)
penguins_count
```

```
## [90m# A tibble: 3 √ó 2[39m
##   species       n
##   [3m[90m&lt;fct&gt;[39m[23m     [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie      152
## [90m2[39m Chinstrap    68
## [90m3[39m Gentoo      124
```

---

# 8. dplyr

## **10. `count()`**

### Conta valores de uma ou mais colunas, geralmente para vari√°veis categ√≥ricas


```r
# contagens de valores para mais de uma coluna
penguins_count_two &lt;- penguins %&gt;% 
  dplyr::count(species, island)
penguins_count_two
```

```
## [90m# A tibble: 5 √ó 3[39m
##   species   island        n
##   [3m[90m&lt;fct&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m     [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie    Biscoe       44
## [90m2[39m Adelie    Dream        56
## [90m3[39m Adelie    Torgersen    52
## [90m4[39m Chinstrap Dream        68
## [90m5[39m Gentoo    Biscoe      124
```

---

# 8. dplyr

## **11. `groun_by()`**

### Transforma um tibble em um tibble agrupado, onde as opera√ß√µes s√£o realizadas "por grupo"


```r
# agrupamento
penguins_group_by &lt;- penguins %&gt;% 
  dplyr::group_by(species)
head(penguins_group_by)
```

```
## [90m# A tibble: 6 √ó 8[39m
## [90m# Groups:   species [1][39m
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Torgersen           39.1          18.7               181        [4m3[24m750 male    [4m2[24m007
## [90m2[39m Adelie  Torgersen           39.5          17.4               186        [4m3[24m800 female  [4m2[24m007
## [90m3[39m Adelie  Torgersen           40.3          18                 195        [4m3[24m250 female  [4m2[24m007
## [90m4[39m Adelie  Torgersen           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m [31mNA[39m      [4m2[24m007
## [90m5[39m Adelie  Torgersen           36.7          19.3               193        [4m3[24m450 female  [4m2[24m007
## [90m6[39m Adelie  Torgersen           39.3          20.6               190        [4m3[24m650 male    [4m2[24m007
```

---

# 8. dplyr

## **11. `groun_by()`**

### Transforma um tibble em um tibble agrupado, onde as opera√ß√µes s√£o realizadas "por grupo"


```r
# agrupamento de v√°rias colunas
penguins_group_by_across &lt;- penguins %&gt;% 
  dplyr::group_by(across(where(is.factor)))
head(penguins_group_by_across)
```

```
## [90m# A tibble: 6 √ó 8[39m
## [90m# Groups:   species, island, sex [3][39m
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Adelie  Torgersen           39.1          18.7               181        [4m3[24m750 male    [4m2[24m007
## [90m2[39m Adelie  Torgersen           39.5          17.4               186        [4m3[24m800 female  [4m2[24m007
## [90m3[39m Adelie  Torgersen           40.3          18                 195        [4m3[24m250 female  [4m2[24m007
## [90m4[39m Adelie  Torgersen           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m [31mNA[39m      [4m2[24m007
## [90m5[39m Adelie  Torgersen           36.7          19.3               193        [4m3[24m450 female  [4m2[24m007
## [90m6[39m Adelie  Torgersen           39.3          20.6               190        [4m3[24m650 male    [4m2[24m007
```

---

# 8. dplyr

## **12. `summarise()`**

### Agrega√ß√£o ou resumo dos dados atrav√©s de fun√ß√µes


```r
# resumo
penguins_summarise &lt;- penguins %&gt;% 
  dplyr::group_by(species) %&gt;% 
  dplyr::summarize(body_mass_g_mean = mean(body_mass_g, na.rm = TRUE),
                   body_mass_g_sd = sd(body_mass_g, na.rm = TRUE))
penguins_summarise
```

```
## [90m# A tibble: 3 √ó 3[39m
##   species   body_mass_g_mean body_mass_g_sd
##   [3m[90m&lt;fct&gt;[39m[23m                [3m[90m&lt;dbl&gt;[39m[23m          [3m[90m&lt;dbl&gt;[39m[23m
## [90m1[39m Adelie               [4m3[24m701.           459.
## [90m2[39m Chinstrap            [4m3[24m733.           384.
## [90m3[39m Gentoo               [4m5[24m076.           504.
```

---

# 8. dplyr

## **12. `summarise()`**

### Agrega√ß√£o ou resumo dos dados atrav√©s de fun√ß√µes


```r
# resumo para v√°rias colunas
penguins_summarise_across &lt;- penguins %&gt;% 
  dplyr::group_by(species) %&gt;% 
  dplyr::summarize(across(where(is.numeric), ~ mean(.x, na.rm = TRUE)))
penguins_summarise_across
```

```
## [90m# A tibble: 3 √ó 6[39m
##   species   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year
##   [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;dbl&gt;[39m[23m       [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m
## [90m1[39m Adelie              38.8          18.3              190.       [4m3[24m701. [4m2[24m008.
## [90m2[39m Chinstrap           48.8          18.4              196.       [4m3[24m733. [4m2[24m008.
## [90m3[39m Gentoo              47.5          15.0              217.       [4m5[24m076. [4m2[24m008.
```

---

# 8. dplyr

## **13. `bind_rows()` e `bind_cols()`**

### Combina dados por linhas e por colunas


```r
# selecionar as linhas para dois tibbles
penguins_01 &lt;- dplyr::slice(penguins, 1:5) %&gt;% dplyr::select(1:3)
penguins_02 &lt;- dplyr::slice(penguins, 51:55) %&gt;% dplyr::select(4:6)

# combinar as linhas
penguins_bind_rows &lt;- dplyr::bind_rows(penguins_01, penguins_02, .id = "id")
head(penguins_bind_rows)
```

```
## [90m# A tibble: 6 √ó 7[39m
##   id    species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##   [3m[90m&lt;chr&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m 1     Adelie  Torgersen           39.1          [31mNA[39m                  [31mNA[39m          [31mNA[39m
## [90m2[39m 1     Adelie  Torgersen           39.5          [31mNA[39m                  [31mNA[39m          [31mNA[39m
## [90m3[39m 1     Adelie  Torgersen           40.3          [31mNA[39m                  [31mNA[39m          [31mNA[39m
## [90m4[39m 1     Adelie  Torgersen           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m
## [90m5[39m 1     Adelie  Torgersen           36.7          [31mNA[39m                  [31mNA[39m          [31mNA[39m
## [90m6[39m 2     [31mNA[39m      [31mNA[39m                  [31mNA[39m            17.7               186        [4m3[24m500
```

---

# 8. dplyr

## **13. `bind_rows()` e `bind_cols()`**

### Combina dados por linhas e por colunas


```r
# selecionar as linhas para dois tibbles
penguins_01 &lt;- dplyr::slice(penguins, 1:5)
penguins_02 &lt;- dplyr::slice(penguins, 51:55)

## combinar as colunas
penguins_bind_cols &lt;- dplyr::bind_cols(penguins_01, penguins_02, .name_repair = "unique")
head(penguins_bind_cols)
```

```
## [90m# A tibble: 5 √ó 16[39m
##   species...1 island...2 bill_length_mm...3 bill_depth_mm...4 flipper_length_mm...5 body_mass_g...6 sex...7 year...8 species...9 island...10
##   [3m[90m&lt;fct&gt;[39m[23m       [3m[90m&lt;fct&gt;[39m[23m                   [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;dbl&gt;[39m[23m                 [3m[90m&lt;int&gt;[39m[23m           [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m      [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m       [3m[90m&lt;fct&gt;[39m[23m      
## [90m1[39m Adelie      Torgersen                39.1              18.7                   181            [4m3[24m750 male        [4m2[24m007 Adelie      Biscoe     
## [90m2[39m Adelie      Torgersen                39.5              17.4                   186            [4m3[24m800 female      [4m2[24m007 Adelie      Biscoe     
## [90m3[39m Adelie      Torgersen                40.3              18                     195            [4m3[24m250 female      [4m2[24m007 Adelie      Biscoe     
## [90m4[39m Adelie      Torgersen                [31mNA[39m                [31mNA[39m                      [31mNA[39m              [31mNA[39m [31mNA[39m          [4m2[24m007 Adelie      Biscoe     
## [90m5[39m Adelie      Torgersen                36.7              19.3                   193            [4m3[24m450 female      [4m2[24m007 Adelie      Biscoe     
## [90m# ‚Ä¶ with 6 more variables: bill_length_mm...11 &lt;dbl&gt;, bill_depth_mm...12 &lt;dbl&gt;, flipper_length_mm...13 &lt;int&gt;, body_mass_g...14 &lt;int&gt;,[39m
## [90m#   sex...15 &lt;fct&gt;, year...16 &lt;int&gt;[39m
```

---

background-image: url(img/dplyr_join.png)
background-size: 300px
background-position: 85% 80%

# 8. dplyr

## **14. `*_join()`**

### Combina√ß√£o de pares de dados tabulares por uma ou mais colunas chaves

#### Jun√ß√£o de muta√ß√£o
- `left_join(x, y)`: mant√©m as observa√ß√µes em x
- `right_join(x, y)`: mant√©m as observa√ß√µes em y
- `inner_join(x, y)`: mant√©m apenas as observa√ß√µes em x e em y
- `full_join(x, y)`: mant√©m todas as observa√ß√µes em x e em y

#### Jun√ß√£o de filtragem
- `semi_join(x, y)`: mant√©m as observa√ß√µes em x que t√™m uma &lt;br&gt; correspond√™ncia em y
- `anti_join(x, y)`: elimina as observa√ß√µes em x que t√™m uma  &lt;br&gt; correspond√™ncia em y

[Joining Data in R with dplyr](https://rpubs.com/williamsurles/293454)

---

background-image: url(img/gif_dplyr_left_join.gif)
background-size: 300px
background-position: 20% 10%

# 8. dplyr

## **14. `*_join()`**

---

background-image: url(img/gif_dplyr_left_join.gif), url(img/gif_dplyr_right_join.gif)
background-size: 300px, 300px
background-position: 20% 10%, 80% 10%

# 8. dplyr

## **14. `*_join()`**

---

background-image: url(img/gif_dplyr_left_join.gif), url(img/gif_dplyr_right_join.gif), url(img/gif_dplyr_inner_join.gif)
background-size: 300px, 300px, 300px
background-position: 20% 10%, 80% 10%, 20% 100%

# 8. dplyr

## **14. `*_join()`**

---

background-image: url(img/gif_dplyr_left_join.gif), url(img/gif_dplyr_right_join.gif), url(img/gif_dplyr_inner_join.gif), url(img/gif_dplyr_full_join.gif)
background-size: 300px, 300px, 300px, 300px
background-position: 20% 10%, 80% 10%, 20% 100%, 80% 105%

# 8. dplyr

## **14. `*_join()`**

---

# 8. dplyr

## **14. `*_join()`**

## Adicionar longitute e latitude para as ilhas amostradas


```r
## coordenadas
penguin_islands &lt;- tibble(
  island = c("Torgersen", "Biscoe", "Dream", "Alpha"),
  longitude = c(-64.083333, -63.775636, -64.233333, -63),
  latitude = c(-64.766667, -64.818569, -64.733333, -64.316667))
penguin_islands
```

```
## [90m# A tibble: 4 √ó 3[39m
##   island    longitude latitude
##   [3m[90m&lt;chr&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m    [3m[90m&lt;dbl&gt;[39m[23m
## [90m1[39m Torgersen     -[31m64[39m[31m.[39m[31m1[39m    -[31m64[39m[31m.[39m[31m8[39m
## [90m2[39m Biscoe        -[31m63[39m[31m.[39m[31m8[39m    -[31m64[39m[31m.[39m[31m8[39m
## [90m3[39m Dream         -[31m64[39m[31m.[39m[31m2[39m    -[31m64[39m[31m.[39m[31m7[39m
## [90m4[39m Alpha         -[31m63[39m      -[31m64[39m[31m.[39m[31m3[39m
```

---

# 8. dplyr

## **14. `*_join()`**

## Adicionar longitute e latitude para as ilhas amostradas


```r
# juncao - left
penguins_left_join &lt;- dplyr::left_join(penguins, penguin_islands, by = "island")
head(penguins_left_join)
```

```
## [90m# A tibble: 6 √ó 10[39m
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year longitude latitude
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;chr&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m     [3m[90m&lt;dbl&gt;[39m[23m    [3m[90m&lt;dbl&gt;[39m[23m
## [90m1[39m Adelie  Torgersen           39.1          18.7               181        [4m3[24m750 male    [4m2[24m007     -[31m64[39m[31m.[39m[31m1[39m    -[31m64[39m[31m.[39m[31m8[39m
## [90m2[39m Adelie  Torgersen           39.5          17.4               186        [4m3[24m800 female  [4m2[24m007     -[31m64[39m[31m.[39m[31m1[39m    -[31m64[39m[31m.[39m[31m8[39m
## [90m3[39m Adelie  Torgersen           40.3          18                 195        [4m3[24m250 female  [4m2[24m007     -[31m64[39m[31m.[39m[31m1[39m    -[31m64[39m[31m.[39m[31m8[39m
## [90m4[39m Adelie  Torgersen           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m [31mNA[39m      [4m2[24m007     -[31m64[39m[31m.[39m[31m1[39m    -[31m64[39m[31m.[39m[31m8[39m
## [90m5[39m Adelie  Torgersen           36.7          19.3               193        [4m3[24m450 female  [4m2[24m007     -[31m64[39m[31m.[39m[31m1[39m    -[31m64[39m[31m.[39m[31m8[39m
## [90m6[39m Adelie  Torgersen           39.3          20.6               190        [4m3[24m650 male    [4m2[24m007     -[31m64[39m[31m.[39m[31m1[39m    -[31m64[39m[31m.[39m[31m8[39m
```

---

background-image: url(img/dplyr_conjuntos.png)
background-size: 400px
background-position: 90% 70%    

# 8. dplyr

## **15. Opera√ß√µes de conjuntos e compara√ß√£o de dados**

### Opera√ß√µes para  comparar dos dados

- `union(x, y)`: retorna todas as linhas que aparecem em x, &lt;br&gt; y ou mais dos conjuntos de dados
- `interesect(x, y)`: retorna apenas as linhas que aparecem &lt;br&gt;  em x e em y
- `setdiff(x, y)`: retorna as linhas que aparecem x, mas n√£o em y
- `setequal(x, y)`: retorna se x e y s√£o iguais e quais suas diferen√ßas

---

class: inverse, center, middle

# IMPORTANTE: ideia de **encadeamento das fun√ß√µes**

---

# 8. dplyr

## Permite manipular os dados de forma simples


```r
# selecionar colunas
penguins_dplyr &lt;- penguins %&gt;% 
  dplyr::select(species, bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g)
penguins_dplyr
```

```
## [90m# A tibble: 344 √ó 5[39m
##    species bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##    [3m[90m&lt;fct&gt;[39m[23m            [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m
## [90m 1[39m Adelie            39.1          18.7               181        [4m3[24m750
## [90m 2[39m Adelie            39.5          17.4               186        [4m3[24m800
## [90m 3[39m Adelie            40.3          18                 195        [4m3[24m250
## [90m 4[39m Adelie            [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m
## [90m 5[39m Adelie            36.7          19.3               193        [4m3[24m450
## [90m 6[39m Adelie            39.3          20.6               190        [4m3[24m650
## [90m 7[39m Adelie            38.9          17.8               181        [4m3[24m625
## [90m 8[39m Adelie            39.2          19.6               195        [4m4[24m675
## [90m 9[39m Adelie            34.1          18.1               193        [4m3[24m475
## [90m10[39m Adelie            42            20.2               190        [4m4[24m250
## [90m# ‚Ä¶ with 334 more rows[39m
```

---

# 8. dplyr
## Permite manipular os dados de forma simples

```r
# selecionar colunas e retirar linhas com nas
penguins_dplyr &lt;- penguins %&gt;% 
  dplyr::select(species, bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g) %&gt;% 
  dplyr::filter(if_all(where(is.numeric), ~ !is.na(.)))
penguins_dplyr
```

```
## [90m# A tibble: 342 √ó 5[39m
##    species bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##    [3m[90m&lt;fct&gt;[39m[23m            [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m
## [90m 1[39m Adelie            39.1          18.7               181        [4m3[24m750
## [90m 2[39m Adelie            39.5          17.4               186        [4m3[24m800
## [90m 3[39m Adelie            40.3          18                 195        [4m3[24m250
## [90m 4[39m Adelie            36.7          19.3               193        [4m3[24m450
## [90m 5[39m Adelie            39.3          20.6               190        [4m3[24m650
## [90m 6[39m Adelie            38.9          17.8               181        [4m3[24m625
## [90m 7[39m Adelie            39.2          19.6               195        [4m4[24m675
## [90m 8[39m Adelie            34.1          18.1               193        [4m3[24m475
## [90m 9[39m Adelie            42            20.2               190        [4m4[24m250
## [90m10[39m Adelie            37.8          17.1               186        [4m3[24m300
## [90m# ‚Ä¶ with 332 more rows[39m
```

---

# 8. dplyr
## Permite manipular os dados de forma simples

```r
# selecionar colunas, retirar linhas com nas e calcular a media das colunas para as especies
penguins_dplyr &lt;- penguins %&gt;% 
  dplyr::select(species, bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g) %&gt;% 
  dplyr::filter(if_all(where(is.numeric), ~ !is.na(.))) %&gt;% 
  dplyr::group_by(species) %&gt;% 
  dplyr::summarize(across(where(is.numeric), ~ mean(.x, na.rm = TRUE)))
penguins_dplyr
```

```
## [90m# A tibble: 3 √ó 5[39m
##   species   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##   [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;dbl&gt;[39m[23m       [3m[90m&lt;dbl&gt;[39m[23m
## [90m1[39m Adelie              38.8          18.3              190.       [4m3[24m701.
## [90m2[39m Chinstrap           48.8          18.4              196.       [4m3[24m733.
## [90m3[39m Gentoo              47.5          15.0              217.       [4m5[24m076.
```

---

class: inverse, center, middle

# Exerc√≠cios

---

# Exerc√≠cio 12

### Usando o conjunto de dados `penguins`, adicione essas novas colunas `bill_length_mm_log10, bill_depth_mm_log10, flipper_length_mm_log10, body_mass_g_log10`, que s√£o a opera√ß√£o `log10` das colunas `bill_length_mm_log10, bill_depth_mm_log10, flipper_length_mm_log10, body_mass_g_log10` e atribua ao mesmo objeto `penguins_log` utilizando o formato tidyverse

<div class="countdown" id="timer_617076f3" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">04</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exerc√≠cio 12

## Solu√ß√£o


```r
# exercicio 12
penguins_log &lt;- penguins %&gt;% 
  dplyr::mutate(bill_length_mm_log10 = log10(bill_length_mm), 
                bill_depth_mm_log10 = log10(bill_depth_mm), 
                flipper_length_mm_log10 = log10(flipper_length_mm), 
                body_mass_g_log10 = log10(body_mass_g))
penguins_log
```

```
## [90m# A tibble: 344 √ó 12[39m
##    species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year bill_length_mm_l‚Ä¶ bill_depth_mm_l‚Ä¶ flipper_length_m‚Ä¶
##    [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m             [3m[90m&lt;dbl&gt;[39m[23m            [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m Adelie  Torgersen           39.1          18.7               181        [4m3[24m750 male    [4m2[24m007              1.59             1.27              2.26
## [90m 2[39m Adelie  Torgersen           39.5          17.4               186        [4m3[24m800 female  [4m2[24m007              1.60             1.24              2.27
## [90m 3[39m Adelie  Torgersen           40.3          18                 195        [4m3[24m250 female  [4m2[24m007              1.61             1.26              2.29
## [90m 4[39m Adelie  Torgersen           [31mNA[39m            [31mNA[39m                  [31mNA[39m          [31mNA[39m [31mNA[39m      [4m2[24m007             [31mNA[39m               [31mNA[39m                [31mNA[39m   
## [90m 5[39m Adelie  Torgersen           36.7          19.3               193        [4m3[24m450 female  [4m2[24m007              1.56             1.29              2.29
## [90m 6[39m Adelie  Torgersen           39.3          20.6               190        [4m3[24m650 male    [4m2[24m007              1.59             1.31              2.28
## [90m 7[39m Adelie  Torgersen           38.9          17.8               181        [4m3[24m625 female  [4m2[24m007              1.59             1.25              2.26
## [90m 8[39m Adelie  Torgersen           39.2          19.6               195        [4m4[24m675 male    [4m2[24m007              1.59             1.29              2.29
## [90m 9[39m Adelie  Torgersen           34.1          18.1               193        [4m3[24m475 [31mNA[39m      [4m2[24m007              1.53             1.26              2.29
## [90m10[39m Adelie  Torgersen           42            20.2               190        [4m4[24m250 [31mNA[39m      [4m2[24m007              1.62             1.31              2.28
## [90m# ‚Ä¶ with 334 more rows, and 1 more variable: body_mass_g_log10 &lt;dbl&gt;[39m
```

---

# Exerc√≠cio 13

### Usando o conjunto de dados `penguins`, ordene as linhas em forma decrescente pela coluna `body_mass_g`, atribuindo o resultado a um novo objeto `penguins_arrange` utilizando o formato tidyverse

<div class="countdown" id="timer_61707735" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">04</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exerc√≠cio 13

## Solu√ß√£o


```r
# exercicio 13
penguins_arrange &lt;- penguins %&gt;% 
  dplyr::arrange(-body_mass_g)
penguins_arrange
```

```
## [90m# A tibble: 344 √ó 8[39m
##    species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex    year
##    [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m           [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m
## [90m 1[39m Gentoo  Biscoe           49.2          15.2               221        [4m6[24m300 male   [4m2[24m007
## [90m 2[39m Gentoo  Biscoe           59.6          17                 230        [4m6[24m050 male   [4m2[24m007
## [90m 3[39m Gentoo  Biscoe           51.1          16.3               220        [4m6[24m000 male   [4m2[24m008
## [90m 4[39m Gentoo  Biscoe           48.8          16.2               222        [4m6[24m000 male   [4m2[24m009
## [90m 5[39m Gentoo  Biscoe           45.2          16.4               223        [4m5[24m950 male   [4m2[24m008
## [90m 6[39m Gentoo  Biscoe           49.8          15.9               229        [4m5[24m950 male   [4m2[24m009
## [90m 7[39m Gentoo  Biscoe           48.4          14.6               213        [4m5[24m850 male   [4m2[24m007
## [90m 8[39m Gentoo  Biscoe           49.3          15.7               217        [4m5[24m850 male   [4m2[24m007
## [90m 9[39m Gentoo  Biscoe           55.1          16                 230        [4m5[24m850 male   [4m2[24m009
## [90m10[39m Gentoo  Biscoe           49.5          16.2               229        [4m5[24m800 male   [4m2[24m008
## [90m# ‚Ä¶ with 334 more rows[39m
```

---

# Exerc√≠cio 14

### Usando o conjunto de dados `penguins`, filtre as linhas com `bill_length_mm` maior que 50 mm, `bill_depth_mm` menor que 20 mm, `flipper_length_mm` maior que 220 mm e `body_mass_g` menor que 5500 g, atribuindo o resultado a um novo objeto `penguins_filter` utilizando o formato tidyverse

<div class="countdown" id="timer_617077a2" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">04</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exerc√≠cio 14

## Solu√ß√£o


```r
# exercicio 14
penguins_filter &lt;- penguins %&gt;% 
  dplyr::filter(bill_length_mm &gt; 50, 
                bill_depth_mm &lt; 20, 
                flipper_length_mm &gt; 220, 
                body_mass_g &lt; 5500)
penguins_filter
```

```
## [90m# A tibble: 6 √ó 8[39m
##   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex    year
##   [3m[90m&lt;fct&gt;[39m[23m   [3m[90m&lt;fct&gt;[39m[23m           [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m
## [90m1[39m Gentoo  Biscoe           50.5          15.9               225        [4m5[24m400 male   [4m2[24m008
## [90m2[39m Gentoo  Biscoe           50.1          15                 225        [4m5[24m000 male   [4m2[24m008
## [90m3[39m Gentoo  Biscoe           52.5          15.6               221        [4m5[24m450 male   [4m2[24m009
## [90m4[39m Gentoo  Biscoe           52.2          17.1               228        [4m5[24m400 male   [4m2[24m009
## [90m5[39m Gentoo  Biscoe           50.8          15.7               226        [4m5[24m200 male   [4m2[24m009
## [90m6[39m Gentoo  Biscoe           51.1          16.5               225        [4m5[24m250 male   [4m2[24m009
```

---

# Exerc√≠cio 15

### Usando o conjunto de dados `penguins`, amostre 70% das linhas aleatoriamente com `body_mass_g` menor que  5000 g, atribuindo o resultado a um novo objeto `penguins_sample` utilizando o formato tidyverse

<div class="countdown" id="timer_61707a3f" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">01</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">30</span></code>
</div>

---

# Exerc√≠cio 15

## Solu√ß√£o


```r
# exercicio 15
penguins_sample &lt;- penguins %&gt;% 
  dplyr::filter(body_mass_g &lt; 5000) %&gt;% 
  dplyr::slice_sample(prop = .7)
penguins_sample
```

```
## [90m# A tibble: 192 √ó 8[39m
##    species   island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
##    [3m[90m&lt;fct&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m           [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m             [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m
## [90m 1[39m Gentoo    Biscoe           47.2          13.7               214        [4m4[24m925 female  [4m2[24m009
## [90m 2[39m Adelie    Dream            39.6          18.1               186        [4m4[24m450 male    [4m2[24m008
## [90m 3[39m Gentoo    Biscoe           45.5          13.9               210        [4m4[24m200 female  [4m2[24m008
## [90m 4[39m Chinstrap Dream            50.8          18.5               201        [4m4[24m450 male    [4m2[24m009
## [90m 5[39m Adelie    Dream            41.1          17.5               190        [4m3[24m900 male    [4m2[24m009
## [90m 6[39m Chinstrap Dream            50.7          19.7               203        [4m4[24m050 male    [4m2[24m009
## [90m 7[39m Gentoo    Biscoe           45.8          14.6               210        [4m4[24m200 female  [4m2[24m007
## [90m 8[39m Adelie    Dream            40.6          17.2               187        [4m3[24m475 male    [4m2[24m009
## [90m 9[39m Adelie    Dream            39.5          16.7               178        [4m3[24m250 female  [4m2[24m007
## [90m10[39m Adelie    Biscoe           34.5          18.1               187        [4m2[24m900 female  [4m2[24m008
## [90m# ‚Ä¶ with 182 more rows[39m
```

---

class: clear
background-image: url(img/package_stringr.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[stringr](https://stringr.tidyverse.org/)

---

background-image: url(img/cheatsheet_stringr.png)
background-size: 600px
background-position: 50% 50%

# 9. stringr

## Work with Strings Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Work with Strings Cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/strings.pdf)

---

# 9. stringr

## Descri√ß√£o

### Pacote para a manipula√ß√£o de strings ou caracteres

--

### Exemplos: Correspond√™ncia de padr√µes, retirar e acrescentar espa√ßos em branco, mudar mai√∫sculas e min√∫sculas

--

### Pode ser utilizado em conjunto com o pacote `dplyr` para manejar colunas

--

### Para fun√ß√µes mais espec√≠ficas, recomenda-se usar o pacote [stringi](https://stringi.gagolewski.com/)

---

# 9. stringr

## Comprimento


```r
# comprimento
stringr::str_length(string = "penguins")
```

```
## [1] 8
```

--

## Substituir


```r
# substituir
stringr::str_replace(string = "penguins", pattern = "i", replacement = "y")
```

```
## [1] "penguyns"
```

--

## Separar


```r
# separar
stringr::str_split(string = "p-e-n-g-u-i-n-s", pattern = "-", simplify = TRUE)
```

```
##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
## [1,] "p"  "e"  "n"  "g"  "u"  "i"  "n"  "s"
```

---

# 9. stringr

## Extrair pela posi√ß√£o


```r
# extrair pela posicao
stringr::str_sub(string = "penguins", end = 3)
```

```
## [1] "pen"
```

--

## Extrair por padr√£o


```r
# extrair por padrao
stringr::str_extract(string = "penguins", pattern = "p")
```

```
## [1] "p"
```

---

# 9. stringr

## Inserir espacos em branco


```r
# inserir espaco em branco - esquerda
stringr::str_pad(string = "penguins", width = 10, side = "left")
```

```
## [1] "  penguins"
```

```r
# inserir espaco em branco - direita
stringr::str_pad(string = "penguins", width = 10, side = "right")
```

```
## [1] "penguins  "
```

```r
# inserir espaco em branco - ambos
stringr::str_pad(string = "penguins", width = 10, side = "both")
```

```
## [1] " penguins "
```

---

# 9. stringr

## Remover espa√ßos em branco


```r
# remover espacos em branco - esquerda
stringr::str_trim(string = " penguins ", side = "left")
```

```
## [1] "penguins "
```

```r
# remover espacos em branco - direta
stringr::str_trim(string = " penguins ", side = "right")
```

```
## [1] " penguins"
```

```r
# remover espacos em branco - ambos
stringr::str_trim(string = " penguins ", side = "both")
```

```
## [1] "penguins"
```

---

# 9. stringr

## Alterar min√∫sculas e mai√∫sculas


```r
# minusculas
stringr::str_to_lower(string = "Penguins")
```

```
## [1] "penguins"
```

```r
# maiusculas
stringr::str_to_upper(string = "penguins")
```

```
## [1] "PENGUINS"
```

```r
# primeiro caracter maiusculo da primeira palavra
stringr::str_to_sentence(string = "palmer penGuins")
```

```
## [1] "Palmer penguins"
```

```r
# primeiro caracter maiusculo de cada palavra
stringr::str_to_title(string = "palmer penGuins")
```

```
## [1] "Palmer Penguins"
```

---

# 9. stringr

## Ordenar


```r
# ordenar - crescente
stringr::str_sort(x = letters)
```

```
##  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z"
```

```r
# ordenar - decrescente
stringr::str_sort(x = letters, dec = TRUE)
```

```
##  [1] "z" "y" "x" "w" "v" "u" "t" "s" "r" "q" "p" "o" "n" "m" "l" "k" "j" "i" "h" "g" "f" "e" "d" "c" "b" "a"
```

---

# 9. stringr

## Alterar valores das colunas


```r
# alterar valores das colunas
penguins_stringr_valores &lt;- penguins %&gt;% 
  dplyr::mutate(species = stringr::str_to_lower(species))
```

--

## Alterar nome das colunas


```r
# alterar nome das colunas
penguins_stringr_nomes &lt;- penguins %&gt;% 
  dplyr::rename_with(stringr::str_to_title)
```

---

class: clear
background-image: url(img/package_forcats.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[forcats](https://forcats.tidyverse.org/)

---

background-image: url(img/cheatsheet_forcats.png)
background-size: 600px
background-position: 50% 50%

# 10. forcats

## Factors with forcats Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Factors with forcats Cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/factors.pdf)

---

# 10. forcats

## Descri√ß√£o

### Conjunto de ferramentas √∫teis para facilitar a manipula√ß√£o de fatores e seus n√≠veis

--

### Exemplos: mudar a ordem dos n√≠veis, mudar os valores dos n√≠veis, adicionar e remover n√≠veis, combinar m√∫ltiplos n√≠veis

--

### Pode ser utilizado em conjunto com o pacote `dplyr` para manejar colunas

---

# 10. forcats

## Converter dados de string para fator


```r
# converter dados de string para fator
forcats::as_factor(penguins_raw$Species) %&gt;% head()
```

```
## [1] Adelie Penguin (Pygoscelis adeliae) Adelie Penguin (Pygoscelis adeliae) Adelie Penguin (Pygoscelis adeliae)
## [4] Adelie Penguin (Pygoscelis adeliae) Adelie Penguin (Pygoscelis adeliae) Adelie Penguin (Pygoscelis adeliae)
## Levels: Adelie Penguin (Pygoscelis adeliae) Gentoo penguin (Pygoscelis papua) Chinstrap penguin (Pygoscelis antarctica)
```

--

## Mudar o nome dos n√≠veis


```r
# mudar o nome dos niveis
forcats::fct_recode(penguins$species, a = "Adelie", c = "Chinstrap", g = "Gentoo") %&gt;% head()
```

```
## [1] a a a a a a
## Levels: a c g
```

---

# 10. forcats

## Inverter os n√≠veis


```r
# inverter os niveis
forcats::fct_rev(penguins$species) %&gt;% head()
```

```
## [1] Adelie Adelie Adelie Adelie Adelie Adelie
## Levels: Gentoo Chinstrap Adelie
```

--

## Especificar a ordem dos n√≠veis


```r
# especificar a ordem dos niveis
forcats::fct_relevel(penguins$species, "Chinstrap", "Gentoo", "Adelie") %&gt;% head()
```

```
## [1] Adelie Adelie Adelie Adelie Adelie Adelie
## Levels: Chinstrap Gentoo Adelie
```

---

# 10. forcats

## N√≠veis pela ordem em que aparecem


```r
# niveis pela ordem em que aparecem
forcats::fct_inorder(penguins$species) %&gt;% head()
```

```
## [1] Adelie Adelie Adelie Adelie Adelie Adelie
## Levels: Adelie Gentoo Chinstrap
```

## Ordem (decrescente) de frequ√™ncia


```r
# ordem (decrescente) de frequecia
forcats::fct_infreq(penguins$species) %&gt;% head()
```

```
## [1] Adelie Adelie Adelie Adelie Adelie Adelie
## Levels: Adelie Gentoo Chinstrap
```

---

# 10. forcats

## Agrega√ß√£o de n√≠veis raros em um n√≠vel


```r
# agregacao de niveis raros em um nivel
forcats::fct_lump(penguins$species) %&gt;% head()
```

```
## [1] Adelie Adelie Adelie Adelie Adelie Adelie
## Levels: Adelie Gentoo Other
```

--

## Transformar v√°rias colunas em fator


```r
# transformar varias colunas em fator
penguins_raw_multi_factor &lt;- penguins_raw %&gt;% 
  dplyr::mutate(across(where(is.character), forcats::as_factor))
```

---

class: clear
background-image: url(img/package_lubridate.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[lubridate](https://lubridate.tidyverse.org/)

---

background-image: url(img/cheatsheet_lubridate.png)
background-size: 550px
background-position: 50% 50%

# 11. lubridate

## Dates and Times Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Dates and Times Cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/lubridate.pdf)

---

background-image: url(img/lubridate_allison.png)
background-size: 400px
background-position: 50% 90%

# 11. lubridate

## Pacote √† parte do tidyverse

### Carregar sempre que for utilizar


```r
# carregar
library(lubridate)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[@allison_horst](https://twitter.com/allison_horst)

---

# 11. lubridate

## Descri√ß√£o

### Conjunto de fun√ß√µes para a manipula√ß√£o de dados de data e hor√°rio

--

### A manipula√ß√£o desses dados n√£o √© intuitiva e muda dependendo do tipo de objeto de data e hor√°rio

--

### O formato desses dados deve levar em considera√ß√£o Fusos hor√°rios, anos bissextos, hor√°rios de ver√£o, etc.

--

### Exemplos: transforma√ß√µes de data/hor√°rio, componentes, arredondamentos, dura√ß√µes, per√≠odos, intervalos, etc.

---

background-image: url(img/mhs_package.png)
background-size: 200px
background-position: 85% 90%

# 11. lubridate

## Tipos de dados

- **Data**: tempo em dias, meses e anos `&lt;date&gt;`
- **Hor√°rio**: tempo dentro de um dia `&lt;time&gt;`
- **Data-hor√°rio**: tempo em um instante (data mais tempo) `&lt;dttm&gt;`

### Para trabalhar exclusivamente com hor√°rios, podemos utilizar o pacote [hms](https://hms.tidyverse.org/)

### Algumas letras possuem significados temporais, sendo abrevia√ß√µes de diferentes per√≠odos em ingl√™s: 

&lt;br&gt;
- **y**ear (ano), **m**onth (m√™s) 

- **w**eak (semana), **d**ay (dia) 

- **h**our (hora), **m**inute (minuto) e **s**econd (segundo)

---

# 11. lubridate

## Data e hor√°rios atuais


```r
# extrair a data nesse instante
lubridate::today()
```

```
## [1] "2021-10-20"
```

```r
# extrair a data e tempo nesse instante
lubridate::now()
```

```
## [1] "2021-10-20 17:04:52 -03"
```

---

# 11. lubridate

## Existem tr√™s maneiras de criar um dado de data/hor√°rio

### 1. De um string ou caracter

### 2. De componentes individuais de data e hor√°rio

### 3. De um objeto de data/hor√°rio existente


---

# 11. lubridate

## **1. String ou caracter **

### Os dados de data/hor√°rio geralmente est√£o no formato de strings

### Podemos transformar os dados especificando a ordem dos seus componentes usando as letras `y` (ano), `m` (m√™s) e `d` (dia)


```r
# strings e numeros para datas
lubridate::dmy("03-03-2021")
```

```
## [1] "2021-03-03"
```

---

# 11. lubridate

## **1. String ou caracter **

### Essas fun√ß√µes tamb√©m aceitam n√∫meros sem aspas, al√©m funcionarem em outros diversos formatos


```r
# strings e numeros para datas
lubridate::dmy("03-Mar-2021")
lubridate::dmy(03032021)
lubridate::dmy("03032021")
lubridate::dmy("03/03/2021")
lubridate::dmy("03.03.2021")
```

---

# 11. lubridate

## **1. String ou caracter **

### Especificar hor√°rios e Fusos hor√°rios


```r
# especificar horarios e fuso horario
lubridate::dmy_h("03-03-2021 13")
lubridate::dmy_hm("03-03-2021 13:32")
lubridate::dmy_hms("03-03-2021 13:32:01")
lubridate::dmy_hms("03-03-2021 13:32:01", tz = "America/Sao_Paulo")
```

---

# 11. lubridate

## **2. Componentes individuais de data e hor√°rio**


```r
# dados com componentes individuais
dados &lt;- tibble::tibble(
  ano = c(2021, 2021, 2021),
  mes = c(1, 2, 3),
  dia = c(12, 20, 31),
  hora = c(2, 14, 18), 
  minuto = c(2, 44, 55))
dados
```

```
## [90m# A tibble: 3 √ó 5[39m
##     ano   mes   dia  hora minuto
##   [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m  [3m[90m&lt;dbl&gt;[39m[23m
## [90m1[39m  [4m2[24m021     1    12     2      2
## [90m2[39m  [4m2[24m021     2    20    14     44
## [90m3[39m  [4m2[24m021     3    31    18     55
```

---

# 11. lubridate

## **2. Componentes individuais de data e hor√°rio**


```r
# dados com componentes individuais
dados %&gt;% 
  dplyr::mutate(data = lubridate::make_datetime(ano, mes, dia, hora, minuto))
```

```
## [90m# A tibble: 3 √ó 6[39m
##     ano   mes   dia  hora minuto data               
##   [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m  [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dttm&gt;[39m[23m             
## [90m1[39m  [4m2[24m021     1    12     2      2 2021-01-12 [90m02:02:00[39m
## [90m2[39m  [4m2[24m021     2    20    14     44 2021-02-20 [90m14:44:00[39m
## [90m3[39m  [4m2[24m021     3    31    18     55 2021-03-31 [90m18:55:00[39m
```

---

# 11. lubridate

## **3. Objeto de data/hor√°rio existente**


```r
# data para data-horario
lubridate::as_datetime(today())
```

```
## [1] "2021-10-20 UTC"
```

```r
# data-horario para data
lubridate::as_date(now())
```

```
## [1] "2021-10-20"
```

---

# 11. lubridate

## Fun√ß√µes para acessar e definir componentes individuais de datas e hor√°rios

- `year()`: acessa o ano
- `month()`: acessa o m√™s
- `day()`: acessa o dia
- `yday()`: acessa o dia do ano
- `mday()`: acessa o dia do m√™s
- `wday()`: acessa o dia da semana
- `hour()`: acessa as horas
- `minute()`: acessa os minutos
- `second()`: acessa os segundos

---

# 11. lubridate

## Fun√ß√µes para acessar e definir componentes individuais de datas e hor√°rios


```r
# extrair
lubridate::year(now())
lubridate::month(now())
lubridate::month(now(), label = TRUE)
lubridate::day(now())
lubridate::wday(now())
lubridate::wday(now(), label = TRUE)
lubridate::second(now())
```

---

# 11. lubridate

## Inclusam de informa√ß√µes de datas e hor√°rios.


```r
# data
data &lt;- dmy_hms("04-03-2021 01:04:56")

# incluir
lubridate::year(data) &lt;- 2020
lubridate::month(data) &lt;- 01
lubridate::hour(data) &lt;- 13
```
--

```r
# incluir varios valores
update(data, year = 2020, month = 1, mday = 1, hour = 1)
```

```
## [1] "2020-01-01 01:04:56 UTC"
```

---

# 11. lubridate

## Opera√ß√µes com datas

### Muitas vezes precisamos fazer opera√ß√µes com datas, como subtra√ß√£o, adi√ß√£o e divis√£o. Para tanto, √© preciso entender tr√™s classes importantes que representam intervalos de tempo

### **1. Dura√ß√µes**: representam um n√∫mero exato de segundos

### **2. Per√≠odos**: representam unidades humanas como semanas e meses

### **3. Intervalos**: representam um ponto inicial e final

---

# 11. lubridate

## **1. Dura√ß√µes**

###Registram o intervalo de tempo em segundos, com alguma unidade de tempo maior entre par√™nteses

### Fun√ß√µes

- `duration()`: cria data em dura√ß√£o
- `as.duration()`: converte datas em dura√ß√£o
- `dyears()`: dura√ß√£o de anos
- `dmonths()`: dura√ß√£o de meses
- `dweeks()`: dura√ß√£o de semanas
- `ddays()`: dura√ß√£o de dias
- `dhours()`: dura√ß√£o de horas
- `dminutes()`: dura√ß√£o de minutos
- `dseconds()`: dura√ß√£o de segundos

---

# 11. lubridate

## **1. Dura√ß√µes**

### Subtra√ß√£o de datas e convers√£o para dura√ß√£o


```r
# subtracao de datas
tempo_estudando_r &lt;- lubridate::today() - lubridate::dmy("30-11-2011")

# conversao para duracao
tempo_estudando_r_dur &lt;- lubridate::as.duration(tempo_estudando_r)
```

---

# 11. lubridate

## **1. Dura√ß√µes**

### Criando dura√ß√µes


```r
# criando duracoes
lubridate::duration(90, "seconds")
```

```
## [1] "90s (~1.5 minutes)"
```

```r
lubridate::duration(1.5, "minutes")
```

```
## [1] "90s (~1.5 minutes)"
```

```r
lubridate::duration(1, "days")
```

```
## [1] "86400s (~1 days)"
```

---

# 11. lubridate

## **1. Dura√ß√µes**

### Transforma√ß√£o das dura√ß√µes


```r
# transformacao da duracao
lubridate::dseconds(100)
lubridate::dminutes(100)
lubridate::dhours(100)
lubridate::ddays(100)
lubridate::dweeks(100)
lubridate::dyears(100)
```

---

# 11. lubridate

## **1. Dura√ß√µes**

### Opera√ß√µes com dura√ß√µes


```r
# somando duracoes a datas
lubridate::today() + lubridate::ddays(1)
```

```
## [1] "2021-10-21"
```

```r
# subtraindo duracoes de datas
lubridate::today() - lubridate::dyears(1)
```

```
## [1] "2020-10-19 18:00:00 UTC"
```

```r
# multiplicando duracoes
2 * dyears(2)
```

```
## [1] "126230400s (~4 years)"
```

---

# 11. lubridate

## **2. Per√≠odos**

### S√£o extens√µes de tempo n√£o fixados em segundos como as dura√ß√µes, mas flex√≠veis, como dias, semanas, meses ou anos

### Fun√ß√µes

- `period()`: cria data em per√≠odo
- `as.period()`: converte datas em per√≠odo
- `seconds()`: per√≠odo em segundos
- `minutes()`: per√≠odo em minutos
- `hours()`: per√≠odo em horas
- `days()`: per√≠odo em dias
- `weeks()`: per√≠odo em semanas
- `months()`: per√≠odo em meses
- `years()`: per√≠odo em anos

---

# 11. lubridate

## **2. Per√≠odos**

### Criando per√≠odos


```r
# criando periodos
period(c(90, 5), c("second", "minute"))
```

```
## [1] "5M 90S"
```

```r
period(c(3, 1, 2, 13, 1), c("second", "minute", "hour", "day", "week"))
```

```
## [1] "20d 2H 1M 3S"
```

---

# 11. lubridate

## **2. Per√≠odos**

### Transforma√ß√µes de per√≠odos


```r
# transformacao de periodos
lubridate::seconds(100)
lubridate::minutes(100)
lubridate::hours(100)
lubridate::days(100)
lubridate::weeks(100)
lubridate::years(100)
```

---

# 11. lubridate

## **2. Per√≠odos**

### Opera√ß√µes com os per√≠odos


```r
# somando datas
lubridate::today() + lubridate::weeks(10)
```

```
## [1] "2021-12-29"
```

```r
# subtraindo datas
lubridate::today() - lubridate::weeks(10)
```

```
## [1] "2021-08-11"
```

```r
# criando datas recorrentes
lubridate::today() + lubridate::weeks(0:10)
```

```
##  [1] "2021-10-20" "2021-10-27" "2021-11-03" "2021-11-10" "2021-11-17" "2021-11-24" "2021-12-01" "2021-12-08" "2021-12-15" "2021-12-22"
## [11] "2021-12-29"
```

---

# 11. lubridate

## **3. Intervalos**

### Per√≠odos de tempo limitados por duas datas, possuindo uma dura√ß√£o com um ponto de partida, que o faz preciso para determinar uma dura√ß√£o

### Fun√ß√µes

- `interval()`: cria data em intervalo
- `%--%: cria data em intervalo
- `as.interval()`: converte datas em intervalo
- `int_start()`: acessa ou atribui data inicial de um intervalo
- `int_end()`: acessa ou atribui data final de um intervalo
- `int_length()`: comprimento de um intervalo em segundos
- `int_flip()`: inverte a ordem da data de in√≠cio e da data de t√©rmino em um intervalo
- `int_shift()`: desloca as datas de in√≠cio e t√©rmino de um intervalo
- `int_aligns()`: testa se dois intervalos compartilham um ponto final
- `int_standardize()`: garante que todos os intervalos sejam positivos
- `int_diff()`: retorna os intervalos que ocorrem entre os elementos de data/hor√°rio
- `int_overlaps()`: testa se dois intervalos se sobrep√µem
- `%within%: testa se o primeiro intervalo est√° contido no segundo

---

# 11. lubridate

## **3. Intervalos**

### Criando intervalos


```r
# criando duas datas - inicio de estudos do R e nascimento do meu filho
r_inicio &lt;- lubridate::dmy("30-11-2011")
filho_nascimento &lt;- lubridate::dmy("26-09-2013")
r_hoje &lt;- lubridate::today()

# criando intervalos - interval
r_intervalo &lt;- lubridate::interval(r_inicio, r_hoje)

# criando intervalos - interval %--%
filho_intervalo &lt;- filho_nascimento %--% lubridate::today()
```

---

# 11. lubridate

## **3. Intervalos**

### Opera√ß√µpes com intervalos


```r
# operacooes com intervalos
lubridate::int_start(r_intervalo)
lubridate::int_end(r_intervalo)
lubridate::int_length(r_intervalo)
lubridate::int_flip(r_intervalo)
lubridate::int_shift(r_intervalo, duration(days = 30))
```

---

# 11. lubridate

## **3. Intervalos**

### Sobreposi√ß√£o entre dois intervalos


```r
# verificar sobreposicao - int_overlaps
lubridate::int_overlaps(r_intervalo, filho_intervalo)
```

```
## [1] TRUE
```

```r
# verificar se intervalo esta contido
r_intervalo %within% filho_intervalo
```

```
## [1] FALSE
```

```r
filho_intervalo %within% r_intervalo
```

```
## [1] TRUE
```

---

# 11. lubridate

## **3. Intervalos**

### Calcular quantos per√≠odos existem dentro de um intervalo


```r
# periodos dentro de um intervalo - anos
r_intervalo / lubridate::years()
```

```
## [1] 9.887671
```

```r
r_intervalo %/% lubridate::years()
```

```
## [1] 9
```

```r
# periodos dentro de um intervalo - dias e semandas
filho_intervalo / lubridate::days()
```

```
## [1] 2946
```

```r
filho_intervalo / lubridate::weeks()
```

```
## [1] 420.8571
```

---

# 11. lubridate

## **3. Intervalos**

### Transforma√ß√µes dos dados para per√≠odos


```r
# tempo total estudando R
lubridate::as.period(r_intervalo)
```

```
## [1] "9y 10m 20d 0H 0M 0S"
```

```r
# idade do meu filho
lubridate::as.period(filho_intervalo)
```

```
## [1] "8y 0m 24d 0H 0M 0S"
```

---

background-image: url(img/lubridate_fusos01.png), url(img/lubridate_fusos02.png)
background-size: 600px, 500px
background-position: 5% 75%, 90% 75%

# 11. lubridate

## Fusos hor√°rios

### Tendem a ser um **fator complicador** quando precisamos analisar informa√ß√µes **instant√¢neas de tempo (hor√°rio)** de outras partes do planeta, ou mesmo fazer convers√µes dos hor√°rios

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Fuso hor√°rio, como funciona](https://ipemsp.wordpress.com/2020/09/30/fuso-horario-como-funciona/), [Paradigma dos fusos hor√°rios e suas ocasionalidades](https://medium.com/@plowzzer/paradigma-dos-fusos-hor%C3%A1rios-997a3eb29039)

---

# 11. lubridate

## Fusos hor√°rios

### Descobrir o fuso hor√°rio que o R est√° considerando


```r
# fuso horario no r
Sys.timezone()
```

```
## [1] "America/Sao_Paulo"
```

### Listagem dos nomes dos fusos hor√°rios


```r
# verificar os fusos horarios
length(OlsonNames())
```

```
## [1] 607
```

```r
head(OlsonNames())
```

```
## [1] "Africa/Abidjan"     "Africa/Accra"       "Africa/Addis_Ababa" "Africa/Algiers"     "Africa/Asmara"      "Africa/Asmera"
```

---

# 11. lubridate

## Fusos hor√°rios

### Perguntar que horas s√£o em outra parte do globo ou fazer as convers√µes


```r
# que horas sao em...
lubridate::with_tz(lubridate::now(), tzone = "America/Sao_Paulo")
```

```
## [1] "2021-10-20 17:04:52 -03"
```

```r
lubridate::with_tz(lubridate::now(), tzone = "GMT")
```

```
## [1] "2021-10-20 20:04:52 GMT"
```

```r
lubridate::with_tz(lubridate::now(), tzone = "Europe/Berlin")
```

```
## [1] "2021-10-20 22:04:52 CEST"
```

```r
# alterar o fuso sem mudar a hora
lubridate::force_tz(lubridate::now(), tzone = "GMT")
```

```
## [1] "2021-10-20 17:04:52 GMT"
```

---

class: clear
background-image: url(img/package_purrr.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[purrr](https://purrr.tidyverse.org/)

---

background-image: url(img/cheatsheet_purrr.png)
background-size: 600px
background-position: 50% 50%

# 12. purrr

## Apply functions with purrr Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Apply functions with purrr Cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/purrr.pdf)

---

background-image: url(img/purrr_cats.jpeg)
background-size: 400px
background-position: 50% 85%

# 12. purrr

## Descri√ß√£o

### Implementa a **Programa√ß√£o Funcional no R**, fornecendo um conjunto completo e consistente de ferramentas para trabalhar com fun√ß√µes e vetores

--

### Permite substituir muitos *loops* for por um c√≥digo mais sucinto e f√°cil de ler

---

# 12. purrr

## *Loop*

## Um loop for pode ser entendido como uma itera√ß√£o: um bloco de c√≥digos √© repetido mudando um contador de uma lista de possibilidades


```r
# loop for
for(i in 1:10){
  print(i)
}
```

```
## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10
```

---

# 12. purrr

## Programa√ß√£o funcional


```r
# loop for com map
purrr::map(.x = 1:10, .f = print)
```

```
## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10
```

```
## [[1]]
## [1] 1
## 
## [[2]]
## [1] 2
## 
## [[3]]
## [1] 3
## 
## [[4]]
## [1] 4
## 
## [[5]]
## [1] 5
## 
## [[6]]
## [1] 6
## 
## [[7]]
## [1] 7
## 
## [[8]]
## [1] 8
## 
## [[9]]
## [1] 9
## 
## [[10]]
## [1] 10
```

---

background-image: url(img/purrr_map.png)
background-size: 600px
background-position: 85% 80%

# 12. purrr

## Estrutura

### `map(.x, .f)`
### `.x`: uma vetor, lista ou data frame
### `.f`: uma fun√ß√£o

---

# 12. purrr

### Exemplo: aplicar a fun√ß√£o `sum()` para somar os valores de v√°rios elementos de uma lista


```r
# lista
x &lt;- list(1:5, c(4, 5, 7), c(1, 1, 1), c(2, 2, 2, 2, 2))

# funcao map
purrr::map(x, sum)
```

```
## [[1]]
## [1] 15
## 
## [[2]]
## [1] 16
## 
## [[3]]
## [1] 3
## 
## [[4]]
## [1] 10
```

---

# 12. purrr

## Tipos de retorno

### Diferentes fun√ß√µes retornam diferentes estruturas de dados

- `map()`: retorna uma lista
- `map_chr()`: retorna um vetor de strings
- `map_dbl()`: retorna um vetor num√©rico (double)
- `map_int()`: retorna um vetor num√©rico (integer)
- `map_lgl()`: retorna um vetor l√≥gico
- `map_dfr()`: retorna um data frame (por linhas)
- `map_dfc()`: retorna um data frame (por colunas)

---

# 12. purrr

## Tipos de retorno


```r
# variacoes da funcao map
purrr::map_dbl(x, sum)
```

```
## [1] 15 16  3 10
```

```r
purrr::map_chr(x, paste, collapse = " ")
```

```
## [1] "1 2 3 4 5" "4 5 7"     "1 1 1"     "2 2 2 2 2"
```

---

# 12. purrr

## Duas ou mais listas em paralelo


```r
# listas
x &lt;- list(3, 5, 0, 1)
y &lt;- list(3, 5, 0, 1)
z &lt;- list(3, 5, 0, 1)

# map2* duas litas
purrr::map2_dbl(x, y, prod)
```

```
## [1]  9 25  0  1
```

```r
# pmap muitas listas
purrr::pmap_dbl(list(x, y, z), prod)
```

```
## [1]  27 125   0   1
```

---

# 12. purrr

## Implementar rotinas de manipula√ß√£o e an√°lise de dados


```r
# resumo dos dados
penguins %&gt;% 
  dplyr::select(where(is.numeric)) %&gt;% 
  tidyr::drop_na() %&gt;% 
  purrr::map_dbl(mean)
```

```
##    bill_length_mm     bill_depth_mm flipper_length_mm       body_mass_g              year 
##          43.92193          17.15117         200.91520        4201.75439        2008.02924
```

---

# 12. purrr

## Implementar rotinas de manipula√ß√£o e an√°lise de dados


```r
# analise dos dados
penguins %&gt;%
  dplyr::group_split(island, species) %&gt;% 
  purrr::map(~ lm(bill_depth_mm ~ bill_length_mm, data = .x)) %&gt;% 
  purrr::map(summary) %&gt;% 
  purrr::map("r.squared")
```

```
## [[1]]
## [1] 0.2192052
## 
## [[2]]
## [1] 0.4139429
## 
## [[3]]
## [1] 0.2579242
## 
## [[4]]
## [1] 0.4271096
## 
## [[5]]
## [1] 0.06198376
```

---

background-image: url(img/general_curso_r.png), url(img/person_jenny_bryan.jpeg)
background-size: 400px, 300px
background-position: 10% 70%, 90% 80%

# 12. purrr

## Material

### [Webinar de purrr avan√ßado](https://youtu.be/vb1lD9_AFcU) - Curso-R

### [purrr tutorial](https://jennybc.github.io/purrr-tutorial/) - Jennifer (Jenny) Bryan

---

class: clear
background-image: url(img/package_furrr.png)
background-size: 400px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[furrr](https://furrr.futureverse.org/)

---

background-image: url(img/processor01.png), url(img/processor02.png)
background-size: 500px, 400px
background-position: 15% 65%, 85% 75%

# 12. furrr

## Programa√ß√£o funcional paralelizada

### Faz o mapeamento em paralelo utilizando os *cores* do processador

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
[Quick Intro to Parallel Computing in R](https://nceas.github.io/oss-lessons/parallel-computing-in-r/parallel-computing-in-r.html)

---

# 12. furrr

## Programa√ß√£o funcional paralelizada

### N√∫mero de *cores* do seu computador


```r
# carregar
library(parallel)

# numero de cores
parallel::detectCores()
```

---

class: inverse, center, middle

# D√∫vidas?

---

class: clear, middle
background-image: url(img/gif_frog.gif),url(img/gif_frogs.gif), url(img/package_xaringan.png)
background-size: 250px, 500px, 130px
background-position: 35% 50%, 90% 55%, 5% 86%

## Maur√≠cio Vancine

&lt;br&gt;&lt;br&gt;

Contatos:

&lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#23373b;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"&gt;&lt;/path&gt;&lt;/svg&gt; [mauricio.vancine@gmail.com]()  
&lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#23373b;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"&gt;&lt;/path&gt;&lt;/svg&gt; [@mauriciovancine](https://twitter.com/mauriciovancine)  
&lt;svg viewBox="0 0 496 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#23373b;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"&gt;&lt;/path&gt;&lt;/svg&gt; [mauriciovancine](https://github.com/mauriciovancine)
&lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#23373b;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"&gt;&lt;/path&gt;&lt;/svg&gt; [mauriciovancine.github.io](https://mauriciovancine.github.io)

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

Slides criados via pacote [xaringan](https://github.com/yihui/xaringan) e tema [Metropolis](https://github.com/pat-s/xaringan-metropolis). Anima√ß√£o dos sapos por [@probzz](https://twitter.com/probzz/status/1367613720294170627).
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "rainbow",
"highlightLines": false,
"highlightSpans": false,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%/%total%",
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
