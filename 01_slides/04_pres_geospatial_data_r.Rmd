---
title: "Introdução ao uso de dados geoespaciais no R <br><br><br>"
subtitle: "4 Introdução ao tidyverse <br><br><br>"
author: "Maurício H. Vancine <br> Milton C. Ribeiro"
date: "20/10/2020"
output:
  xaringan::moon_reader:
    css: [metropolis, metropolis-fonts]
    lib_dir: libs
    nature:
      ratio: '16:9'
      highlightStyle: rainbow
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE, 
        encoding = "UTF-8",
        knitr.table.format = "html")
knitr::opts_chunk$set(fig.retina = 3, warning = FALSE, message = FALSE)
if(!require(countdown)) devtools::install_github("gadenbuie/countdown")
```

class: clear
background-image: url(img/general_data_science_r4ds.png)
background-size: 800px

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/tidyverse_celestial.png)
background-size: 400px
background-position: 85% 75%

# 4 tidyverse

## Conteúdo

1. tidyverse
1. magrittr (pipe - %>%)
1. readr
1. readxl e writexl
1. tibble
1. tidyr
1. dplyr
1. stringr
1. forcats
1. lubridate
1. purrr

<br><br>

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

# 4 tidyverse

## Script

<br><br><br><br>

## .center[`04_script_intro_geocomp_r.R`]

---

class: clear
background-image: url(img/package_tidyverse.png)
background-size: 400px

---

# 4.1 tidyverse

### O tidyverse é um **conjunto de pacotes** designados para **Data Science**

<br>

--

### Todos os pacotes compartilham uma **filosofia** de design, gramática e estruturas de dados

<br>

--

### É um **"dialeto"** novo para a linguagem R

<br>

--

### **tidy**: organizado, arrumado, ordenado

### **verse**: universo

---

class: inverse, center
background-image: url(img/gif_avenger_reference.gif)
background-size: 800px

# Iniciativa Vingadores do R

---

background-image: url(img/general_data_science.png)
background-size: 700px
background-position: 50% 60%

# 4.1 tidyverse

## Workflow

---

background-image: url(img/tidyverse_flow.png)
background-size: 650px
background-position: 50% 60%

# 4.1 tidyverse

## Pacotes

---

background-image: url(img/tidyverse_packages.png)
background-size: 650px
background-position: 50% 60%

# 4.1 tidyverse

## Pacotes e suas funções

---

background-image: url(img/general_messy_data.png)
background-size: 700px
background-position: 50% 70%

# 4.1 tidyverse

## Objetivo: te ajudar na luta contra os dados

<br><br><br><br><br><br><br><br><br><br><br><br><br><br>

Fonte: [@ViviFabrien](https://twitter.com/ViviFabrien)

---

background-image: url(img/person_hadley_wickham.jpg)
background-size: 550px
background-position: 50% 60%

# 4.1 tidyverse

### O idealizador foi o **Hadley Wickham** e atualmente **muitas pessoas** têm contribuído para sua expansão

<br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] http://hadley.nz/

---

background-image: url(img/tidyverse_papers.png)
background-size: 400px
background-position: 50% 90%

# tidyverse

## Artigos
> - Wickham, Hadley. ["Tidy data."](https://www.jstatsoft.org/article/view/v059i10) Journal of Statistical Software 59.10 (2014): 1-23.

> - Wickham, Hadley, et al. ["Welcome to the Tidyverse."](https://joss.theoj.org/papers/10.21105/joss.01686) Journal of Open Source Software 4.43 (2019): 1686.

---

background-image: url(img/cover_data_science_r.png)
background-size: 300px
background-position: 50% 55%

# 4.1 tidyverse

## R for Data Science (2017)

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://r4ds.had.co.nz/

---

background-image: url(img/tidyverse_site1.png)
background-size: 800px
background-position: 50% 50%

# 4.1 tidyverse

## Sites

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://www.tidyverse.org/

---

background-image: url(img/tidyverse_site2.png)
background-size: 800px
background-position: 50% 50%

# 4.1 tidyverse

## Sites

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://rpubs.com/modelthinkingbr/dados

---

# 4.1 tidyverse

### Para utilizar os pacotes do **tidyverse** é preciso instalar e carregar o pacote `tidyverse`

```{r eval=FALSE}
# instalar o pacote
install.packages("tidyverse")
```

--

```{r message=TRUE}
# carregar o pacote
library(tidyverse)
```

---

# 4.1 tidyverse

## Listar todos os pacotes do tidyverse

<br><br>

```{r}
# list all packages in the tidyverse 
tidyverse::tidyverse_packages(include_self = TRUE)
```

---

background-image: url(img/code_snake_case.png)
background-size: 500px
background-position: 80% 80%

# 4.1 tidyverse

## IMPORTANTE!

### Todas as funções dos pacotes **tidyverse** usão fonte minúscula e usam `_` para separar os nomes internos das funções (snake_code)

<br>

`read_csv()`

`read_xlsx()`

`as_tibble()`

`left_join()`

`group_by()`

---

class: clear
background-image: url(img/package_magrittr.png)
background-size: 400px

---

background-image: url(img/person_rene_magritte.jpg), url(img/tidyverse_magritte_pipe.jpg)
background-size: 250px, 500px
background-position: 10% 30%, 85% 75%

# 4.2 magrittr (pipe - %>%)

## René Magritte (1898-1967)

---

# 4.2 magrittr (pipe - %>%)

### O operador pipe (*%>%*) permite o “encadeamento” de várias funções e **não é preciso de objetos** para armazenar resultados intermediários

--

### Essa função torna os códigos em R **mais simples**, pois realizamos **múltiplas operações** em uma **única linha**

--

### Ele captura o **resultado de uma declaração** e o **torna a entrada da próxima declaração**. Podemos pensar como *“EM SEGUIDA FAÇA”*

--

### O operador pipe é **%>%**

---

# 4.2 magrittr (pipe - %>%)

### Atalho: `Crtl + Shift + M`
```{r}
# sem pipe
sqrt(sum(1:100))
```

--

background-image: url(img/general_fog01.jpg)
background-size: 500px
background-position: 50% 80%

---

background-image: url(img/general_fog02.jpg)
background-size: 350px
background-position: 50% 90%

# 4.2 magrittr (pipe - %>%)

### Atalho: `Crtl + Shift + M`
```{r}
# sem pipe
sqrt(sum(1:100))
```

---

# 4.2 magrittr (pipe - %>%)

### Atalho: `Crtl + Shift + M`
```{r}
# sem pipe
sqrt(sum(1:100))
```

```{r}
# com pipe
1:100 %>% 
  sum() %>% 
  sqrt()
```

---

class: clear, inverse
background-image: url(img/gif_uou.webp)
background-size: 800px

---

# 4.2 magrittr (pipe - %>%)

### Atalho: `Crtl + Shift + M`
```{r}
# fixar amostragem
set.seed(42)

# sem pipe
ve <- sum(sqrt(sort(log10(rpois(100, 10)))))
ve
```
--
```{r}
# fixar amostragem
set.seed(42)

# com pipe
ve <- rpois(100, 10) %>% 
  log10() %>%
  sort() %>% 
  sqrt() %>% 
  sum()
ve  
```

---

class: clear, inverse
background-image: url(img/gif_mario.gif)
background-size: 700px

---

class: inverse, center, middle

# Exercícios

---

# Exercício 09

## Reescreva cada uma das operações utilizando pipes `%>%`:
<br>
`log10(cumsum(1:100))`
<br>
`sum(sqrt(abs(rnorm(100))))`
<br>
`sum(sort(sample(1:10, 10000, rep = TRUE)))`

```{r echo=FALSE}
countdown(minutes = 5, seconds = 00, color_background = "gray30")
```

---

# Exercício 09
## Solução
```{r eval=FALSE}
# solucao
# 1.
log10(cumsum(1:100))

1:100 %>%
  cumsum %>% 
  log10
```

---

# Exercício 09
## Solução
  
```{r eval=FALSE}
# 2.
sum(sort(abs(rnorm(100))))

rnorm(100) %>% 
  abs %>% 
  sort %>% 
  sum
```

---

# Exercício 09
## Solução

```{r eval=FALSE}
# 3.
sum(sort(sample(1:10, 10000, rep = TRUE)))

1:10 %>% 
  sample(10000, rep = TRUE) %>% 
  sort %>% 
  sum
```

---

class: inverse, center, middle

# Dúvidas?

---

class: clear
background-image: url(img/package_readr.png)
background-size: 400px

---

background-image: url(img/cheatsheet_readr.png)
background-size: 600px
background-position: 50% 50%

# 4.3 readr

## Data Import Cheatsheet

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf

---

# 4.3 readr

### **Carrega e salva** grandes arquivos de forma **mais rápida**

--

### As funções **read.csv()** e **read.csv2()** são substituídas pelas funções **read_csv()** e **read_csv2()**

--

### Essas funções fornecem **medidores de progresso**

--

### E também **classificam** automaticamente o **modo** dos dados de cada coluna

--

### A classe do objeto atribuído é **tibble**

--

### Para salvar arquivos no formato .csv: **write_csv()** e **write_csv2()**

---

background-image: url(img/general_data_eu_mesmo.png)
background-size: 600px
background-position: 50% 80%

# 4.3 readr

## ATLANTIC AMPHIBIANS: a dataset of amphibian communities from the Atlantic Forests of South America

### Eu mesmo et al. (2018)

---

class: inverse, center, middle

# Mas antes, uma outra forma de definir diretórios

---

class: clear
background-image: url(img/here.png)
background-size: 700px

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

# here

## Constrói caminhos para os arquivos do seu projeto

<br>

### - **Mudar o diretório**: tende à ser chato demais (principalmente se é um código alheio)
### - **Fragilidade**: conectado exatamente a um lugar e a um momento (baixa reprodutibilidade)
### - **Subdiretórios**: facilita importar ou exportar para subpastas (Lei do Mínimo Esforço)

---

background-image: url(img/here.png)
background-size: 400px
background-position: 50% 90%

# here

## Pacote
```{r eval=FALSE}
# install
install.packages("here")

# load
library(here)
```

<br><br><br><br><br><br><br><br><br><br>

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/here.png)
background-size: 400px
background-position: 50% 90%

# here

## Diversos critérios para encontrar o diretório raiz

```{r eval=FALSE}
# confer
here::here()

# create a .here file
here::set_here()
```

<br><br><br><br><br><br><br><br><br><br>

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

class: inverse, center, middle

# Agora sim, vamos importar os dados usando o here::here()

---

# readr

## **Formato .csv**
```{r}
# import sites
si <- readr::read_csv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.csv"))
si
```

---

class: inverse, center, middle

# Ou não...

---

# readr

## **Formato .csv**
```{r eval=FALSE}
# import sites
si <- readr::read_csv("./03_dados/tabelas/ATLANTIC_AMPHIBIANS_sites.csv")
si
```

```{r echo=FALSE}
# import sites
si <- readr::read_csv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.csv"))
si
```

---

# 4.3 readr

## **Formato .txt**
```{r}
# import sites
si <- readr::read_tsv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.txt"))
si
```

---

class: clear
background-image: url(img/package_readxl.png)
background-size: 400px

---

# 4.4 readxl e writexl

## São pacotes à parte do **tidyverse** para importar planilhas no formato Excel®

<br><br>

```{r eval=FALSE}
# import .xlsx
install.packages("readxl")
library("readxl")
```

<br>
--


```{r eval=FALSE}
# export .xlsx
install.packages("writexl")
library("writexl")
```

---

# 4.4 readxl e writexl

### **Carrega e salva** grandes arquivos de forma **mais rápida** no formato **.xlsx**

--

### Funções **read_xlsx()** e **read_xlsx2()**

--

### Essas funções fornecem **medidores de progresso**

--

### E também **classificam** automaticamente o **modo** dos dados de cada coluna

--

### A classe do objeto atribuído é **tibble**

--

### Para salvar arquivos no formato .xlsx: **write_xlsx()** e **write_xlsx2()**

---

# 4.4 readxl e writexl

## **Formato .xlsx**

### O argumento `sheet` define a aba a ser importada (número ou nome)

```{r}
# import sites
si <- readxl::read_xlsx(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.xlsx"), 
                        sheet = 1)
si
```

---

background-image: url(img/gif_frog.gif)
background-size: 200px
background-position: 50% 100%

# Importar os dados

## **Formato .csv**

### Matriz de localidades
```{r include=FALSE}
# import sites
si <- readr::read_csv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.csv"))
si
```

```{r eval=FALSE}
# import sites
si <- readr::read_csv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.csv"))
si
```

### Matriz de espécies
```{r include=FALSE}
# import species
sp <- readr::read_csv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_species.csv"))
sp
```

```{r eval=FALSE}
# import species
sp <- readr::read_csv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_species.csv"))
sp
```

---

class: clear
background-image: url(img/package_tibble.png)
background-size: 400px

---

# 4.5 tibble

### O tibble (classe *tbl_df*) é um **tipo especial de data frame**

--

### É o **formato** aconselhado para que as funções do tidyverse **funcionem**

--

### Converter **data frame** em **tibble** usa-se a função `as_tibble()`

--

### Converter **tibble** em **data frame** usa-se a função `as_data_frame()`

--

### Cada variável pode ser do modo *numbers(int, dbl)*, *character(chr)*, *logical(lgl)* ou *factor(fctr)*

---

# 4.5 tibble

## Descrição dos modos das colunas através da função `glimpse()` - "espiar os dados"

```{r}
tibble::glimpse(si)
```

---

# 4.5 tibble

## Descrição dos modos das colunas através da função `glimpse()` - "espiar os dados"

```{r}
tibble::glimpse(sp)
```

---

# 4.5 tibble

## tibble vs data.frame

### 1. Nunca converte um tipo **character como factor** (R 4.0.x)
```{r}
df <- data.frame(ch = c("a", "b"), nu = 1:2)
str(df)
```
--
```{r message=FALSE}
tb <- tibble::tibble(ch = c("a", "b"), nu = 1:2)
tibble::glimpse(tb)
```

---

# 4.5 tibble

## tibble vs data.frame

### 2. A indexação com colchetes retorna um **tibble**
```{r}
df_ch <- df[, 1]
class(df_ch)
```
--
```{r}
tb_ch <- tb[, 1]
class(tb_ch)
```
--
```{r}
# indexacao pelo nome devolve um vetor
tb_ch <- tb$ch
class(tb_ch)
```

---

# 4.5 tibble

## tibble vs data.frame

### 3. Não faz correspondência parcial, retorna **NULL** se a coluna não existe com o nome especificado
```{r}
df$c 
```
--
```{r, error = TRUE}
tb$c
```

---

class: clear
background-image: url(img/package_tidyr.png)
background-size: 400px

---

background-image: url(img/cheatsheet_tidyr.png)
background-size: 600px
background-position: 50% 50%

# 4.6 tidyr

## Data Import Cheatsheet

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf

---

# 4.6 tidyr

### Os conjuntos de dados **tidy** (organizados) são fáceis de manipular, modelar e visualizar

--

### Um conjunto de dados está **arrumado ou não**, dependendo de como linhas, colunas e células são combinadas com observações, variáveis e valores

--

## Nos dados tidy:
### 1. Cada variável em uma coluna
### 2. Cada observação em uma linha
### 3. Cada valor como uma célula

---

background-image: url(img/tidyr_data01.png)
background-size: 800px
background-position: 50% 50%

# 4.6 tidyr

## Conjuntos de dados 'tidy'

---

background-image: url(img/tidyr_data02.jpg)
background-size: 500px
background-position: 70% 85%

# 4.6 tidyr

## Funções

1. **unite()**: junta dados de múltiplas colunas em uma
1. **separate()**: separa caracteres em múlplica colunas
1. **separate_rows()**: separa caracteres em múlplica colunas e linhas
1. **drop_na()**: retira linhas com NA
1. **replace_na()**: substitui NA
1. **pivot_wider()**: long para wide
1. **pivot_longer()**: wide para long

<br><br><br><br><br><br><br>

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/tidyr_unite.png)
background-size: 800px
background-position: 50% 50%

# 4.6 tidyr

---

# 4.6 tidyr

## **1 unite**

### Unir as colunas latirude e longitude separadas por uma vírgula
```{r}
# sem pipes
si_unite <- tidyr::unite(si, "lat_lon", latitude:longitude, sep = ",")
si_unite$lat_lon
```

---

# 4.6 tidyr

## **1 unite**

### Unir as colunas latirude e longitude separadas por uma vírgula
```{r}
# com pipes
si_unite <- si %>% 
  tidyr::unite("lat_lon", latitude:longitude, sep = ",")
si_unite$lat_lon
```

---

background-image: url(img/tidyr_separate.png)
background-size: 800px
background-position: 50% 50%

# 4.6 tidyr

---

# 4.6 tidyr

## **2 separate**

### Separar os dados de "period" em quatro colunas dos seus valores
```{r}
si_separate <- si %>% 
  tidyr::separate("period", c("mo", "da", "tw", "ni"), remove = FALSE)
si_separate[, c(1, 9:13)]
```

---

# 4.6 tidyr

## **3 separate_rows()**

### Separar os dados de "period" na mesma coluna e repetindo os valores
```{r}
si_separate_row <- si %>% 
  tidyr::separate_rows("period")
si_separate_row[, c(1, 9:13)]
```

---

# 4.6 tidyr

## **4 drop_na()**

### Remove as linhas com NA de todas as colunas
```{r}
si_drop_na <- si %>% 
  tidyr::drop_na()
si_drop_na
```

---

# 4.6 tidyr

## **4 drop_na()**

### Remove as linhas com NA da coluna "active_methods"
```{r}
si_drop_na <- si %>% 
  tidyr::drop_na(active_methods)
si_drop_na
```

---

# 4.6 tidyr

## **5 replace_na()**

### Substituir os NAs da coluna "active_methods" por 0 
```{r}
si_replace_na <- si %>% 
  tidyr::replace_na(list(active_methods = 0))
si_replace_na
```

---

background-image: url(img/gif_tidyr_pivot.gif),url(img/tidyr_tb_pivot.png)
background-size: 300px,550px
background-position: 10% 90%,90% 40%

# 4.6 tidyr

## Pivotar os dados

---

background-image: url(img/tidyr_pivot_wider.png)
background-size: 800px
background-position: 50% 50%

# 4.6 tidyr

---

# 4.6 tidyr

## **6 pivot_wider()** 

### Long para wide

1. **id_cols**: variável id
2. **names_from**: variável categórica que irá definir os nomes das colunas
3. **values_from**: variável numérica que irá preencher os dados
4. **values_fill**: valor para preencher os NAs

```{r}
si[, c("id", "record", "species_number")]
```

---

# 4.6 tidyr

## **6 pivot_wider()** 

### Long para wide

1. **id_cols**: variável id
2. **names_from**: variável categórica que irá definir os nomes das colunas
3. **values_from**: variável numérica que irá preencher os dados
4. **values_fill**: valor para preencher os NAs

```{r}
si_wide <- si %>% 
  tidyr::pivot_wider(id_cols = id, 
                     names_from = state_abbreviation,
                     values_from = species_number, 
                     values_fill = list(species_number = 0))
si_wide
```

---

# 4.6 tidyr

## **6 pivot_wider()** 

### Long para wide

1. **id_cols**: variável id
2. **names_from**: variável categórica que irá definir os nomes das colunas
3. **values_from**: variável numérica que irá preencher os dados
4. **values_fill**: valor para preencher os NAs

```{r}
sp[1:1000, c("id", "species", "individuals")]
```

---

# 4.6 tidyr

## **6 pivot_wider()** 

### Long para wide

1. **id_cols**: variável id
2. **names_from**: variável categórica que irá definir os nomes das colunas
3. **values_from**: variável numérica que irá preencher os dados
4. **values_fill**: valor para preencher os NAs

```{r}
sp_wide <- sp[1:1000, ] %>% 
  tidyr::replace_na(list(individuals = 0)) %>% 
  tidyr::pivot_wider(id_cols = id, 
                     names_from = species, 
                     values_from = individuals, 
                     values_fill = list(individuals = 0))
sp_wide
```

---

background-image: url(img/tidyr_pivot_longer.png)
background-size: 800px
background-position: 50% 50%

# 4.6 tidyr

---

# 4.6 tidyr

## **7 pivot_longer()**

### Wide para long

1. **cols**: coluna do id
2. **names_to**: nome da coluna que receberá os nomes
3. **values_to**: nome da coluna que receberá os valores

```{r}
si_long <- si_wide %>% 
  tidyr::pivot_longer(cols = -id, 
                      names_to = "record", 
                      values_to = "species_number")
si_long
```

---

class: inverse, center, middle

# Exercícios

---

# Exercício 10
### Combine as colunas `country`, `state`, `state_abbreviation`, `municipality`, `site`, em uma coluna chamada `local_total` separadas por `, (vírgula + espaço)`, atribuindo o resultado a um novo objeto, utilizando o formato tidyverse

```{r echo=FALSE}
countdown(minutes = 1, seconds = 00, color_background = "gray30")
```

---

# Exercício 10
## Solução
```{r}
si_local <- si %>% 
  tidyr::unite("local_total", 
               c(country, state, state_abbreviation, municipality, site), 
               sep = ", ")
si_local$local_total
```

---

# Exercício 11
### Quanto indivíduos por há por família nos locais amostrados? Apenas para as 1000 primeiras linhas da tabela `sp`
```{r echo=FALSE}
countdown(minutes = 5, seconds = 00, color_background = "gray30")
```

---

# Exercício 11
## Solução
```{r}
family_wide <- sp[1:1000, ] %>% 
  tidyr::replace_na(list(individuals = 0)) %>% 
  tidyr::drop_na(family) %>% 
  tidyr::pivot_wider(id_cols = id, 
                     names_from = family, 
                     values_from = individuals, 
                     values_fn = list(individuals = sum),
                     values_fill = list(individuals = 0))
family_wide
```

---

class: inverse, center, middle

# Dúvidas?

---

class: clear
background-image: url(img/package_dplyr.png)
background-size: 400px

---

class: clear
background-image: url(img/dplyr_wrangling.png)
background-size: 600px

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/cheatsheet_dplyr.png)
background-size: 600px
background-position: 50% 50%

# 4.7 dplyr

## Data Transformation Cheatsheet

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf

---

# 4.7 dplyr

<br>

### O **dplyr** é um pacote que **facilita** o trabalho com dados, com uma **gramática de manipulação** de dados **simples e flexível** (filtragem, reordenamento, seleção, entre outras)

<br>
--

### Ele foi construído com o intuito de obter uma forma **mais rápida** e **expressiva** de tratar os dados 

<br>
--

### O **tibble** é a **versão de data frame** mais **conveniente** para **se usar** com dplyr

---

# 4.7 dplyr

### Sua gramática simples contém **funções verbais** para manipulação de dados

--

<br><br>

## Funções

- Verbos: mutate(), select(), filter(), arrange(), summarise(), slice(), rename(), etc.

- Sufixos: _at(), _if(), _all(), etc.

- Agrupamento: group_by() e ungroup()

- Junções: inner_join(), full_join(), left_join() e right_join()

- Funções resumo: n(), n_distinct(), first(), last(), nth(), etc.


---

# 4.7 dplyr

### Sua gramática simples contém **funções verbais** para manipulação de dados

<br>

1. **select()**: seleciona colunas pelo nome gerando um tibble<br>
1. **pull()**: seleciona uma coluna como vetor<br>
1. **rename()**: muda o nome das colunas<br>
1. **mutate()**: adiciona novas colunas ou adiciona resultados em colunas existentes<br>
1. **arrange()**: reordenar as linhas com base nos valores de colunas<br>
1. **filter()**: seleciona linhas com base em valores<br>
1. **distinct()**: remove linhas com valores repetidos com base nos valores de colunas<br>
1. **slice()**: seleciona linhas pelos números<br>
1. **sample_n()**: amostragem aleatória de linhas<br>
1. **summarise()**: agrega ou resume os dados através de funções, podendo considerar valores das colunas<br>
1. **_join()**: junta dados de duas tabelas através de uma coluna chave

---

# 4.7 dplyr

### O **tibble** é sempre o **primeiro argumento** das funções verbais

--

### Todas seguem a mesma sintaxe: 

#### 1. tibble
#### 2. operador pipe 
#### 3. nome da função verbal com os argumentos entre parênteses 

--

<br>

### As funções verbais **não modificam** o tibble original

```{r eval=FALSE}
tb_dplyr <- tb %>% 
  funcao_verbal(argumento1, argumento2)
```

---

background-image: url(img/dplyr_select.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **1 select**

---

# 4.7 dplyr

## **1 select**

### Seleciona colunas pelo nome

```{r}
si_select <- si %>% 
  dplyr::select(id, longitude, latitude)
si_select
```

---

# 4.7 dplyr

## **1 select**

### Remove as colunas pelo nome

```{r}
si_select <- si %>% 
  dplyr::select(-c(id, longitude, latitude))
si_select
```
---

# 4.7 dplyr

## **1 select**

### Seleciona colunas por um padrão

```{r}
#  starts_with(), ends_with() e contains()
si_select <- si %>% 
  dplyr::select(contains("sp"))
si_select
```

---

background-image: url(img/dplyr_pull.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **2 pull**

### Seleciona uma coluna como vetor

---

# 4.7 dplyr

## **2 pull**

### Seleciona uma coluna como vetor

```{r}
# coluna para vetor
si_pull <- si %>% 
  dplyr::pull(id)
si_pull
```

---

# 4.7 dplyr

## **2 pull**

### Seleciona uma coluna como vetor

```{r}
# coluna para vetor
si_pull <- si %>% 
  dplyr::pull(species_number)
si_pull
```

---

# 4.7 dplyr

## **3 rename**

### Renomeia colunas
```{r}
# rename sp column
si_rename <- si %>%
  dplyr::rename(sp = species_number)
si_rename
```

---

background-image: url(img/dplyr_mutate.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **4 mutate**

---

# 4.7 dplyr

## **4 mutate**

### Adiciona colunas novas ou vindas de operações
```{r}
# add column record as factor
si_mutate <- si %>% 
  dplyr::mutate(record_factor = as.factor(record))
si_mutate$record_factor
```

---

background-image: url(img/dplyr_arrange.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **5 arrange**

---

# 4.7 dplyr

## **5 arrange**

### Ordenar de forma crescente pela coluna **species_number**
```{r}
si_arrange <- si %>% 
  dplyr::arrange(species_number)
si_arrange
```

---

# 4.7 dplyr

## **5 arrange**

### Ordenar de forma decrescente pela coluna **species_number**
```{r}
si_arrange <- si %>% 
  dplyr::arrange(desc(species_number))
si_arrange
```

---

# 4.7 dplyr

## **5 arrange**

### Ordenar de forma decrescente pela coluna **species_number**
```{r}
si_arrange <- si %>% 
  dplyr::arrange(-species_number)
si_arrange
```

---

background-image: url(img/dplyr_filter.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **6 filter**

---

# 4.7 dplyr

## **6 filter** 

### operadores: >, >=, <, <=, ==, !=, is.na, !is.na, %in%
### Filtrar para locais com mais de 5 espécies
```{r eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(species_number > 5)
si_filter
```

--

### Filtrar para locais centre 1 e 5 espécies
```{r eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(between(species_number, 1, 5))
si_filter
```

---

# 4.7 dplyr

## **6 filter** 
### Filtrar para locais com NA no métodos passivos
```{r eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(is.na(passive_methods))
si_filter
```
--
### Filtrar para locais sem NA no métodos passivos
```{r eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(!is.na(passive_methods))
si_filter
```

---

# 4.7 dplyr

## **6 filter** 
### Filtrar para locais sem NA no métodos ativos **E** passivos
```{r eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(!is.na(active_methods) & !is.na(passive_methods))
si_filter
```

---

# 4.7 dplyr

## **6 filter** 
### Filtrar para locais amostrados com mais de 5 espécies **E** em São Paulo
```{r eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(species_number > 5 & state_abbreviation == "BR-SP") 
si_filter
```
--
### Filtrar para locais amostrados com mais de 5 espécies **OU** em São Paulo
```{r eval=FALSE}
si_filter <- si %>% 
  dplyr::filter(species_number > 5 | state_abbreviation == "BR-SP")
si_filter
```

---

# 4.7 dplyr

## **7 distinct**
### Remove linhas duplicadas considerando a coluna número de espécies
```{r}
si_distinct <- si %>% 
  dplyr::distinct(species_number)
si_distinct
```

---

# 4.7 dplyr

## **7 distinct**
### Remove linhas duplicadas considerando a coluna número de espécies e mantém as demais
```{r}
si_distinct <- si %>% 
  dplyr::distinct(species_number, .keep_all = TRUE)
si_distinct
```

---

# 4.7 dplyr

## **8 slice** 
### Selecionar linhas 1 a 10
```{r}
si_slice <- si %>% 
  dplyr::slice(1:10)
si_slice
```

---

# 4.7 dplyr

## **9 n_sample** 

### Amostrar 100 linhas aleatoriamente
```{r}
si_sample_n <- si %>% 
  dplyr::sample_n(100)
si_sample_n
```

---

background-image: url(img/dplyr_summarize.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **10 summarise**

---

# 4.7 dplyr

## **10 summarise**

### Média e desvio padrão do número de espécies total

```{r}
si_summarise <- si %>% 
  dplyr::summarise(mean_sp = mean(species_number), 
                   sd_sp = sd(species_number))
si_summarise
```

---

# 4.7 dplyr

## **10 summarise**
### Média e desvio padrão do número de espécies por país
```{r}
si_summarise_group <- si %>% 
  dplyr::group_by(country) %>% 
  dplyr::summarise(mean_sp = mean(species_number), 
                   sd_sp = sd(species_number))
si_summarise_group
```

---

background-image: url(img/dplyr_join.png)
background-size: 350px
background-position: 50% 60%

# 4.7 dplyr

## **11 *_join**

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://rpubs.com/williamsurles/293454

---

background-image: url(img/gif_dplyr_left_join.gif)
background-size: 300px
background-position: 20% 10%

# 4.7 dplyr

## **11 *_join**

---

background-image: url(img/gif_dplyr_left_join.gif),url(img/gif_dplyr_right_join.gif)
background-size: 300px,300px
background-position: 20% 10%,80% 10%

# 4.7 dplyr

## **11 *_join**

---

background-image: url(img/gif_dplyr_left_join.gif),url(img/gif_dplyr_right_join.gif),url(img/gif_dplyr_inner_join.gif)
background-size: 300px,300px,300px
background-position: 20% 10%,80% 10%,20% 100%

# 4.7 dplyr

## **11 *_join**

---

background-image: url(img/gif_dplyr_left_join.gif),url(img/gif_dplyr_right_join.gif),url(img/gif_dplyr_inner_join.gif),url(img/gif_dplyr_full_join.gif)
background-size: 300px,300px,300px,300px
background-position: 20% 10%,80% 10%,20% 100%,80% 105%

# 4.7 dplyr

## **11 *_join**

---

background-image: url(img/dplyr_leftjoin.png), url(img/dplyr_rightjoin.png), url(img/dplyr_innerjoin.png), url(img/dplyr_fulljoin.png)
background-size: 600px, 600px, 600px, 600px
background-position: 50% 20%, 50% 45%, 50% 70%, 50% 95%

# 4.7 dplyr

## **11 *_join**

---

background-image: url(img/dplyr_semijoin.png), url(img/dplyr_antijoin.png)
background-size: 700px, 700px
background-position: 50% 40%, 50% 80%

# 4.7 dplyr

## **11 *_join**

---

background-image: url(img/dplyr_leftjoin.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **11 *_join**

---

# 4.7 dplyr

## **11 *_join**

## Adicionar longitute e latitude na tabela de espécies

### Selecionar as colunas que preciso da tabela **si**
```{r}
si_coord <- si %>% 
  dplyr::select(id, longitude, latitude)
si_coord 
```

---

# 4.7 dplyr

## **11 *_join**

## Adicionar longitute e latitude na tabela de espécies

### Join com as tabelas pela coluna "id"
```{r}
# join dos dados
sp_join <- sp %>% 
  dplyr::left_join(si_coord, by = "id")
sp_join
```

---

# 4.7 dplyr

## **11 *_join**

## Adicionar longitute e latitude na tabela de espécies

### Nome das colunas
```{r}
colnames(sp_join)
```

---

# 4.7 dplyr

## **11 *_join**

## Adicionar longitute e latitude na tabela de espécies

### Nome das colunas
```{r}
sp_join %>% 
  dplyr::select(species, longitude, latitude)
```

---

class: inverse, center, middle

# E não termina nunca...

---

# 4.7 dplyr

## Sufixos: _at(), _if(), _all()

### Realiza operações dependente de confições

```{r}
sp_wide_rename <- sp_wide %>% 
  dplyr::rename_at(vars(contains(" ")), 
                   list(~stringr::str_replace_all(., " ", "_"))) %>% 
  dplyr::rename_all(list(~stringr::str_to_lower(.)))
sp_wide_rename
```

---

class: inverse, center, middle

# Mas o mais importante é a ideia de **encadeamento das funções**

---

# 4.7 dplyr
## Permite manipular os dados de forma simples
```{r}
da <- si %>% 
  dplyr::select(id, state_abbreviation, species_number)
da
```

---

# 4.7 dplyr
## Permite manipular os dados de forma simples
```{r}
da <- si %>% 
  dplyr::select(id, state_abbreviation, species_number) %>% 
  dplyr::filter(species_number > 5)
da
```

---

# 4.7 dplyr
## Permite manipular os dados de forma simples
```{r}
da <- si %>% 
  dplyr::select(id, state_abbreviation, species_number) %>% 
  dplyr::filter(species_number > 5) %>% 
  dplyr::group_by(state_abbreviation) %>% 
  dplyr::summarise(nsp_state_abb = n())
da
```

---

# 4.7 dplyr
## Permite manipular os dados de forma simples
```{r}
da <- si %>% 
  dplyr::select(id, state_abbreviation, species_number) %>% 
  dplyr::filter(species_number > 5) %>% 
  dplyr::group_by(state_abbreviation) %>% 
  dplyr::summarise(nsp_state_abb = n()) %>% 
  dplyr::arrange(nsp_state_abb)
da
```

---

class: inverse, center, middle

# Exercícios

---

# Exercício 12

### Adicione essas novas colunas `alt_log, tem_log e pre_log`, que são a operação `log10` das colunas `altitude,	temperature e	precipitation` e atribua ao mesmo objeto `si` utilizando o formato tidyverse

```{r echo=FALSE}
countdown(minutes = 1, seconds = 30, color_background = "gray30")
```

---

# Exercício 12
## Solução
```{r}
# solucao
si <- si %>% 
  dplyr::mutate(alt_log = log10(altitude),
                tem_log = log10(temperature),
                pre_log = log10(precipitation))
si[, 25:28]
```

---

# Exercício 13

### Ordene os dados em forma decrescente pela coluna `altitude`, atribuindo o resultado a um novo objeto utilizando o formato tidyverse

```{r echo=FALSE}
countdown(minutes = 1, seconds = 30, color_background = "gray30")
```

---

# Exercício 13
## Solução
```{r}
# solucao
si_ar <- si %>% 
  dplyr::arrange(-altitude)
si_ar
```

---

# Exercício 14

###  Filtre as linhas com `altitude` maior que 1000 mm, `temperature` menor que 15 ºC e `precipitation` maior que 1000 mm, atribuindo o resultado a um novo objeto utilizando o formato tidyverse

```{r echo=FALSE}
countdown(minutes = 1, seconds = 30, color_background = "gray30")
```

---

# Exercício 14
## Solução
```{r}
# solucao
si_fi <- si %>% 
  dplyr::filter(altitude > 1000,
                temperature < 15,
                precipitation > 1000)
si_fi
```

---

# Exercício 15

### Amostre 200 linhas aleatoriamente com número de espécies maior que 15 espécies, atribuindo o resultado a um novo objeto utilizando o formato tidyverse

```{r echo=FALSE}
countdown(minutes = 1, seconds = 30, color_background = "gray30")
```

---

# Exercício 15
## Solução
```{r}
# solucao
si_sa <- si %>% 
  dplyr::filter(species_number > 15) %>% 
  dplyr::sample_n(200)
si_sa
```

---

class: clear
background-image: url(img/package_stringr.png)
background-size: 400px

---

background-image: url(img/cheatsheet_stringr.png)
background-size: 600px
background-position: 50% 50%

# 4.8 stringr

## Work with Strings Cheatsheet

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://github.com/rstudio/cheatsheets/raw/master/strings.pdf

---

# 4.8 stringr

## Pacote para a manipulação de strings

### Comprimento
```{r}
stringr::str_length("abc")
```

--

### Extração por posição
```{r}
stringr::str_sub("abc", 3)
```

---

# 4.8 stringr

### Inserir espaço em branco - esquerda
```{r}
stringr::str_pad("abc", width = 4, side = "left")
```

--

### Inserir espaço em branco - direira
```{r}
stringr::str_pad("abc", width = 4, side = "right")
```

--

### Remover espaço em branco do começo, final ou ambos
```{r}
stringr::str_trim(" abc ")
```

---

# 4.8 stringr

### Minúsculas e maiúsculas
```{r}
stringr::str_to_upper("abc")
```
--
```{r}
stringr::str_to_title("abc")
```
--
```{r}
stringr::str_to_title("aBc")
```

---

# 4.8 stringr

### Ordenação
```{r}
le <- sample(letters, 26, rep = TRUE)
le
```
--
```{r}
stringr::str_sort(le)
```
--
```{r}
stringr::str_sort(le, dec = TRUE)
```

---

# 4.8 stringr

### Extrair por padrão
```{r}
stringr::str_extract("abc", "b")
```

### Substituir
```{r}
stringr::str_replace("abc", "a", "y")
```

### Separação
```{r}
stringr::str_split("a-b-c", "-")
```

---

class: clear
background-image: url(img/package_forcats.png)
background-size: 400px

---

background-image: url(img/cheatsheet_forcats.png)
background-size: 600px
background-position: 50% 50%

# 4.9 forcats

## Factors with forcats Cheatsheet

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://github.com/rstudio/cheatsheets/raw/master/factors.pdf

---

# 4.9 forcats

### **as_factor()**: cria fatores
```{r}
# fixar amostragem
set.seed(42)

# cria um fator
fa <- sample(c("alto", "medio", "baixo"), 30, rep = TRUE) %>% 
  forcats::as_factor()
fa
```

---

# 4.9 forcats

### **fct_recode()**: muda o nome dos níveis
```{r}
# muda o nome dos niveis
fa_recode <- fa %>% 
  forcats::fct_recode(a = "alto", m = "medio", b = "baixo")
fa_recode
```

---

# 4.9 forcats

### **fct_rev()**: inverte os níveis
```{r}
# inverte os niveis
fa_rev <- fa_recode %>% 
  forcats::fct_rev()
fa_rev
```

---

# 4.9 forcats

### **fct_relevel()**: especifica a classificação de um ou mais níveis
```{r}
# especifica a classificacao de um nivel
fa_relevel <- fa_recode %>% 
  forcats::fct_relevel(c("a", "m", "b"))
fa_relevel
```

---

# 4.9 forcats

### **fct_inorder()**: ordem em que aparece
```{r}
# ordem em que aparece
fa_inorder <- fa_recode %>% 
  forcats::fct_inorder()
fa_inorder
```

---

# 4.9 forcats

### **fct_infreq()**: ordem (decrescente) de frequência
```{r}
# ordem (decrescente) de frequencia
fa_infreq <- fa_recode %>% 
  forcats::fct_infreq()
fa_infreq
```

---

# 4.9 forcats

### **fct_lump()**: agregação de níveis raros em um nível
```{r}
# agregacao de niveis raros em um nivel
fa_lump <- fa_recode %>% 
  forcats::fct_lump()
fa_lump
```

---

class: clear
background-image: url(img/package_lubridate.png)
background-size: 400px

---

class: clear
background-image: url(img/lubridate_allison.png)
background-size: 600px

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/cheatsheet_lubridate.png)
background-size: 600px
background-position: 50% 50%

# 4.10 lubridate

## Dates and Times Cheatsheet

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://github.com/rstudio/cheatsheets/raw/master/lubridate.pdf

---

# 4.10 lubridate

## Pacote à parte do tidyverse

### Instalar
```{r eval=FALSE}
# install
install.packages("lubridate")
```

### Carregar
```{r}
# load
library(lubridate)
```

---

# 4.10 lubridate

### As funções `date()` e `as_date()` assumem que a ordem segue o padrão da língua inglesa: ano-mês-dia (ymd)

### **date**: classe para datas
```{r}
# string
data_string <- "2020-04-24"
data_string
class(data_string)
```

---

# 4.10 lubridate

### As funções `date()` e `as_date()` assumem que a ordem segue o padrão da língua inglesa: ano-mês-dia (ymd)

### **date**: classe para datas
```{r}
# criar um objeto com a classe data
data_date <- lubridate::date(data_string)
data_date
class(data_date)
```

---

# 4.10 lubridate

### As funções `date()` e `as_date()` assumem que a ordem segue o padrão da língua inglesa: ano-mês-dia (ymd)

### **date**: classe para datas
```{r}
# criar um objeto com a classe data
data_date <- lubridate::as_date(data_string)
data_date
class(data_date)
```

---

# 4.10 lubridate

### Datas no padrão da língua portuguesa: dia-mês-ano (dmy)

### **date**: classe para datas
```{r}
# string
data_string <- "20-10-2020"
data_string
class(data_string)
```

---

# 4.10 lubridate

### Datas no padrão da língua portuguesa: dia-mês-ano (dmy)

### **date**: classe para datas
```{r}
# criar um objeto com a classe data
data_date <- lubridate::dmy(data_string)
data_date
class(data_date)
```

---

# 4.10 lubridate

### Além de outros diversos formatos

```{r}
# formatos
lubridate::dmy(20102020)
lubridate::dmy("20102020")
lubridate::dmy("20/10/2020")
lubridate::dmy("20.10.2020")
```

---

# 4.10 lubridate

### Especificar horários

```{r}
# especificar horarios
lubridate::dmy_h(2010202020)
lubridate::dmy_hm(201020202035)
lubridate::dmy_hms(20102020203535)
```

---

background-image: url(img/package_lubridate.png)
background-size: 300px
background-position: 80% 80%

# 4.10 lubridate

## Funções úteis
- second() - extrai os segundos
- minute() - extrai os minutos
- hour() - extrai a hora
- wday() - extrai o dia da semana
- mday() - extrai o dia do mês
- month() - extrai o mês
- year() - extrai o ano

<br><br><br><br><br><br><br>

[*] http://material.curso-r.com/lubridate/

---

# 4.10 lubridate

### Extração
```{r}
# criar
data <- lubridate::dmy_hms(20102020203535)
data
```
--
```{r}
# extrair
lubridate::second(data)
lubridate::day(data)
lubridate::month(data)
```

---

# 4.10 lubridate

### Extração
```{r}
# criar
data <- lubridate::dmy_hms(20102020203535)
data
```

```{r}
# extrair
lubridate::wday(data)
lubridate::wday(data, label = TRUE)
```

---

# 4.10 lubridate

### Inclusão
```{r}
# criar
data <- lubridate::dmy(20102020)
data
```

```{r}
# inlcuir
lubridate::hour(data) <- 13
data
```

---

# 4.10 lubridate

### Extrair a data no instante da execução
<br>
```{r}
# extrair a data no instante da execucao
lubridate::today() 
```

--

<br>

```{r}
# extrair a data e horario no instante da execucao
lubridate::now()
```

quando eu preparava essa aula...

---

# 4.10 lubridate

### Fusos horários
```{r}
# agora
agora <- lubridate::ymd_hms(lubridate::now(), tz = "America/Sao_Paulo")
agora
```
--
```{r}
# verificar os tz
OlsonNames()
```

---

# 4.10 lubridate

### Fusos horários
```{r}
# que horas sao em...
lubridate::with_tz(agora, tzone = "GMT")
lubridate::with_tz(agora, tzone = "Europe/Stockholm")  
```
--
<br><br>
```{r}
# altera o fuso sem mudar a hora
lubridate::force_tz(agora, tzone = "GMT")
```

---

# 4.10 lubridate

## Operações com datas

### Intervalos
Intervalos podem ser salvos em objetos com classe interval
```{r}
# datas
inicio_r <- lubridate::dmy("30-11-2011")
hoje_r <- lubridate::today()

# intervalo
r_interval <- lubridate::interval(inicio_r, hoje_r)
r_interval
class(r_interval)
```

---

# 4.10 lubridate

## Operações com datas

### Intervalos
Intersecção de intervalor com a função `int_overlaps()`

```{r}
# outra forma de definir um intervalo: o operador %--%
r_interval <- lubridate::dmy("30-11-2011") %--% lubridate::today() 
namoro_interval <- lubridate::dmy("25-06-2008") %--% lubridate::today()   
```
--
```{r}
# verificar sobreposicao
lubridate::int_overlaps(r_interval, namoro_interval)
```

---

# 4.10 lubridate

## Operações com datas

### Aritmética com datas
```{r}
# somando datas
inicio_r + lubridate::ddays(1)
inicio_r + lubridate::dyears(1)
```

---

# 4.10 lubridate

## Operações com datas

### Aritmética com datas
```{r}
# criando datas recorrentes
reunioes <- lubridate::today() + lubridate::weeks(0:10)
reunioes
```

---

# 4.10 lubridate

## Operações com datas

### Aritmética com datas
```{r}
# duracao de um intervalo 
r_interval <- inicio_r %--% lubridate::today()
r_interval
```
--
```{r}
# transformacoes
r_interval / lubridate::dyears(1)
r_interval / lubridate::ddays(1)
```

---

# 4.10 lubridate

## Operações com datas

### Aritmética com datas
```{r}
# total do periodo estudando r
lubridate::as.period(r_interval)
```
--
```{r}
# tempo de namoro
lubridate::as.period(namoro_interval)
```

---

class: clear
background-image: url(img/package_purrr.png)
background-size: 400px

---

background-image: url(img/cheatsheet_purrr.png)
background-size: 600px
background-position: 50% 50%

# 4.11 purrr

## Data Import Cheatsheet

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://github.com/rstudio/cheatsheets/raw/master/purrr.pdf

---

# 4.11 purrr

### Pacote que implementa **Programação Funcional** 

--

<br>

### Uma função **chama outra função** para ser **aplicada repetidamente** percorrendo **elementos de um objeto** (vetor, lista ou data frame)

--

<br>

## Exemplos:
- Análise de experimento em vários locais 
- Análise de todas as respostas de um experimento
- Análise dos dados com diferentes transformações de variáveis
- Simulação computacional com diferentes delineamentos
- Importação de todos os datasets de um diretório

---

background-image: url(img/purrr_map.png)
background-size: 400px
background-position: 85% 90%

# 4.11 purrr

## A principal função é a `map*()` e sua "família"

<br>

## map(.x, .f)
### .x: uma vetor, lista ou data frame
### .f: uma função

---

# 4.11 purrr

## Aplicando uma função em série
```{r}
x <- list(1:5, c(4, 5, 7), c(1, 1, 1), c(2, 2, 2, 2, 2))
```

```{r}
purrr::map(x, sum)
```

---

# 4.11 purrr

## Tipos de retorno

<br><br>

|  map |  returns |
|:--|:--|
|`map()` | list |
|`map_chr()` | character vector |
|`map_dbl()` | double vector (numeric) |
|`map_int()` | integer vector |
|`map_lgl()` | logical vector |
|`map_dfc()` | data frame (by column) |
|`map_dfr()` | data frame (by row) |

---

# 4.11 purrr

<br><br>

## Retorna double vector (numeric)
```{r}
purrr::map_dbl(x, sum)
```

<br>

--

## Retorna strings
```{r}
purrr::map_chr(x, paste, collapse = " ")
```

---

# 4.11 purrr

## Duas listas em paralelo
```{r}
x <- list(3, 5, 0, 1)
y <- list(3, 5, 0, 1)

purrr::map2_dbl(x, y, prod)
```

--

## Várias listas aninhadas
```{r}
x <- list(3, 5, 0, 1)
y <- list(3, 5, 0, 1)
z <- list(3, 5, 0, 1)

purrr::pmap_dbl(list(x, y, z), prod)
```

---

# 4.11 purrr

### Calcular a média para várias colunas
```{r}
mean_var <- si %>% 
  dplyr::select(species_number, altitude) %>% 
  purrr::map_dbl(mean)
mean_var
```

--

### Calcular o desvio padrão para várias colunas
```{r}
sd_var <- si %>% 
  dplyr::select(species_number, altitude) %>% 
  purrr::map_dbl(sd)
sd_var
```

---

background-image: url(img/general_curso_r.png), url(img/person_jenny_bryan.jpeg)
background-size: 400px, 300px
background-position: 10% 70%, 90% 80%

# 4.11 purrr

## Material

### [Webinar de purrr avançado](https://youtu.be/vb1lD9_AFcU) - Curso-R

### [purrr tutorial](https://jennybc.github.io/purrr-tutorial/) - Jennifer (Jenny) Bryan

---

class: clear
background-image: url(img/package_furrr.png)
background-size: 400px

---

background-image: url(img/package_furrr.png)
background-size: 300px
background-position: 50% 65%

# 4.12 furrr

## Programação funcional paralelizada

### Faz o mapeamento em paralelo mais integrado possível

<br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://www.tidyverse.org/blog/2020/10/furrr-0-2-0/

---

class: inverse, center, middle

# Leitura

---

background-image: url(img/geo_geoprocessing02.png)
background-size: 800px
background-position: 50% 40%

# Leitura

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

*[http://www.ufrrj.br/lga/tiagomarino/artigos/oqueegeoprocessamento.pdf]

---

class: inverse, center, middle

# Dúvidas?

---

class: clear, middle
background-image: url(img/gif_frog.gif),url(img/gif_frogs.gif)
background-size: 250px,500px
background-position: 35% 60%,90% 70%

## Maurício Vancine

<br><br>

Contatos:

`r icon::icon_style(icon::fontawesome(name = "envelope", style = "solid"), fill = "#2369bd")` [mauricio.vancine@gmail.com]()  
`r icon::icon_style(icon::fontawesome("twitter"), fill = "#2369bd")` [@mauriciovancine](https://twitter.com/mauriciovancine)  
`r icon::icon_style(icon::fontawesome(name = "github"), fill = "#2369bd")` [mauriciovancine](https://github.com/mauriciovancine)
`r icon::icon_style(icon::fontawesome(name = "link", style = "solid"), fill = "#2369bd")` [mauriciovancine.github.io](https://mauriciovancine.github.io)

<br><br>

Slides criados via pacote [xaringan](https://github.com/yihui/xaringan) e tema [Metropolis](https://github.com/pat-s/xaringan-metropolis)